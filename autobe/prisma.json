{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_channels","description":"Defines logical shopping mall channels (distinct sales domains/applications/brands) serving as the top-level context for all subsequent entities. Channel is the anchor for section, category, catalog, order, and configuration scoping. Each channel may represent a separate storefront, brand, or localized instance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique business code for the channel (e.g., 'main', 'korea', 'brandX'). Used for API routing and business rule scoping.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the channel. Used in admin UI and business communication.","nullable":false},{"name":"description","type":"string","description":"General description and business context of the channel.","nullable":true},{"name":"created_at","type":"datetime","description":"Channel creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time of the channel info.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Channel deletion time (soft delete).","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_sections","description":"Logical groupings within a channel (e.g. 'Best Deal', 'International', 'Seasonal'), referencing the owning channel. Used for merchandising, curation, and business rules. Hierarchically below channels, but may span multiple business domains.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Belonged channel's {@link shopping_mall_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Unique section code, scoped to channel, for business identification (e.g., 'home', 'event', 'bestseller').","nullable":false},{"name":"name","type":"string","description":"Section display name as seen in business UI or user application.","nullable":false},{"name":"description","type":"string","description":"Short description of the section's purpose.","nullable":true},{"name":"display_order","type":"int","description":"Integer order for listing sections within a channel.","nullable":false},{"name":"created_at","type":"datetime","description":"Section creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Section update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Section deletion time (soft delete); remains for audit/tracking.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_channel_id","display_order"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_channel_categories","description":"Hierarchical categories defining product or section classification within a given channel. Supports parent-child nesting for multi-level trees. Used for search, browse, campaign targeting, and rule scoping. Each belongs to a channel and can reference a parent category (self-relation).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Channel to which the category belongs. {@link shopping_mall_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional reference to parent category for child/descendant relationships. {@link shopping_mall_channel_categories.id}.","relation":{"name":"parent","targetModel":"shopping_mall_channel_categories","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique category code scoped to channel (and maybe parent). Used in routing and business logic.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the category.","nullable":false},{"name":"description","type":"string","description":"Description of the category purpose, contents, or intended merchandise.","nullable":true},{"name":"display_order","type":"int","description":"Sort order for UI rendering or admin lists within a parent or channel.","nullable":false},{"name":"created_at","type":"datetime","description":"Category creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update to the category information.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Category deletion time (soft delete).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_id"]},{"fieldNames":["display_order"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_configurations","description":"Stores configuration blob(s) for channels or global use (e.g. feature flags, legal text, social links, settings). Each config row may be targeted at a channel, be global, or serve different configuration classes. Version-managed by snapshots for audit and recovery.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Optional FK channel scope for this configuration. If null, applies globally or to all channels.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":true}],"plainFields":[{"name":"key","type":"string","description":"Business-level code or category for this configuration (e.g., 'feature_flag_shipping', 'legal_policy_en').","nullable":false},{"name":"value","type":"string","description":"The configuration blob; may be JSON, text, or rendered markdown/HTML, etc. Format varies by key.","nullable":false},{"name":"revision","type":"int","description":"Revision number for the configuration. Incremented with each new snapshot/version.","nullable":false},{"name":"description","type":"string","description":"Description of the setting's business meaning.","nullable":true},{"name":"created_at","type":"datetime","description":"Configuration row creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time of this configuration value.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time for the configuration row.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_channel_id","key"],"unique":true}],"plainIndexes":[{"fieldNames":["key"]}],"ginIndexes":[]},{"name":"shopping_mall_channel_configuration_snapshots","description":"Append-only historical preservation of all configuration changes for channel/global configuration records. Used to audit, rollback, or prove compliance for configuration events. Each snapshot references the configuration, storing its previous state, revision, and change timing. Immutable after insert.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_configuration_id","type":"uuid","description":"Target configuration whose state was snapshotted. {@link shopping_mall_configurations.id}.","relation":{"name":"configuration","targetModel":"shopping_mall_configurations"},"unique":false,"nullable":false}],"plainFields":[{"name":"revision","type":"int","description":"The revision number when this snapshot was taken (immutable for historical record).","nullable":false},{"name":"key","type":"string","description":"Business configuration key being snapshotted, redundant for full history traceability.","nullable":false},{"name":"value","type":"string","description":"Configuration value (blob/text/JSON) at the time of this snapshot.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation time (point of version preservation).","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_configuration_id","revision"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_customers","description":"Customer profile and identity for shopping mall platform. Stores primary information for authenticated shoppers, their contact data, credential hashes, registration channel, status, soft-delete, and audit timestamps. Linked to their associated identities, external accounts, agreements, and snapshots. {@link shopping_mall_customer_identities}, {@link shopping_mall_external_accounts}, {@link shopping_mall_user_agreements}, and {@link shopping_mall_customer_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Registered channel's {@link shopping_mall_channels.id} for multi-tenant segmentation.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"email","type":"string","description":"Primary customer email, unique per channel. Used for login unless OAuth only.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for authentication (never store plain). Null if no password for OAuth-only users.","nullable":true},{"name":"phone","type":"string","description":"Mobile/contact phone per channel policy.","nullable":true},{"name":"name","type":"string","description":"Legal or preferred name for personalized interactions, receipts, compliance.","nullable":false},{"name":"status","type":"string","description":"Customer account lifecycle status (active, pending, suspended, withdrawn, etc).","nullable":false},{"name":"kyc_status","type":"string","description":"KYC/identity verification status (pending, verified, denied, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last modification timestamp (auto-update).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for audit/compliance. Null if not deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_channel_id","email"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_sellers","description":"Seller account information. Identifies vendors with permissions to list/manage products and access sales analytics for their own goods. Inherits all customer fields plus seller-specific status, escalation, verification, and profile meta. Links to customer entity, has audit/snapshot, and supports soft delete. {@link shopping_mall_customers} (relation), {@link shopping_mall_sections}, {@link shopping_mall_seller_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Base customer record {@link shopping_mall_customers.id} for permission inheritance and login linkage.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":true,"nullable":false},{"name":"shopping_mall_section_id","type":"uuid","description":"Home section/shop for the seller {@link shopping_mall_sections.id}. Used for channel/section scoping.","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":false}],"plainFields":[{"name":"profile_name","type":"string","description":"Seller's public display name or shop title.","nullable":false},{"name":"status","type":"string","description":"Seller approval/lifecycle status (pending, active, suspended, rejected, withdrawn).","nullable":false},{"name":"approval_at","type":"datetime","description":"Datetime seller was formally approved. Null if not yet approved.","nullable":true},{"name":"kyc_status","type":"string","description":"KYC/identity check status (pending, verified, denied, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last modification timestamp (auto-update).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for audit/compliance. Null if not deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"profile_name"}]},{"name":"shopping_mall_admins","description":"Platform administrator profiles with role-based privilege separation. Controls all system-level configuration, moderation, and audit features. Core entity for admin authentication, KYC validation, and independent login. Linked to escalation, audit, and admin snapshot tables. {@link shopping_mall_admin_role_escalations}, {@link shopping_mall_admin_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"Admin login email. Unique across all admins (no duplication allowed).","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for admin authentication (never store plain).","nullable":false},{"name":"name","type":"string","description":"Full legal name (compliance, logging, and business context).","nullable":false},{"name":"status","type":"string","description":"Admin account state (active, suspended, pending, withdrawn, etc).","nullable":false},{"name":"kyc_status","type":"string","description":"KYC/identity verification status (pending, verified, denied, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last modification timestamp (auto-update).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for audit/compliance. Null if not deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_customer_identities","description":"Customer identity verification information (KYC). Holds personal identifiers, validated documents, verification status, issuer meta, and active/inactive history. Links to customer entity and supports compliance audits. Never directly exposed to non-admin users.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer's {@link shopping_mall_customers.id} for whom this identity record is maintained.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"identity_type","type":"string","description":"Type of identity: government_id, passport, driver's_license, resident_number, etc.","nullable":false},{"name":"identity_value","type":"string","description":"Hashed or encrypted identifier value for privacy.","nullable":false},{"name":"issuer","type":"string","description":"Year/authority/issuer for the proof. Optional per national regulation.","nullable":true},{"name":"issue_date","type":"datetime","description":"Date when ID/proof was issued. Useful for validity tracking.","nullable":true},{"name":"verified_at","type":"datetime","description":"Datetime when this identity was confirmed as valid by business staff or AI models.","nullable":true},{"name":"status","type":"string","description":"Verification state: pending, verified, rejected, expired, etc.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last modification timestamp (auto-update).","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","identity_type"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"shopping_mall_external_accounts","description":"External OAuth/social account linkage for cross-platform authentication (Google, Apple, Kakao, Naver, etc). Stores mapping to provider, subject ID, link status, and audit meta. Supports unique association per provider per customer. Used for password-less logins, account recovery, and omnichannel identity. {@link shopping_mall_customers}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer's {@link shopping_mall_customers.id} this external account belongs to.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"provider","type":"string","description":"OAuth provider name (google, apple, kakao, naver, etc).","nullable":false},{"name":"external_user_id","type":"string","description":"Unique identifier for the user's external account at the provider (e.g., subject, uid).","nullable":false},{"name":"linked_at","type":"datetime","description":"Datetime the external account was linked to the customer record.","nullable":false},{"name":"status","type":"string","description":"Link status (active, revoked, expired, pending).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last modification timestamp (auto-update).","nullable":false}],"uniqueIndexes":[{"fieldNames":["provider","external_user_id"],"unique":true},{"fieldNames":["shopping_mall_customer_id","provider"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_admin_role_escalations","description":"Admin role elevation requests and approvals. Tracks escalation attempts (customer→admin, seller→admin), workflow status, reviewer, approval/rejection reasons, evidence snapshot linkage. Used for audit, compliance, and onboarding processes. {@link shopping_mall_admins}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_admin_id","type":"uuid","description":"Admin's {@link shopping_mall_admins.id} targeted by this escalation (person escalating or being escalated).","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":false}],"plainFields":[{"name":"requestor_id","type":"uuid","description":"ID of requesting user (customer/seller becoming admin) as business context. Stored for traceability.","nullable":false},{"name":"escalation_type","type":"string","description":"Type of escalation: customer_to_admin, seller_to_admin, privilege_update, etc.","nullable":false},{"name":"status","type":"string","description":"Escalation workflow status (pending, approved, rejected, cancelled, etc).","nullable":false},{"name":"reviewed_by_id","type":"uuid","description":"ID of the reviewer/admin who processed/approved this escalation. Null if pending.","nullable":true},{"name":"reason","type":"string","description":"Approval/rejection reason or audit context.","nullable":true},{"name":"created_at","type":"datetime","description":"Escalation request creation timestamp (audit).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the escalation record.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"shopping_mall_user_connections","description":"Session and connection metadata for actors. Records live and historical session events (login, logout, IP, device info, auth context) for compliance, fraud tracking, and risk scoring. Supports per-channel scoping and audit history. Restricts PII exposure via role checks.\nLinks to customer, seller, or admin identities (discriminator required for use).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"actor_id","type":"uuid","description":"Associated actor's id; refers to customer, seller, or admin depending on session context (discriminator or composite required in application layer).","nullable":false},{"name":"actor_type","type":"string","description":"Discriminator for actor type (customer, seller, admin) used to resolve foreign context. Required.","nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context for this connection (multi-channel session).","nullable":false},{"name":"ip_address","type":"string","description":"Remote IP address of connection (IPv4/IPv6).","nullable":false},{"name":"user_agent","type":"string","description":"Agent string of browser/app/device. Used for session/connection risk analytics.","nullable":true},{"name":"login_at","type":"datetime","description":"Datetime of login/session establishment.","nullable":false},{"name":"logout_at","type":"datetime","description":"Datetime of logout/session end if known; null if session is current/open.","nullable":true},{"name":"auth_context","type":"string","description":"Auth context info (how login was performed—password, OAuth/google/apple, role, device/2FA).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false}],"uniqueIndexes":[{"fieldNames":["actor_id","actor_type","login_at"],"unique":true}],"plainIndexes":[{"fieldNames":["channel_id"]}],"ginIndexes":[]},{"name":"shopping_mall_user_agreements","description":"Records all user (customer/seller/admin) agreement acceptances with timestamp, version, and type (Terms, Privacy, Consent, etc). Essential for legal and regulatory compliance, opt-in/withdrawal, and user re-consent tracking. Links to actor entity via actor_id/type discrimination (handled at app layer).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"actor_id","type":"uuid","description":"Associated actor's id; refers to customer, seller, or admin depending on actor context (application-layer discriminator required).","nullable":false},{"name":"actor_type","type":"string","description":"Discriminator for actor type (customer, seller, admin) for reference resolution.","nullable":false},{"name":"agreement_type","type":"string","description":"Agreement type—\"Terms\", \"Privacy\", \"MarketingConsent\", etc. Business enum.","nullable":false},{"name":"version","type":"string","description":"Document version string (\"2024-03.1\" or similar).","nullable":false},{"name":"accepted_at","type":"datetime","description":"Datetime when agreement was accepted or updated.","nullable":false},{"name":"withdrawn_at","type":"datetime","description":"Timestamp if user withdraws this agreement (GDPR/opt-out requests).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC ISO-8601).","nullable":false}],"uniqueIndexes":[{"fieldNames":["actor_id","actor_type","agreement_type","version"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_customer_snapshots","description":"Historical snapshots of customer entities for audit, compliance, and evidence retention. Stores point-in-time state of customer record with all major data for rollback/dispute or compliance requests. Never updated post-write (append-only), only read for evidence/audit. Links to main customer entity.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer's {@link shopping_mall_customers.id} whose state is snapshotted.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Serialized record of customer state (JSON or structured string). Immutable. Includes PII as required by compliance.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation time (UTC ISO-8601).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_snapshots","description":"Historical snapshots of seller entities for audit/compliance. Stores point-in-time state of seller account, including profile, status, KYC at snapshot time. Used for rollback, dispute, or evidence analytics. Append-only. Linked to main seller entity.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller's {@link shopping_mall_sellers.id} whose state is snapshotted.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Serialized record (JSON/structured string) of seller at snapshot time. Immutable. Includes all relevant fields for audit, rollback, or evidence.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation time (UTC ISO-8601).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id"]}],"ginIndexes":[]},{"name":"shopping_mall_admin_snapshots","description":"Historical snapshots of admin accounts for compliance, rollback, and evidence. Stores admin state at time of change/event, retained for audit. Append-only; not modified except for legal erasure. Linked to admin entity.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_admin_id","type":"uuid","description":"Admin's {@link shopping_mall_admins.id} whose state is snapshotted.","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Complete serialized record (JSON/etc) of admin at snapshot time. Immutable.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation time (UTC ISO-8601).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_admin_id"]}],"ginIndexes":[]}]},{"filename":"schema-03-products.prisma","namespace":"Products","models":[{"name":"shopping_mall_products","description":"Core product catalog table representing products registered by sellers. Supports linkage to seller, channel, section, and primary category. Carries main identifying attributes, business status, and time meta for full product lifecycle workflows. References subsidiary tables for options, variants, bundles, SEO, content, inventory, and attachments.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who owns the product. {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false},{"name":"shopping_mall_channel_id","type":"uuid","description":"Channel where the product is listed. {@link shopping_mall_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_section_id","type":"uuid","description":"Section where product is grouped (virtual corner, theme, etc). {@link shopping_mall_sections.id}","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Primary category (hierarchical) for filtering & search. {@link shopping_mall_channel_categories.id}","relation":{"name":"category","targetModel":"shopping_mall_channel_categories"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Business-facing, unique product code per seller/channel. Used for SKU and product identity.","nullable":false},{"name":"name","type":"string","description":"Product display name for customers and search.","nullable":false},{"name":"status","type":"string","description":"Product status (e.g., Draft, Active, Paused, Discontinued, Deleted). Controls visibility and business flows.","nullable":false},{"name":"business_status","type":"string","description":"Business workflow state, e.g., Approval, Pending Activation, Blocked, Suspended.","nullable":false},{"name":"created_at","type":"datetime","description":"Product creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, null if not deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_channel_id","shopping_mall_section_id","shopping_mall_category_id"]},{"fieldNames":["status"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_product_options","description":"Product option definitions (size, color, style, etc.) bound to a parent product. Option attributes enable variant generation. Not independently managed by users, defined as part of product setup.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Option name (e.g., Size, Color) shown to customer during selection.","nullable":false},{"name":"required","type":"boolean","description":"Whether this option must be selected to order product.","nullable":false},{"name":"position","type":"int","description":"Display order/position in UI for option selection.","nullable":false},{"name":"created_at","type":"datetime","description":"Option creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_product_option_values","description":"Possible values for each product option (e.g., Red, Blue, Large, Small). Referenced by variants. Managed as part of product definition and variant generation, not directly managed by users.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_option_id","type":"uuid","description":"Parent option {@link shopping_mall_product_options.id}","relation":{"name":"option","targetModel":"shopping_mall_product_options"},"unique":false,"nullable":false}],"plainFields":[{"name":"value","type":"string","description":"Value label (e.g., Red, L, 42). Displayed for selection and variant mapping.","nullable":false},{"name":"position","type":"int","description":"Display order/position relative to other values.","nullable":false},{"name":"created_at","type":"datetime","description":"Option value creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_option_id","value"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"value"}]},{"name":"shopping_mall_product_variants","description":"Each row represents a unique SKU (stock keeping unit) defined by a combination of option values for a product. Critical for inventory and order management but not user-managed directly.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product this variant belongs to. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku_code","type":"string","description":"Internal SKU code/identifier unique within product.","nullable":false},{"name":"bar_code","type":"string","description":"Bar code or EAN/UPC for the variant (optional).","nullable":true},{"name":"option_values_hash","type":"string","description":"Deterministic hash of selected option values for this variant (enables fast lookup and uniqueness enforcement).","nullable":false},{"name":"price","type":"double","description":"Sales price of this variant/SKU.","nullable":false},{"name":"stock_quantity","type":"int","description":"Current inventory quantity (redundant with inventory events, but used for listing performance).","nullable":false},{"name":"weight","type":"double","description":"Weight for shipping calculations. Required for delivery use-cases.","nullable":false},{"name":"created_at","type":"datetime","description":"Variant creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","option_values_hash"],"unique":true},{"fieldNames":["sku_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id"]}],"ginIndexes":[]},{"name":"shopping_mall_product_bundles","description":"Represents a product bundle/composite product. Bundles reference type (fixed, optional, etc), pricing logic, and display contents. Not managed directly by users other than during product registration.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product for which this bundle is defined. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Bundle display name for customers.","nullable":false},{"name":"bundle_type","type":"string","description":"Type of bundle, e.g., 'fixed' or 'optional'.","nullable":false},{"name":"description","type":"string","description":"Short description of bundle (optional).","nullable":true},{"name":"position","type":"int","description":"Display order for multiple bundles on one product.","nullable":false},{"name":"created_at","type":"datetime","description":"Bundle creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last bundle update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","name"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_product_bundle_items","description":"Junction table linking products included in a given bundle (composition M:N). Each row is an item in a bundle, referencing both the bundle and the constituent product. Enforces order and uniqueness, supports optional/multiplicative bundles.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_bundle_id","type":"uuid","description":"Bundle this item belongs to. {@link shopping_mall_product_bundles.id}","relation":{"name":"bundle","targetModel":"shopping_mall_product_bundles"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Product included in this bundle. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of this product in the bundle.","nullable":false},{"name":"required","type":"boolean","description":"Whether this product must be included in purchase/bundle.","nullable":false},{"name":"position","type":"int","description":"Display order within the bundle.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_bundle_id","shopping_mall_product_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_product_tags","description":"Tags associated with products for keyword search and AI-driven recommendation/personalization. Not managed independently, attached during product registration or update.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product referenced by this tag. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"tag","type":"string","description":"Tag or keyword assigned to the product, used for search and recommendations.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","tag"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"tag"}]},{"name":"shopping_mall_product_seo_metadata","description":"Per-product SEO metadata including meta title, meta description, and keywords for search optimization. Only attached via product, not managed independently by users.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product for which this SEO meta is attached. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"meta_title","type":"string","description":"SEO meta title for the product.","nullable":false},{"name":"meta_description","type":"string","description":"SEO meta description for the product.","nullable":false},{"name":"meta_keywords","type":"string","description":"SEO meta keywords, comma-separated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["meta_title"]}],"ginIndexes":[{"fieldName":"meta_keywords"}]},{"name":"shopping_mall_product_content","description":"Rich content fields for product descriptions, policies, and multilingual data. Includes display content in Markdown/HTML, return/warranty policy, and structured data for suggestions/recommendations. Attached per product.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product for which this content is provided. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"content_markdown","type":"string","description":"Formatted product description in Markdown or HTML.","nullable":false},{"name":"return_policy","type":"string","description":"Return policy text (localized, shown to customers).","nullable":false},{"name":"warranty_policy","type":"string","description":"Warranty/aftersales policy text (localized, shown to customers).","nullable":false},{"name":"locale","type":"string","description":"Language and region code for content localization.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["locale"]}],"ginIndexes":[{"fieldName":"content_markdown"}]},{"name":"shopping_mall_product_inventories","description":"Inventory event table, capturing all inventory-changing events (add, remove, adjust, restock) by variant/SKU as an event log. Enables full audit trail and reconciliation of stock changes for compliance.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_variant_id","type":"uuid","description":"Variant SKU affected by this inventory event. {@link shopping_mall_product_variants.id}","relation":{"name":"variant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Inventory event type: 'add', 'remove', 'adjust', 'restock', etc.","nullable":false},{"name":"delta_quantity","type":"int","description":"Change in quantity (positive for receive, negative for issue).","nullable":false},{"name":"remaining_quantity","type":"int","description":"Running balance of quantity for this SKU post-event.","nullable":false},{"name":"reference_id","type":"uuid","description":"Reference entity/event; could be order, restock or manual entry. Used for audit linkage.","nullable":true},{"name":"event_timestamp","type":"datetime","description":"Time event is recorded.","nullable":false},{"name":"note","type":"string","description":"Optional note for context (e.g., reason for adjustment, batch ID).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_variant_id","event_timestamp"]}],"ginIndexes":[]},{"name":"shopping_mall_product_snapshots","description":"Snapshot table capturing the entire historical state of a product for each mutation. Enables audit/evidence for compliance and rollback. Stores all business fields and relationships as at the snapshot time.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product which this snapshot represents. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_version","type":"int","description":"Monotonically increasing snapshot version for this product.","nullable":false},{"name":"data_json","type":"string","description":"Complete serialized product state at the snapshot moment (JSON blob for compliance/audit).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","snapshot_version"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_product_attachment_links","description":"Links between products (or related entities) and file attachments. Enables multiple attachments per product/content, supporting images, files, and rich media.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product for which this file is attached. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"attachment_id","type":"uuid","description":"Attachment file reference, linked to shopping_mall_attachments table. {@link shopping_mall_attachments.id}","relation":{"name":"attachment","targetModel":"shopping_mall_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"purpose","type":"string","description":"Attachment usage context (e.g., main_image, gallery, spec_sheet).","nullable":false},{"name":"position","type":"int","description":"Order for displaying attachments of the same purpose/category.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","attachment_id","purpose"],"unique":true}],"plainIndexes":[],"ginIndexes":[]}]},{"filename":"schema-04-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_carts","description":"Shopping cart entity managed per customer and channel/section. Allows persistent holding of items before order, supports both guest and logged-in users. Tied to shopping_mall_customers and systematic domains. Soft delete and audit fields for compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged customer's {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_channel_id","type":"uuid","description":"Associated sales channel {@link shopping_mall_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_section_id","type":"uuid","description":"Associated section within channel {@link shopping_mall_sections.id}.","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":false}],"plainFields":[{"name":"source","type":"string","description":"Source of the cart (guest, member, migrated, etc).","nullable":false},{"name":"status","type":"string","description":"Status of the cart (active, expired, checked_out, deleted).","nullable":false},{"name":"expires_at","type":"datetime","description":"Expiration timestamp for automatic cart archival.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for audit/evidence compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","status"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_channel_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_items","description":"Cart item entity representing a product/variant/option added to a cart. Each row links to a unique product (or bundle/product option), quantity, and cart context. No standalone search; always subsidiary to parent cart.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Parent cart {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Associated product {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_product_variant_id","type":"uuid","description":"Selected product variant (combination of options), {@link shopping_mall_product_variants.id}.","relation":{"name":"variant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":true}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity selected for this item.","nullable":false},{"name":"option_snapshot","type":"string","description":"Serialized snapshot of selected options for evidence/audit.","nullable":false},{"name":"created_at","type":"datetime","description":"Cart item creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for historical tracking.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_cart_id","shopping_mall_product_id","shopping_mall_product_variant_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_snapshots","description":"Audit/history snapshot for entire shopping cart instance (state before/after key changes, checkout, deletion, etc). Used for legal compliance, rollback, and dispute scenarios.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Source cart instance {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Immutable serialized JSON of the cart structure at snapshot time.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_orders","description":"Main business order entity. Ties customer, channel/section, and core order context. Supports multi-item, multi-seller, and multi-status (applied, paid, fulfilled, split, cancelled, etc.). Legal evidence; all state transitions snapshotted. Indexed for query across channel/segment/timestamps.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Order-placing customer {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_channel_id","type":"uuid","description":"Target channel {@link shopping_mall_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_section_id","type":"uuid","description":"Target section {@link shopping_mall_sections.id}.","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":false},{"name":"shopping_mall_cart_id","type":"uuid","description":"Originating cart instance {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts"},"unique":false,"nullable":true}],"plainFields":[{"name":"external_order_ref","type":"string","description":"Reference to external order/payment systems for events or integrations. ","nullable":true},{"name":"status","type":"string","description":"Order status (applied, payment_required, paid, in_fulfillment, shipping, delivered, completed, cancelled, split, etc).","nullable":false},{"name":"order_type","type":"string","description":"Type of order (normal, split, group, aftersales, etc).","nullable":false},{"name":"total_amount","type":"double","description":"Total order amount at application time. Used for analytics/auditing.","nullable":false},{"name":"paid_amount","type":"double","description":"Actual paid amount (may differ due to coupon, error correction, etc).","nullable":true},{"name":"currency","type":"string","description":"Order currency (supports multi-currency settlements).","nullable":false},{"name":"created_at","type":"datetime","description":"Order creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (for legal recovery, never physically deleted).","nullable":true}],"uniqueIndexes":[{"fieldNames":["external_order_ref"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_channel_id","status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_order_items","description":"Order substructure for each unique product or bundled component. Each item reflects status, fulfillment, individual pricing, and option choice. Always subsidiary to a parent order (1:N).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Ordered product {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_product_variant_id","type":"uuid","description":"Specific product variant (option combination) {@link shopping_mall_product_variants.id}.","relation":{"name":"variant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Responsible seller for fulfillment {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Number of units ordered for this item/reference.","nullable":false},{"name":"unit_price","type":"double","description":"Unit price at order time (pre-discount).","nullable":false},{"name":"final_price","type":"double","description":"Final price after discounts, per unit.","nullable":false},{"name":"discount_snapshot","type":"string","description":"Snapshot of all discounts/coupons applied.","nullable":true},{"name":"status","type":"string","description":"Status of order item (ordered, paid, fulfilled, cancelled, returned, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Item creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion for evidence/audit.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_order_snapshots","description":"Full audit snapshot of the order object at any legal/compliance relevant state prior to transition. Stores immutable JSON blob and reference to source order for easy retrieval and rollback. Used for dispute/legal requirements.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order instance referenced for audit snapshot {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Immutable serialized state of order (including nested items, payments, etc) at time of snapshot.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_order_item_snapshots","description":"Snapshot of a single order item’s state at a point in time for fine-grained audit and aftersales tracking. Used to reconstruct product/item state in disputes or process automation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_item_id","type":"uuid","description":"Corresponding order item {@link shopping_mall_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Serialized frozen state of order item at the moment (JSON).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_item_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payments","description":"Payment record associated with orders—tracks each payment, refund, or settlement method flow. Includes support for asynchronous payment, multiple partial payments, per-channel payment configuration. Indexed for audit/tracing.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Linked order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Paying customer {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"payment_type","type":"string","description":"Payment type (card, virtual_account, deposit, mileage, split, etc).","nullable":false},{"name":"external_payment_ref","type":"string","description":"External system payment reference, if present.","nullable":true},{"name":"status","type":"string","description":"Payment status (pending, paid, cancelled, failed, refunded, etc).","nullable":false},{"name":"amount","type":"double","description":"Amount covered by this payment.","nullable":false},{"name":"currency","type":"string","description":"Currency of transaction (system supports multi-currency).","nullable":false},{"name":"requested_at","type":"datetime","description":"Time payment was initiated.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Time payment was confirmed.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Time payment was cancelled/refunded.","nullable":true},{"name":"created_at","type":"datetime","description":"Row creation time (for audit trail).","nullable":false},{"name":"updated_at","type":"datetime","description":"Row last update time (for audit trail).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_snapshots","description":"Audit snapshots of a payment state at critical transitions for compliance (requested/confirmed/cancelled). Snapshots allow tracing every legal/financial event on the payment object.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Source payment {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Serialized immutable JSON state at time of snapshot.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_shipments","description":"Shipment batch associated with an order. Shipments can be split from the same order (partial or multi-seller) and are linked to fulfillment workflow. Status, carrier, shipping info, and per-shipment state tracked. Key for multi-seller/partial shipment logic.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Responsible shipping seller for this batch {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"shipment_code","type":"string","description":"Unique shipment code for tracking purposes.","nullable":false},{"name":"external_tracking_number","type":"string","description":"External carrier's shipment tracking code.","nullable":true},{"name":"status","type":"string","description":"Combined status of shipment (pending, shipped, delivered, returned, cancelled, etc).","nullable":false},{"name":"carrier","type":"string","description":"Logistics/carrier service reference.","nullable":true},{"name":"requested_at","type":"datetime","description":"Time shipment prep was initiated.","nullable":true},{"name":"shipped_at","type":"datetime","description":"Time goods handed to carrier.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Time shipment delivery confirmed.","nullable":true},{"name":"created_at","type":"datetime","description":"Row creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Row update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, never physical deletion.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shipment_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_shipment_items","description":"Junction table for many-to-many relationship between shipments and order items, allowing partial shipments per item or item portions across multiple shipments. Always subsidiary, never independent API.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_shipment_id","type":"uuid","description":"Parent shipment {@link shopping_mall_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Associated order item {@link shopping_mall_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":false}],"plainFields":[{"name":"shipped_quantity","type":"int","description":"Number of units shipped from this item in this batch.","nullable":false},{"name":"created_at","type":"datetime","description":"Junction creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Junction update timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_shipment_id","shopping_mall_order_item_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_deliveries","description":"Represents the delivery address window for an order or specific shipment/batch. Splits and supports post-shipment updates and recipient confirmation logic. References external status/confirmation and fully replaced for each handover.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Linked parent order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_shipment_id","type":"uuid","description":"Optional link to a given shipment or batch (used in partial shipment scenarios).","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":true}],"plainFields":[{"name":"recipient_name","type":"string","description":"Recipient name at time of delivery.","nullable":false},{"name":"recipient_phone","type":"string","description":"Contact phone of recipient.","nullable":false},{"name":"address_snapshot","type":"string","description":"Full delivery address/final snapshot for compliance/audit.","nullable":false},{"name":"delivery_message","type":"string","description":"User-supplied delivery message/instruction.","nullable":true},{"name":"delivery_status","type":"string","description":"Status (prepared, dispatched, delivered, returned, failed, confirmed, etc).","nullable":false},{"name":"confirmed_at","type":"datetime","description":"User or system confirmation time for successful delivery.","nullable":true},{"name":"delivery_attempts","type":"int","description":"Number of delivery attempts.","nullable":false},{"name":"created_at","type":"datetime","description":"Row creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Row update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","delivery_status"]}],"ginIndexes":[]},{"name":"shopping_mall_after_sale_services","description":"Main business entity for after-sales service cases (returns, exchanges, refund requests). Ties to order and delivery entities. Stores status, request/resolution, and evidence snapshot references for dispute or compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Referenced order for after-sales case {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_delivery_id","type":"uuid","description":"Referenced delivery from which after-sales is initiated (if any).","relation":{"name":"delivery","targetModel":"shopping_mall_deliveries"},"unique":false,"nullable":true}],"plainFields":[{"name":"case_type","type":"string","description":"Type of case (return, exchange, refund, repair, etc).","nullable":false},{"name":"status","type":"string","description":"Current status (requested, processing, approved, denied, in_delivery, completed, cancelled).","nullable":false},{"name":"reason","type":"string","description":"User-provided reason for request.","nullable":true},{"name":"evidence_snapshot","type":"string","description":"Reference to order/delivery/item snapshots at time of request.","nullable":true},{"name":"resolution_message","type":"string","description":"Resolution info from platform or seller/support.","nullable":true},{"name":"created_at","type":"datetime","description":"Row creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Row last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for compliance.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","case_type"]}],"ginIndexes":[]}]},{"filename":"schema-05-coupons.prisma","namespace":"Coupons","models":[{"name":"shopping_mall_coupons","description":"Main business entity for all available discount/coupon definitions. Represents the logical configuration of a coupon: code, type, discount metadata, validity window, applicability (all/segment), stackability/exclusivity, issuance/usage caps, and auditability. Independently managed by admins or sellers. Referenced by issuances, targets, usages, and campaigns. Snapshotted on all configuration or status changes.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_campaign_id","type":"uuid","description":"Associated campaign's {@link shopping_mall_coupon_campaigns.id}. Nullable if stand-alone or ad hoc coupon.","relation":{"name":"campaign","targetModel":"shopping_mall_coupon_campaigns"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique coupon code or template (for single/bulk issuance).","nullable":false},{"name":"title","type":"string","description":"Coupon title/label, user-facing.","nullable":false},{"name":"description","type":"string","description":"Coupon description (terms, usage, etc).","nullable":true},{"name":"coupon_type","type":"string","description":"Type of coupon (public, private, one-time, etc).","nullable":false},{"name":"discount_type","type":"string","description":"Discount logic: 'amount', 'percentage', 'free_shipping', etc.","nullable":false},{"name":"discount_value","type":"double","description":"Discount value (amount/percentage depending on discount_type).","nullable":false},{"name":"min_order_amount","type":"double","description":"Minimum eligible order amount for coupon use.","nullable":true},{"name":"max_discount_amount","type":"double","description":"Maximum discount (for capped percentage types).","nullable":true},{"name":"stackable","type":"boolean","description":"Whether coupon can be stacked with others.","nullable":false},{"name":"exclusive","type":"boolean","description":"If true, coupon is exclusive (cannot be combined).","nullable":false},{"name":"usage_limit_total","type":"int","description":"Total usage cap for this coupon.","nullable":true},{"name":"usage_limit_per_user","type":"int","description":"Per-user usage cap for this coupon.","nullable":true},{"name":"issuance_limit_total","type":"int","description":"Total issuances allowed for this coupon.","nullable":true},{"name":"issued_count","type":"int","description":"Running total of times coupon issued.","nullable":false},{"name":"used_count","type":"int","description":"Running total of times coupon used.","nullable":false},{"name":"issued_at","type":"datetime","description":"Coupon activation/start time.","nullable":true},{"name":"expires_at","type":"datetime","description":"Coupon expiration/end time.","nullable":true},{"name":"business_status","type":"string","description":"Business/lifecycle status (e.g., draft, active, paused, expired, deleted).","nullable":false},{"name":"created_at","type":"datetime","description":"Coupon creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Coupon last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Logical deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["business_status"]},{"fieldNames":["expires_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"description"}]},{"name":"shopping_mall_coupon_issuances","description":"Records actual issuances (allocation or assignment) of coupons to actors (customers, accounts, segments, etc). Each record tracks the actor being granted the coupon, when/for which coupon, issuance status, and context. Used to enforce per-user/segment limits. May be generated in bulk or 1:1 (e.g., single-use). References coupon and optionally customer.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Referenced coupon's {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Recipient actor's {@link shopping_mall_customers.id}. Nullable for public/anonymous cases.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Actual coupon code issued (could be unique per issuance).","nullable":false},{"name":"issued_at","type":"datetime","description":"Time issued.","nullable":false},{"name":"expires_at","type":"datetime","description":"Expiration for this issuance (may differ from base coupon).","nullable":true},{"name":"usage_limit","type":"int","description":"Usage limit for this actor (may override per-user global).","nullable":true},{"name":"used_count","type":"int","description":"Number of times actor has used this issued coupon.","nullable":false},{"name":"status","type":"string","description":"Issuance status (active, expired, redeemed, revoked, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Deletion timestamp (for soft delete, audit).","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_coupon_id","shopping_mall_customer_id"]}],"ginIndexes":[{"fieldName":"status"}]},{"name":"shopping_mall_coupon_usages","description":"Tracks individual coupon usage events. Each record logs coupon and issuance, order context, acting customer, timestamps, and outcome. Used for full audit/analytics, fraud/abuse monitoring, and per-user limit enforcement. Key for analytics, auditing, and operational business rules.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Used coupon's {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons"},"unique":false,"nullable":false},{"name":"shopping_mall_coupon_issuance_id","type":"uuid","description":"Link to exact issuance used {@link shopping_mall_coupon_issuances.id}.","relation":{"name":"issuance","targetModel":"shopping_mall_coupon_issuances"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Order where coupon was used {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer using the coupon {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"used_at","type":"datetime","description":"Usage timestamp.","nullable":false},{"name":"status","type":"string","description":"Usage status: 'applied', 'confirmed', 'revoked', 'failed', etc.","nullable":false},{"name":"discount_amount","type":"double","description":"Actual discount value applied in use event.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_coupon_id","shopping_mall_customer_id","used_at"]}],"ginIndexes":[{"fieldName":"status"}]},{"name":"shopping_mall_coupon_targets","description":"Subsidiary table that defines which entities (channels, sections, categories, sellers, products, customers, etc.) a coupon is eligible to be applied to. Many-to-many mapping supports broad and fine-grained targeting. Not directly exposed to business users, but referenced by coupons and used in eligibility validation. Enables efficient eligibility queries and administration of coupon scope.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Parent coupon {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons"},"unique":false,"nullable":false},{"name":"shopping_mall_channel_id","type":"uuid","description":"Linked channel {@link shopping_mall_channels.id}. Nullable if not scoped.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":true},{"name":"shopping_mall_section_id","type":"uuid","description":"Linked section {@link shopping_mall_sections.id}. Nullable if not scoped.","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":true},{"name":"shopping_mall_channel_category_id","type":"uuid","description":"Linked category {@link shopping_mall_channel_categories.id}. Nullable for global coupons.","relation":{"name":"category","targetModel":"shopping_mall_channel_categories"},"unique":false,"nullable":true},{"name":"shopping_mall_product_id","type":"uuid","description":"Targeted product eligibility {@link shopping_mall_products.id}. Nullable for broader coupons.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Eligible seller {@link shopping_mall_sellers.id}. Nullable for broader coupons.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_customer_id","type":"uuid","description":"Eligible customer {@link shopping_mall_customers.id}. Nullable for segment or global coupons.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true}],"plainFields":[{"name":"target_type","type":"string","description":"Indicates what this row maps to - e.g., 'channel', 'section', 'category', 'product', 'seller', 'customer'.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_coupon_id","target_type"]}],"ginIndexes":[]},{"name":"shopping_mall_coupon_campaigns","description":"Represents an organized campaign grouping one or more coupons under a business concept—promo, seasonal event, collaboration, etc. Stores campaign metadata: name, description, period, business status, and categorical analytics. Coupons may be standalone or linked to a campaign. Campaigns are independently managed via business UI.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"Business-facing campaign name.","nullable":false},{"name":"description","type":"string","description":"Campaign description and terms.","nullable":true},{"name":"starts_at","type":"datetime","description":"Campaign activation/start time.","nullable":true},{"name":"ends_at","type":"datetime","description":"Campaign end/expiration time.","nullable":true},{"name":"business_status","type":"string","description":"Workflow status: draft, active, paused, expired, deleted, etc.","nullable":false},{"name":"created_at","type":"datetime","description":"Campaign creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Campaign update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Logical deletion timestamp, for partitioning and audit.","nullable":true}],"uniqueIndexes":[{"fieldNames":["name"],"unique":true}],"plainIndexes":[{"fieldNames":["business_status"]},{"fieldNames":["starts_at"]},{"fieldNames":["ends_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_coupon_snapshots","description":"Snapshot/history table supporting full point-in-time audit of coupon definitions and all linked configuration and eligibility at every event. Historical/log-audit for every change or status/event affecting main coupon configuration. Used for forensic, rollback, and compliance requests. Not user-editable, append-only, records all pre- and post-change coupon details.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Target coupon {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_type","type":"string","description":"Type of snapshot event: creation, update, status_change, etc.","nullable":false},{"name":"snapshot_data","type":"string","description":"JSON or serialized snapshot data for the coupon and all linked configuration.","nullable":false},{"name":"snapshot_at","type":"datetime","description":"Snapshot creation time.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_coupon_id","snapshot_at"]}],"ginIndexes":[]},{"name":"shopping_mall_coupon_analytics","description":"Materialized view or reporting table for coupons: stores denormalized or pre-aggregated coupon campaign/issuance/usage statistics, trends, and business intelligence metrics. NOT a business object for direct CRUD, but critical for dashboard/query performance. Updated by scheduled/batch jobs only. Examples include coupon utilization rate, issuance-to-redemption ratio, per-segment analytics, etc.","material":true,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Source coupon {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons"},"unique":true,"nullable":false},{"name":"shopping_mall_coupon_campaign_id","type":"uuid","description":"Linked campaign (if any) {@link shopping_mall_coupon_campaigns.id}.","relation":{"name":"campaign","targetModel":"shopping_mall_coupon_campaigns"},"unique":false,"nullable":true}],"plainFields":[{"name":"stat_issued_count","type":"int","description":"Total issued (prefetched/denormalized for analytics).","nullable":false},{"name":"stat_used_count","type":"int","description":"Total used (prefetched/denormalized for analytics).","nullable":false},{"name":"stat_usage_rate","type":"double","description":"Redemption/usage rate (percent of issued redeemed).","nullable":false},{"name":"stat_last_used_at","type":"datetime","description":"Timestamp of most recent use event.","nullable":true},{"name":"stat_last_issued_at","type":"datetime","description":"Timestamp of most recent issuance event.","nullable":true},{"name":"stat_segment_analytics","type":"string","description":"JSON: analytics per segment/target group.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_coupon_id"],"unique":true}],"plainIndexes":[{"fieldNames":["stat_usage_rate"]}],"ginIndexes":[]}]},{"filename":"schema-06-coins.prisma","namespace":"Coins","models":[{"name":"shopping_mall_deposits","description":"Represents each user's digital deposit balance (electronic wallet) in the system. Connects to one customer. Reflects the available deposit coin balance for monetary operations (top-up, spend, refund), with direct linkage to all deposit-related transactions. Snapshot logic ensures regulatory traceability. Used for customer-initiated deposits, refunds, or administrative adjustments. Separate from loyalty program mileages.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged customer's {@link shopping_mall_customers.id}. Each deposit account is tied to one user account.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":true,"nullable":false}],"plainFields":[{"name":"balance","type":"double","description":"Current deposit balance (in system currency units). Always non-negative, may reflect pending operations until settled.","nullable":false},{"name":"status","type":"string","description":"Account status (active, frozen, closed, under_review, etc.) for financial and compliance operations.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the deposit record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last update to the deposit record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp if deposit record is soft-deleted. Null unless deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"shopping_mall_deposit_transactions","description":"Ledger of all deposit coin inflows and outflows for customers. Each record is an evidence for financial audit, compliance, or fraud monitoring. Tied to a deposit account and customer; may reference an order; records business context, amounts, type (income/outcome), status, and reason. Stores timestamps for creation and reversal. Allows tracing for all deposit operations (top-up, spend, admin adjustment, refund, etc.).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_deposit_id","type":"uuid","description":"Associated deposit account {@link shopping_mall_deposits.id}.","relation":{"name":"deposit","targetModel":"shopping_mall_deposits"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Target customer {@link shopping_mall_customers.id}. Always required for user-level ledger/audit.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Linked order transaction (if applicable) {@link shopping_mall_orders.id}. Null if not related to an order.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true}],"plainFields":[{"name":"type","type":"string","description":"Transaction type (income, outcome, refund, admin_adjustment, reversal, etc.)","nullable":false},{"name":"amount","type":"double","description":"Transaction amount (system currency units, positive value).","nullable":false},{"name":"business_status","type":"string","description":"Business-side processing status (applied, confirmed, failed, in_review, reversed, etc.).","nullable":false},{"name":"reason","type":"string","description":"Detailed business reason or description for transaction (top-up, purchase, refund, bonus, manual debit, etc.).","nullable":true},{"name":"evidence_reference","type":"string","description":"Optional reference to evidence, audit record, or snapshot backing this transaction.","nullable":true},{"name":"reversed_at","type":"datetime","description":"If this transaction was reversed/cancelled, indicates the datetime; null otherwise.","nullable":true},{"name":"created_at","type":"datetime","description":"Transaction creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Transaction update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp if the transaction was deleted; null otherwise.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_deposit_id","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]},{"fieldNames":["type","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_mileages","description":"Represents each user's mileage (loyalty/point system) balance. Separate from deposit accounts; mileages are non-cash, generally earned by system/business logic. Linked to a single customer. Used for loyalty, reward, or promotional purposes. Subject to expiration and usage limits. Fully auditable for compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged customer's {@link shopping_mall_customers.id}. Each mileage account is associated with a user.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":true,"nullable":false}],"plainFields":[{"name":"balance","type":"double","description":"Current usable mileage/point balance. Non-negative value representing available loyalty points.","nullable":false},{"name":"status","type":"string","description":"Account status (active, expired, frozen). Indicates current ability to accrue or spend mileage.","nullable":false},{"name":"expired_at","type":"datetime","description":"Datetime when all current mileage expires if not renewed or spent. Used for campaign/bonus mileages with deadlines.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the mileage account was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last update to the mileage account.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp; null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"shopping_mall_mileage_transactions","description":"Complete ledger for all mileage (loyalty point) actions: accrual, spend, expiration, adjustment, bonus, or refund. Tracks every change to user mileage with full evidence for audit and compliance (one record per event). Foreign key links to mileage and customer. May reference an order or campaign. Records status, type, context/reason codes, evidence refs, and timestamps.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_mileage_id","type":"uuid","description":"Associated mileage account {@link shopping_mall_mileages.id}.","relation":{"name":"mileage","targetModel":"shopping_mall_mileages"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Target customer {@link shopping_mall_customers.id}. Always required for user-level audit.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Linked order (if associated) {@link shopping_mall_orders.id}. Null if not related to a specific order.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true}],"plainFields":[{"name":"type","type":"string","description":"Transaction type (accrual, spend, expiration, bonus, adjustment, refund, etc.).","nullable":false},{"name":"amount","type":"double","description":"Mileage value for this transaction (positive for accrual/bonus, negative for spend/expiration).","nullable":false},{"name":"business_status","type":"string","description":"Processing/business status: applied, confirmed, failed, expired, reversed, in_review, etc.","nullable":false},{"name":"reason","type":"string","description":"Optional business reason, event, or note (promo, adjustment, campaign, system grant, manual, etc.).","nullable":true},{"name":"evidence_reference","type":"string","description":"Optional reference to compliance, audit, or related snapshot for the event.","nullable":true},{"name":"reversed_at","type":"datetime","description":"Datetime if this event was reversed/cancelled. Null otherwise.","nullable":true},{"name":"created_at","type":"datetime","description":"Datetime for event creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Datetime when this event was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp if event was deleted. Null otherwise.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_mileage_id","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]},{"fieldNames":["type","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_donations","description":"Tracks all donation events using deposit/mileage by customers. Each record captures donor, value, type (deposit or mileage), donation target/campaign (external lookup or campaign id), status, datetime, and evidence info for transparency, compliance, and analytics. Supports both deposit and mileage as sources. Used for audit, fraud prevention, campaign reporting, and regulatory evidence.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Donating customer {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"source_type","type":"string","description":"Type of the donation source (deposit, mileage). Determines if donation was made from deposit or mileage balance.","nullable":false},{"name":"source_entity_id","type":"uuid","description":"Foreign key to the related deposit or mileage account (shopping_mall_deposits.id or shopping_mall_mileages.id).","nullable":false},{"name":"target_campaign_code","type":"string","description":"The code or business key for the destination campaign/event receiving the donation.","nullable":false},{"name":"amount","type":"double","description":"Donation amount (currency units for deposit, point units for mileage). Must be non-negative.","nullable":false},{"name":"status","type":"string","description":"Donation status (pending, confirmed, failed, refunded, under_review, etc.).","nullable":false},{"name":"evidence_reference","type":"string","description":"Optional link to evidence record, snapshot, compliance request.","nullable":true},{"name":"donated_at","type":"datetime","description":"Datetime donation was made.","nullable":false},{"name":"created_at","type":"datetime","description":"Datetime record was created (may differ from donated_at for backfill/correction).","nullable":false},{"name":"updated_at","type":"datetime","description":"Datetime record was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp for the donation entry, if any. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["source_entity_id","donated_at"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]},{"fieldNames":["target_campaign_code"]}],"ginIndexes":[{"fieldName":"evidence_reference"}]},{"name":"shopping_mall_coin_snapshots","description":"System/state snapshot table recording complete states of all deposit and mileage accounts at one point in time for audit, compliance, regulatory reporting, or recovery purposes. Stores entity id, entity type (deposit/mileage), pre/post balance, timestamp, trigger info (system maintenance, audit, campaign event), and evidence chain data. Used for audit trails and regulatory proofs. Not directly manipulated by end users.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"entity_id","type":"uuid","description":"Entity (deposit or mileage) being snapshotted: points to shopping_mall_deposits.id or shopping_mall_mileages.id. This is a business reference to an external table; not a Prisma model relation. Type is uuid for compatibility and traceability.","nullable":false},{"name":"entity_type","type":"string","description":"Type of the snapshotted entity (deposit or mileage).","nullable":false},{"name":"balance_before","type":"double","description":"Account balance before snapshot event.","nullable":false},{"name":"balance_after","type":"double","description":"Account balance after snapshot event.","nullable":false},{"name":"snapshot_trigger","type":"string","description":"Reason or business event that triggered the snapshot (system_audit, compliance, campaign, refund, etc.).","nullable":false},{"name":"evidence_reference","type":"string","description":"Optional referential link to audit/compliance/maintenance event or document.","nullable":true},{"name":"created_at","type":"datetime","description":"Datetime the snapshot was taken.","nullable":false},{"name":"updated_at","type":"datetime","description":"Datetime the snapshot record was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp, null unless the snapshot itself is nullified for business policy.","nullable":true}],"uniqueIndexes":[{"fieldNames":["entity_id","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["entity_type"]},{"fieldNames":["snapshot_trigger"]}],"ginIndexes":[{"fieldName":"evidence_reference"}]}]},{"filename":"schema-07-inquiries-articles.prisma","namespace":"InquiriesArticles","models":[{"name":"shopping_mall_boards","description":"Forum/board structure for channel/section, supporting product Q&A, reviews, UGC. Board creation, visibility, moderation permissions, and linkage to channel/section (by FK). Segmentation enables different boards per channel/section; anchor for all board-based content and moderation.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Belonged channel’s {@link shopping_mall_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_section_id","type":"uuid","description":"Belonged section’s {@link shopping_mall_sections.id}.","relation":{"name":"section","targetModel":"shopping_mall_sections"},"unique":false,"nullable":true}],"plainFields":[{"name":"title","type":"string","description":"Board display name/title.","nullable":false},{"name":"description","type":"string","description":"Explanation/purpose of the board (Markdown supported).","nullable":true},{"name":"visibility","type":"string","description":"Board visibility: public, private, channel-restricted, or section-restricted.","nullable":false},{"name":"moderation_required","type":"boolean","description":"Whether all posts need moderation before publication.","nullable":false},{"name":"post_expiry_days","type":"int","description":"Days until posts are auto-archived/expire (nullable).","nullable":true},{"name":"created_at","type":"datetime","description":"Time the board record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Time this record was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete time, null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_channel_id","title"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_section_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"title"}]},{"name":"shopping_mall_board_posts","description":"Posts/articles/respondable threads in boards. Created by any role, linked to board, optionally to products/orders. Full multi-role authorship, moderation and reply threading. Supports independent management and search.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_board_id","type":"uuid","description":"Associated board’s {@link shopping_mall_boards.id}.","relation":{"name":"board","targetModel":"shopping_mall_boards"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"If author is customer, link to {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"If author is seller, link to {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"If author is admin, link to {@link shopping_mall_admins.id}.","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true},{"name":"shopping_mall_parent_post_id","type":"uuid","description":"Reply of/parent (self-ref).","relation":{"name":"parentPost","targetModel":"shopping_mall_board_posts","mappingName":"recursive"},"unique":false,"nullable":true},{"name":"shopping_mall_product_id","type":"uuid","description":"Linked product’s {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Linked order’s {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true}],"plainFields":[{"name":"title","type":"string","description":"Post or article title.","nullable":true},{"name":"body","type":"string","description":"Main content (Markdown/HTML).","nullable":false},{"name":"reply_level","type":"int","description":"Thread depth (0=starter).","nullable":false},{"name":"is_official_answer","type":"boolean","description":"True if post is an official (admin/seller) answer.","nullable":false},{"name":"visibility","type":"string","description":"Visibility: public, registered-users, private, etc.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation: pending, approved, denied, etc.","nullable":false},{"name":"moderation_reason","type":"string","description":"Explanation for moderation state (optional).","nullable":true},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_board_id","title","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_board_id"]},{"fieldNames":["shopping_mall_parent_post_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_board_post_snapshots","description":"Snapshots preserving all mutable fields for each board post mutation (edit/moderation, etc). Immutable history for legal compliance and audit. Snapshots reference their parent post.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_board_post_id","type":"uuid","description":"Snapshot of board post {@link shopping_mall_board_posts.id}.","relation":{"name":"boardPost","targetModel":"shopping_mall_board_posts"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Title at snapshot time.","nullable":true},{"name":"body","type":"string","description":"Content at snapshot time.","nullable":false},{"name":"reply_level","type":"int","description":"Thread depth at snapshot time.","nullable":false},{"name":"is_official_answer","type":"boolean","description":"Official answer flag at snapshot.","nullable":false},{"name":"visibility","type":"string","description":"Visibility at snapshot time.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation state at snapshot time.","nullable":false},{"name":"moderation_reason","type":"string","description":"Moderation reason at snapshot time (nullable).","nullable":true},{"name":"snapshot_reason","type":"string","description":"Reason for snapshot (edit, moderation, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_board_post_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_product_inquiries","description":"Inquiries (Q&A) regarding products. Authored by customer/seller. Direct linkage to product and actor/role; supports official response, privacy, and moderation. Supports audit trails and batch solutions.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Related product’s {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"If inquirer is customer, link to {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"If inquirer is seller, link to {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true}],"plainFields":[{"name":"title","type":"string","description":"Inquiry summary/title.","nullable":true},{"name":"body","type":"string","description":"Full inquiry content.","nullable":false},{"name":"is_private","type":"boolean","description":"Visibility restriction to only author and responders.","nullable":false},{"name":"answered","type":"boolean","description":"True when an answer is posted.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation state: pending, approved, etc.","nullable":false},{"name":"created_at","type":"datetime","description":"Inquiry created at.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","body"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]},{"fieldNames":["shopping_mall_seller_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_inquiry_answers","description":"Answers to product inquiries by sellers/admins. Supports official answer flag, independent moderation, and notification link. Linked to original inquiry and multi-role author. Moderation life-cycle and compliance supported.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_inquiry_id","type":"uuid","description":"Inquiry being answered {@link shopping_mall_product_inquiries.id}.","relation":{"name":"inquiry","targetModel":"shopping_mall_product_inquiries"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Responder if seller {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"Responder if admin {@link shopping_mall_admins.id}.","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"body","type":"string","description":"Answer body.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation: pending, approved, etc.","nullable":false},{"name":"official_answer","type":"boolean","description":"Official answer for the inquiry.","nullable":false},{"name":"notified_at","type":"datetime","description":"When customer notified (nullable).","nullable":true},{"name":"created_at","type":"datetime","description":"Answer created at.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated at.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_inquiry_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_reviews","description":"Product reviews by customers/sellers for compliance and UGC. Links to product and order, supports unique (product,order,customer) constraint, moderation and notification workflow. Key compliance artifact for consumer protection.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Reviewed product {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Reviewer (customer) {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Reviewer (seller) {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true}],"plainFields":[{"name":"rating","type":"int","description":"Stars/points integer rating (typ. 1-5).","nullable":false},{"name":"title","type":"string","description":"Title/headline for the review.","nullable":true},{"name":"body","type":"string","description":"Full review content.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation: pending, approved, etc.","nullable":false},{"name":"notified_at","type":"datetime","description":"Notification timestamp (optional).","nullable":true},{"name":"created_at","type":"datetime","description":"Review creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modification time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","shopping_mall_order_id","shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["moderation_status"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_review_snapshots","description":"All historic versions of a review, recording moderation/notification state for audit/legal recovery.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Snapshot for review {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":false}],"plainFields":[{"name":"rating","type":"int","description":"Snapshot of rating at this point in time.","nullable":false},{"name":"title","type":"string","description":"Title at this snapshot.","nullable":true},{"name":"body","type":"string","description":"Review body at this snapshot.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation at this snapshot.","nullable":false},{"name":"notified_at","type":"datetime","description":"Notification state at this snapshot.","nullable":true},{"name":"snapshot_reason","type":"string","description":"Why snapshot was captured.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot created.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_review_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_comments","description":"Threaded comments on posts/inquiries/reviews, multi-role authorship. Each comment may reference a board post, inquiry, or review, and have threaded replies. Moderation and notification. Cross-entity searchable, created/managed independently.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_board_post_id","type":"uuid","description":"Board post being commented on {@link shopping_mall_board_posts.id}.","relation":{"name":"boardPost","targetModel":"shopping_mall_board_posts"},"unique":false,"nullable":true},{"name":"shopping_mall_product_inquiry_id","type":"uuid","description":"Product inquiry being commented on {@link shopping_mall_product_inquiries.id}.","relation":{"name":"productInquiry","targetModel":"shopping_mall_product_inquiries"},"unique":false,"nullable":true},{"name":"shopping_mall_review_id","type":"uuid","description":"Review being commented on {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":true},{"name":"shopping_mall_parent_comment_id","type":"uuid","description":"Parent comment (self-reference) if reply.","relation":{"name":"parentComment","targetModel":"shopping_mall_comments","mappingName":"recursive"},"unique":false,"nullable":true},{"name":"shopping_mall_customer_id","type":"uuid","description":"Authored by customer {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Authored by seller {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"Authored by admin {@link shopping_mall_admins.id}.","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"body","type":"string","description":"Comment text (Markdown supported).","nullable":false},{"name":"level","type":"int","description":"Thread level of comment (root=0).","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation state (pending/approved/etc.).","nullable":false},{"name":"moderation_reason","type":"string","description":"Reason for moderation state (optional).","nullable":true},{"name":"created_at","type":"datetime","description":"Created at timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deleted timestamp (null if active).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_board_post_id"]},{"fieldNames":["shopping_mall_product_inquiry_id"]},{"fieldNames":["shopping_mall_review_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_comment_snapshots","description":"All changes to each comment, for audit/dispute/evidence. Historical snapshot of body, status, and moderation info.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_comment_id","type":"uuid","description":"Original comment {@link shopping_mall_comments.id}.","relation":{"name":"comment","targetModel":"shopping_mall_comments"},"unique":false,"nullable":false}],"plainFields":[{"name":"body","type":"string","description":"Body of comment at snapshot.","nullable":false},{"name":"level","type":"int","description":"Level at snapshot.","nullable":false},{"name":"moderation_status","type":"string","description":"Moderation status at snapshot.","nullable":false},{"name":"moderation_reason","type":"string","description":"Reason for moderation (optional).","nullable":true},{"name":"snapshot_reason","type":"string","description":"Why snapshot taken (edit, moderation, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_comment_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_post_attachments","description":"Link table that attaches files to posts/reviews/comments. References posts, reviews, comments, and the global attachment table (FK to attachments); used for audit/evidence and display. Managed only through parent entity change (not independent CRUD).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_board_post_id","type":"uuid","description":"Attached post’s {@link shopping_mall_board_posts.id}.","relation":{"name":"boardPost","targetModel":"shopping_mall_board_posts"},"unique":false,"nullable":true},{"name":"shopping_mall_review_id","type":"uuid","description":"Attached review’s {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":true},{"name":"shopping_mall_comment_id","type":"uuid","description":"Attached comment's {@link shopping_mall_comments.id}.","relation":{"name":"comment","targetModel":"shopping_mall_comments"},"unique":false,"nullable":true},{"name":"shopping_mall_attachment_id","type":"uuid","description":"Attachment (file) record {@link shopping_mall_attachments.id}.","relation":{"name":"attachment","targetModel":"shopping_mall_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"usage_type","type":"string","description":"How the attachment is used: post_image, review_evidence, comment_media, etc.","nullable":false},{"name":"sort_order","type":"int","description":"Order among entity’s attachments.","nullable":false},{"name":"created_at","type":"datetime","description":"When attached.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_board_post_id"]},{"fieldNames":["shopping_mall_review_id"]},{"fieldNames":["shopping_mall_comment_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-08-favorites.prisma","namespace":"Favorites","models":[{"name":"shopping_mall_favorite_products","description":"Represents a product favorited by a customer. Stores reference to the favored product (from shopping_mall_products), the customer who favorited it (from shopping_mall_customers), and the immutable snapshot representing the product state at time of favoriting. Supports audit fields, soft deletion, notification trigger flag, and batch operation meta. Enforces uniqueness per customer-product pair. Enables user personalization and downstream AI analysis. Key foreign relations to {@link shopping_mall_customers.id}, {@link shopping_mall_products.id}, and {@link shopping_mall_favorite_snapshots.id}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Favoriting customer's {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Favorited product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_favorite_snapshot_id","type":"uuid","description":"Snapshot at point of favoriting. {@link shopping_mall_favorite_snapshots.id}.","relation":{"name":"favoriteSnapshot","targetModel":"shopping_mall_favorite_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"notification_enabled","type":"boolean","description":"Whether notifications are enabled for entity changes after favoriting.","nullable":false},{"name":"batch_label","type":"string","description":"Optional custom label/tag for user batch operation (e.g., organizing favorites).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when favorite was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when favorite was last updated (meta change, not favorite entity).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp of logical deletion (null if active). Enables soft delete for auditability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","shopping_mall_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"batch_label"}]},{"name":"shopping_mall_favorite_addresses","description":"Represents a user-favorited address. Links to customer (from shopping_mall_customers), to the address entity (from shopping_mall_addresses — assumed present in external tables), and to an immutable favorite snapshot at favoriting time. Supports notification flag, audit fields, optional organization label, and batch management support. Enforces unique favorite per customer per address. Audit-supporting, snapshot-enabled, user-controllable entity for personalization and history.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Favoriting customer's {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_favorite_snapshot_id","type":"uuid","description":"Snapshot at favorite action time. {@link shopping_mall_favorite_snapshots.id}.","relation":{"name":"favoriteSnapshot","targetModel":"shopping_mall_favorite_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"shopping_mall_address_id","type":"uuid","description":"Favorited address's business id (UUID reference to address system, not a Prisma model relation).","nullable":false},{"name":"notification_enabled","type":"boolean","description":"Whether notifications (e.g., address update, delivery event) are enabled.","nullable":false},{"name":"batch_label","type":"string","description":"User-given organizational label/tag for this favorite.","nullable":true},{"name":"created_at","type":"datetime","description":"Favorite creation datetime.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update to favorite (meta, not address entity).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if deleted, null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","shopping_mall_address_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"batch_label"}]},{"name":"shopping_mall_favorite_inquiries","description":"Captures a user-favorited inquiry (product Q&A). Links customer (from shopping_mall_customers), inquiry (from shopping_mall_product_inquiries), and favorite snapshot (from shopping_mall_favorite_snapshots). Enables independent management, cross-inquiry search, and notification upon changes/upstream answer. Supports label/tag, audit fields, notification preference, soft deletion, and batch operation. Uniqueness enforced per customer-inquiry pair.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Favoriting customer's {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_product_inquiry_id","type":"uuid","description":"Favorited inquiry's {@link shopping_mall_product_inquiries.id}.","relation":{"name":"productInquiry","targetModel":"shopping_mall_product_inquiries"},"unique":false,"nullable":false},{"name":"shopping_mall_favorite_snapshot_id","type":"uuid","description":"Snapshot at the moment of favoriting. {@link shopping_mall_favorite_snapshots.id}.","relation":{"name":"favoriteSnapshot","targetModel":"shopping_mall_favorite_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"notification_enabled","type":"boolean","description":"Enable notifications when the inquiry or its answer changes.","nullable":false},{"name":"batch_label","type":"string","description":"Optional user-defined favorite organization label.","nullable":true},{"name":"created_at","type":"datetime","description":"Datetime favorited.","nullable":false},{"name":"updated_at","type":"datetime","description":"Datetime last meta update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp of logical (soft) delete. Null if still active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","shopping_mall_product_inquiry_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"batch_label"}]},{"name":"shopping_mall_favorite_snapshots","description":"Snapshot record capturing the full immutable state of any favorited entity (product, address, inquiry) at the time it was favorited. Used to preserve historical evidence for personalization, audit, compliance, or dispute. Enables reconstruction of favorited state even if upstream entity is later changed or removed. Includes the favorited entity's raw business data, snapshot type (product/address/inquiry), foreign keys (nullable, since snapshot may persist beyond entity lifetime), and temporal/audit fields. All favorites reference their associated snapshot for rollback and evidence purpose.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Referenced product (if snapshotting a product), from {@link shopping_mall_products.id}. Nullable after source deletion.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":true},{"name":"shopping_mall_product_inquiry_id","type":"uuid","description":"Referenced product inquiry, from {@link shopping_mall_product_inquiries.id}. Nullable.","relation":{"name":"productInquiry","targetModel":"shopping_mall_product_inquiries"},"unique":false,"nullable":true}],"plainFields":[{"name":"shopping_mall_address_id","type":"uuid","description":"Referenced address's UUID from address system (not a Prisma relation). Used for external reference or after deletion of original entity.","nullable":true},{"name":"entity_type","type":"string","description":"Type of favorited entity: 'product', 'address', or 'inquiry'.","nullable":false},{"name":"snapshot_data","type":"string","description":"Full business data of the entity at time of favoriting as serialized JSON (immutable evidence).","nullable":false},{"name":"created_at","type":"datetime","description":"When snapshot was created (favorited).","nullable":false},{"name":"deleted_at","type":"datetime","description":"If snapshot is logically deleted (rare, e.g., for GDPR erase), timestamp here.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["entity_type","created_at"]}],"ginIndexes":[{"fieldName":"snapshot_data"}]}]},{"filename":"schema-09-attachments.prisma","namespace":"Attachments","models":[{"name":"shopping_mall_attachments","description":"Primary attachment record containing core file meta-data and high-level auditability. Represents the business-unique file with links to versioned content, and supports logical deletion and evidence preservation. Shared by all business domains via generic entity associations. References {@link shopping_mall_attachment_versions} for actual file versions. All access and evidence policies enforced at this level.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"filename","type":"string","description":"Original or user-assigned file name including extension, used for display and file tracking.","nullable":false},{"name":"file_extension","type":"string","description":"File extension including the dot (e.g., .jpg, .pdf) for rapid filtering and display logic.","nullable":false},{"name":"mime_type","type":"string","description":"MIME type for uploaded file (e.g., image/png, application/pdf), determines handling/serving logic.","nullable":false},{"name":"size_bytes","type":"int","description":"Size of file in bytes. Used for storage/cost calculations, quota enforcement.","nullable":false},{"name":"server_url","type":"uri","description":"Direct storage URL or CDN-cached URI for download access, with compliance and geo-sensitive policies.","nullable":false},{"name":"public_accessible","type":"boolean","description":"Whether this attachment is public (true) or access-restricted (false). Used for secure vs. public access control.","nullable":false},{"name":"permission_scope","type":"string","description":"Business-defined string tag describing role, group, or domain-specific access scope (e.g., 'admin_only', 'seller', 'customer', 'audit_only').","nullable":true},{"name":"logical_source","type":"string","description":"Describes the business module or origin context for system-generated clarity (e.g. 'product', 'board_post', 'order', etc).","nullable":true},{"name":"hash_md5","type":"string","description":"MD5 or other strong hash for file integrity validation and dedup checks.","nullable":false},{"name":"description","type":"string","description":"Optional human-readable note or context field for file, visible in file managers or audit trails.","nullable":true},{"name":"created_at","type":"datetime","description":"Date and time when the attachment was registered/uploaded.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last modification (meta or any versioning event). Required for audit and review.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Time when soft delete was performed (null if still active). Required for logical deletion and audit compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["hash_md5"],"unique":true}],"plainIndexes":[{"fieldNames":["mime_type"]},{"fieldNames":["created_at"]},{"fieldNames":["deleted_at"]}],"ginIndexes":[{"fieldName":"filename"}]},{"name":"shopping_mall_attachment_versions","description":"Versioned content for attachments. Tracks each upload/modification, with cryptographic integrity, CDN/file URL, uploader, and metadata. Ensures complete file trail for evidence, supporting legal rollback and role-based audit access. Links to main attachment via {@link shopping_mall_attachments.id}. Supports logical deletion and time-stamped audit. Each version is immutable.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_attachment_id","type":"uuid","description":"Belonged master attachment's {@link shopping_mall_attachments.id}.","relation":{"name":"attachment","targetModel":"shopping_mall_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"version_number","type":"int","description":"Attachment version (1-based sequence). Increments for each new file upload/revision.","nullable":false},{"name":"uploader_id","type":"uuid","description":"User or system ID of actor who uploaded/replaced this version. Must reference customer, seller, or admin in upstream user tables.","nullable":false},{"name":"filename","type":"string","description":"Captured at time of upload, may differ from current name if renamed later.","nullable":false},{"name":"file_extension","type":"string","description":"Extension at time of this upload, supports historical context for audit or filter.","nullable":false},{"name":"mime_type","type":"string","description":"Mime type of file version for compliance and context.","nullable":false},{"name":"size_bytes","type":"int","description":"File size in bytes for this version at upload; never changes.","nullable":false},{"name":"server_url","type":"uri","description":"Permanent CDN/URI location for this file version, required for evidence chain.","nullable":false},{"name":"hash_md5","type":"string","description":"Strong hash, guarantees cryptographic integrity checks for versioned file.","nullable":false},{"name":"created_at","type":"datetime","description":"When this file version was uploaded, required for full audit trail.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time. Null if not deleted. For evidence lifecycle management.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_attachment_id","version_number"],"unique":true},{"fieldNames":["hash_md5"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["deleted_at"]}],"ginIndexes":[{"fieldName":"filename"}]},{"name":"shopping_mall_entity_attachment_links","description":"Associates any business entity (via entity UUID and type/discriminator) to an attachment. Enables attachment/evidence linkage to products, posts, orders, reviews, or any arbitrary or future entity. Supports audit, permission, and evidence management. Includes meta fields for entity type, user context, purpose, and logical deletion.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_attachment_id","type":"uuid","description":"Linked attachment's {@link shopping_mall_attachments.id}.","relation":{"name":"attachment","targetModel":"shopping_mall_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"entity_type","type":"string","description":"String discriminator (e.g., 'product', 'order', 'review', 'board_post', etc.) allowing universal linkage.","nullable":false},{"name":"entity_id","type":"uuid","description":"UUID primary key of the attached business entity. Must always reference a valid business object in the system, but no direct FK for global extensibility.","nullable":false},{"name":"linked_by_user_id","type":"uuid","description":"User who performed or authorized the link. Supports audit trails and role-based control.","nullable":false},{"name":"purpose","type":"string","description":"Describes context or purpose of attachment (e.g., 'evidence', 'thumbnail', 'document').","nullable":true},{"name":"visible_to_roles","type":"string","description":"Comma-separated string of role/group codes having access (e.g., 'admin,seller,customer'). Used for permission/notification logic. Null for universal visibility.","nullable":true},{"name":"created_at","type":"datetime","description":"Link creation time/audit beginning.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion record for link (null = still active). Required for logical audit/compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["entity_type","entity_id","shopping_mall_attachment_id"],"unique":true}],"plainIndexes":[{"fieldNames":["entity_type","entity_id"]},{"fieldNames":["linked_by_user_id"]},{"fieldNames":["created_at"]},{"fieldNames":["deleted_at"]}],"ginIndexes":[]}]},{"filename":"schema-10-snapshots.prisma","namespace":"Snapshots","models":[{"name":"shopping_mall_entity_snapshots","description":"Universal snapshot table capturing entity state at the time of a business event (creation, modification, deletion, etc.). Provides immutable evidence for any critical entity in the system (e.g., user, product, order, review) as required by compliance and audit. Polymorphic references to entity_type and entity_id support cross-domain usage. Used for rollback, forensic analysis, audit queries, and regulatory/legal requirements. Typically referenced by domain entities for evidence or versioning.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"entity_type","type":"string","description":"Type of the referenced business entity (e.g., 'customer', 'product', 'order', etc.). Used for polymorphic association and traceability across domains.","nullable":false},{"name":"entity_id","type":"uuid","description":"ID of the referenced business entity. Combined with entity_type ensures universal coverage and uniqueness.","nullable":false},{"name":"snapshot_reason","type":"string","description":"Reason for snapshot capture (e.g., creation, update, deletion, compliance event). Business event context, for audit/evidence trace.","nullable":false},{"name":"snapshot_actor_id","type":"uuid","description":"Actor performing/triggering the event. May reference user/admin/seller IDs or system processes. Provides regulatory traceability.","nullable":true},{"name":"snapshot_data","type":"string","description":"Serialized (e.g., JSON) representation of the captured entity state at snapshot time. Used for evidence and rollback.","nullable":false},{"name":"event_time","type":"datetime","description":"Business event timestamp (when the snapshot was recorded). Distinct from created_at for system-level event ordering.","nullable":false},{"name":"created_at","type":"datetime","description":"Entity creation timestamp (when this snapshot record itself was created).","nullable":false},{"name":"updated_at","type":"datetime","description":"Entity last update timestamp (if ever modified, e.g., for evidence chain correction or annotation).","nullable":false}],"uniqueIndexes":[{"fieldNames":["entity_type","entity_id","event_time"],"unique":true}],"plainIndexes":[{"fieldNames":["entity_type","entity_id"]},{"fieldNames":["snapshot_actor_id"]},{"fieldNames":["event_time"]}],"ginIndexes":[{"fieldName":"snapshot_data"}]},{"name":"shopping_mall_audit_logs","description":"Cross-domain, general-purpose audit log table capturing all significant business events or actions affecting any entity in the system. Tracks event type, the affected entity (entity_type & entity_id), actor, result, and supporting snapshot IDs as available. Supports compliance, business rule tracing, security, and real-time monitoring.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"entity_type","type":"string","description":"Type of the entity involved in the audit event (polymorphic, e.g., 'order', 'product', 'customer').","nullable":false},{"name":"entity_id","type":"uuid","description":"ID of the entity involved in the audit event (polymorphic association).","nullable":false},{"name":"event_type","type":"string","description":"Type/category of event (e.g., create, update, delete, login, permission_granted, error, workflow_transition, business_rule_eval, etc.). Used for filtering and security audit.","nullable":false},{"name":"actor_id","type":"uuid","description":"User/admin/seller or system process that performed/triggered the event. Used for accountability and forensics.","nullable":true},{"name":"snapshot_id","type":"uuid","description":"Optional reference to the associated snapshot (if relevant to this audit event or state change). May be null for system-level events.","nullable":true},{"name":"event_result","type":"string","description":"Result of the audited event (e.g., success, failure, denied, completed, partial, error code). Human/machine readable for business trace/audit.","nullable":false},{"name":"event_message","type":"string","description":"Detailed message or context (structured or free-form) about the event itself (e.g. error details, input parameters, automated reasoning).","nullable":true},{"name":"event_time","type":"datetime","description":"When this audited event occurred (precise business event time).","nullable":false},{"name":"created_at","type":"datetime","description":"Time when this audit log record was written (system timestamp).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["entity_type","entity_id"]},{"fieldNames":["actor_id"]},{"fieldNames":["event_type"]},{"fieldNames":["event_time"]}],"ginIndexes":[{"fieldName":"event_message"}]},{"name":"shopping_mall_deletion_events","description":"Tracks and evidences logical deletion (soft delete) events for any managed entity in the system. Provides regulatory auditability for removal actions, including type of entity, entity ID, actor, reason, and snapshot reference. Not user-facing; used for compliance, data retention enforcement, and legal evidence chains.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"entity_type","type":"string","description":"Type of entity affected by deletion (polymorphic, e.g., 'product', 'order', 'review').","nullable":false},{"name":"entity_id","type":"uuid","description":"ID of the entity deleted (polymorphic, uniquely identifies the record).","nullable":false},{"name":"deleted_by_id","type":"uuid","description":"Actor (user/admin/system) who performed the delete operation. Audit chain support for regulatory evidence.","nullable":true},{"name":"deletion_reason","type":"string","description":"Business or system reason for deletion (e.g., user request, policy violation, auto-expiry, admin action). Critical for data retention/trace.","nullable":false},{"name":"snapshot_id","type":"uuid","description":"Reference to the snapshot capturing the entity state at or before deletion. Critical for evidence/audit.","nullable":true},{"name":"deleted_at","type":"datetime","description":"Timestamp of when entity was marked deleted (logical deletion). Serves compliance/audit needs.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation time for the deletion event (system timestamp).","nullable":false}],"uniqueIndexes":[{"fieldNames":["entity_type","entity_id"],"unique":true}],"plainIndexes":[{"fieldNames":["deleted_by_id"]},{"fieldNames":["deleted_at"]}],"ginIndexes":[]}]}]}