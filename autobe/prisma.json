{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"ai_commerce_channels","description":"Represents a sales channel (e.g., web, mobile app, partner portal) within the commerce platform. Supports configuration for unique business rules, localization, activation, and channel-specific analytics. Channels act as the top-level context for sections, categories, and templates, and link to analytics and settings via FKs.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique business identifier code for the channel. Cannot be changed after creation.","nullable":false},{"name":"name","type":"string","description":"Human-readable channel name (e.g., 'Korea Main Portal').","nullable":false},{"name":"locale","type":"string","description":"Default locale (e.g., 'ko-KR', 'en-US'). Defines language and formatting for this channel.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether the channel is currently active and visible for business operations.","nullable":false},{"name":"business_status","type":"string","description":"Current business-specific status or workflow stage for the channel (e.g., 'normal', 'pending audit', 'archived').","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for channel creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last channel update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete field for logical removal; null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["locale"]},{"fieldNames":["is_active"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_channel_settings","description":"Holds additional configuration properties for each channel, such as custom branding, external endpoints, feature toggles, or advanced rules. Each row references a channel, providing extensibility and modular configuration management. Managed primarily by administrators.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_channel_id","type":"uuid","description":"Parent channel's {@link ai_commerce_channels.id}. Establishes a 1:N relationship to support multiple settings per channel.","relation":{"name":"channel","targetModel":"ai_commerce_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"key","type":"string","description":"Configuration key name (e.g., 'feature_discount_enabled', 'theme_color').","nullable":false},{"name":"value","type":"string","description":"Value for configuration key. May be text, URI, or serialized settings (depending on business logic).","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when setting was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when setting was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete for logical removal; null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["ai_commerce_channel_id","key"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"key"}]},{"name":"ai_commerce_sections","description":"Defines sections or merchandising areas within a channel (e.g., 'Electronics', 'Flash Deals'). Represents logical groupings beneath channels for product curation, configuration, and personalized displays. Used by both admin and AI systems. Hierarchically independent of categories.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_channel_id","type":"uuid","description":"Parent channel's {@link ai_commerce_channels.id}. Each section belongs to one channel.","relation":{"name":"channel","targetModel":"ai_commerce_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Unique code for section per channel. Used for internal references, must be unique within the parent channel.","nullable":false},{"name":"name","type":"string","description":"Display name for the section (e.g., 'Deals', 'Main Banner').","nullable":false},{"name":"is_active","type":"boolean","description":"Section operational status; inactive sections are hidden from users.","nullable":false},{"name":"business_status","type":"string","description":"Business workflow status for the section (e.g., 'normal', 'archived', 'pending').","nullable":false},{"name":"sort_order","type":"int","description":"Display sort order for this section within the channel.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the section.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modification timestamp for the section.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for logical removal; null if section is active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["ai_commerce_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active"]},{"fieldNames":["sort_order"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_categories","description":"Defines product categories as a tree structure, supporting arbitrary hierarchy depths. Categories are mapped to channels and used for discovery, filtering, analytics, and business rule enforcement. Preserves referential integrity for parent-child relationships and supports soft deletion and audit trails.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_channel_id","type":"uuid","description":"Parent channel for this category. Reference to {@link ai_commerce_channels.id}.","relation":{"name":"channel","targetModel":"ai_commerce_channels"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional self-reference to parent category (for hierarchy). Null for top-level categories. {@link ai_commerce_categories.id}.","relation":{"name":"parent","targetModel":"ai_commerce_categories","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique category code per channel, used for internal mapping.","nullable":false},{"name":"name","type":"string","description":"Display name for the category (e.g., 'Accessories').","nullable":false},{"name":"level","type":"int","description":"Hierarchy depth level (0 for root/top-level).","nullable":false},{"name":"sort_order","type":"int","description":"Order within siblings for display purposes.","nullable":false},{"name":"is_active","type":"boolean","description":"Indicates whether the category is active/visible.","nullable":false},{"name":"business_status","type":"string","description":"Business or workflow status (e.g., 'active', 'archived').","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the category.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modification timestamp for the category.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete for logical removal; null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["ai_commerce_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_section_templates","description":"Reusable section configuration templates, allowing administrators to rapidly define and propagate merchandising/grouping setup across channels. Templates capture configuration presets, default status, and metadata for AI-powered or manual section setup.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique template identifier code.","nullable":false},{"name":"name","type":"string","description":"Human-friendly name of the section template.","nullable":false},{"name":"template_data","type":"string","description":"Serialized configuration data (JSON or similar) representing the structure and rules of the template.","nullable":false},{"name":"is_default","type":"boolean","description":"Marks templates as system default for rapid section creation.","nullable":false},{"name":"business_status","type":"string","description":"Current business or operational workflow status for the template.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for template creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last template update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete; null for active templates.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_category_templates","description":"Reusable configuration templates for category trees or segments. Enable cross-channel or multi-project reuse, bulk creation, and rapid curation of category schemas. Serves as blueprint for consistent category organization and AI/analytical applications.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique template identifier for the category template.","nullable":false},{"name":"name","type":"string","description":"Human-readable name for the template (e.g., 'Electronics Default', 'Fashion Segments').","nullable":false},{"name":"template_data","type":"string","description":"Serialized configuration data for the category tree structure (e.g., JSON blob).","nullable":false},{"name":"is_default","type":"boolean","description":"True if this template is the default offering for new category setups.","nullable":false},{"name":"business_status","type":"string","description":"Operational workflow or approval status of the template.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp of template creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp for this template.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete for logical removal; null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_business_rule_templates","description":"Template entities allowing business administrators to author, version, and deploy business rules or logic (e.g., eligibility, promotional, compliance rules). Templates may be attached to channels, sections, or categories, providing modular, versioned logic for core flows. Records always have temporal fields and are versioned for audit.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Business rule template code (unique).","nullable":false},{"name":"name","type":"string","description":"Display name of the template.","nullable":false},{"name":"version","type":"int","description":"Semantic version number for rule template iteration.","nullable":false},{"name":"template_data","type":"string","description":"Serialized rules in config format (JSON/YAML/business rule DSL).","nullable":false},{"name":"business_status","type":"string","description":"Status (active, retired, pending approval, etc.) for business workflow.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for when this rule template was first authored.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for most recent template update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for logical removal; null if template is active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code","version"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_audit_logs_system","description":"Centralized system-level audit trail, recording all critical configuration events, administrative actions, rule/template updates, and access logs at the core configuration (systematic) layer. Each log entry includes actor identification, event type, data snapshot, and timestamp for legal and forensic evidence.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"event_type","type":"string","description":"Type of event or action (e.g., 'CREATE_CHANNEL', 'EDIT_CATEGORY', 'DELETE_TEMPLATE').","nullable":false},{"name":"actor_id","type":"uuid","description":"Reference to the user/admin/automation that performed the action.","nullable":false},{"name":"target_table","type":"string","description":"Table in which the audit event occurred.","nullable":false},{"name":"target_id","type":"uuid","description":"ID of the affected record in the target table.","nullable":false},{"name":"before","type":"string","description":"JSON snapshot of the entity's state before the change/event; may be empty for CREATE events.","nullable":true},{"name":"after","type":"string","description":"JSON snapshot of the entity's state after the change/event; may be empty for DELETE events.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp for the audit event (creation of the log entry).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["event_type"]},{"fieldNames":["actor_id"]},{"fieldNames":["target_table","target_id"]}],"ginIndexes":[]},{"name":"ai_commerce_analytics_channels","description":"Aggregated analytics/statistics for each channel, supporting performance dashboards, management reporting, and business intelligence use cases. May include denormalized, materialized fields for rapid analytics. Populated and refreshed via batch or streaming ETL.","material":true,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_channel_id","type":"uuid","description":"FK to {@link ai_commerce_channels.id}. Indicates channel with which these analytics are associated.","relation":{"name":"channel","targetModel":"ai_commerce_channels"},"unique":true,"nullable":false}],"plainFields":[{"name":"stat_date","type":"datetime","description":"Date/time partition for aggregated statistics.","nullable":false},{"name":"total_orders","type":"int","description":"Total number of orders placed on the channel in the reporting window.","nullable":false},{"name":"total_sales","type":"double","description":"Total sales amount (monetary) for the channel/stat day.","nullable":false},{"name":"total_buyers","type":"int","description":"Unique buyers in the reporting window.","nullable":false},{"name":"created_at","type":"datetime","description":"When the analytics aggregation record was created.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["stat_date"]}],"ginIndexes":[]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"ai_commerce_buyer","description":"Registered buyer account for the aiCommerce platform. Scopes purchasing, profile, and favorites. Links to auth, addresses, and profile. Subject to privacy compliance and audit. Role elevation to seller supported via status field. Soft delete for recovery and right-to-be-forgotten compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"Unique email address. Required for authentication and notifications.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for login.","nullable":false},{"name":"status","type":"string","description":"Buyer account status: active, suspended, deleted, etc.","nullable":false},{"name":"created_at","type":"datetime","description":"Account creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last profile or status update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for retention and privacy compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_seller","description":"Seller account structure. Linked to buyer account for role elevation. Handles onboarding, KYC, store management references, and legal compliance snapshots. Status supports escalation, penalties, or downgrades. Soft delete for privacy compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Linked {@link ai_commerce_buyer.id} for seller-member relationship.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":true,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Seller status: active, under_review, suspended, terminated, etc.","nullable":false},{"name":"onboarded_at","type":"datetime","description":"Timestamp for completion of onboarding/approval process.","nullable":true},{"name":"created_at","type":"datetime","description":"Account creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp for profile or status.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for legal retention/audit.","nullable":true}],"uniqueIndexes":[{"fieldNames":["buyer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_admin","description":"Admin-level user for platform and compliance management. Controls global settings, user/seller moderation, and escalation points. Separate from regular buyers/sellers for audit and global access restriction. All admin actions are strictly audited.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"Unique email address for admin login/audit.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for admin authentication (privileged access).","nullable":false},{"name":"status","type":"string","description":"Status of admin account: active, suspended, etc.","nullable":false},{"name":"created_at","type":"datetime","description":"Admin account creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update to admin profile/status.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete field for compliance; not physical delete.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_visitor","description":"Anonymous or temporary user entity for non-registered browsing sessions. Used to track marketing acquisition, incomplete onboarding, or guest cart/favorites bridging before registration.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"tracking_id","type":"string","description":"Tracking identifier assigned to the visitor (cookie/session/device fingerprint).","nullable":false},{"name":"created_at","type":"datetime","description":"Visitor record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update (e.g., session activity, attribution change).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete of visitor data for privacy auditing.","nullable":true}],"uniqueIndexes":[{"fieldNames":["tracking_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_user_authentications","description":"Core authentication and session tracking for buyers, sellers, and admins. Supports multi-device, MFA, and OAuth federation. Logs device, IP, method, and session expiry for secure audit.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Buyer account {@link ai_commerce_buyer.id} for this authentication session (nullable if admin).","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true},{"name":"admin_id","type":"uuid","description":"Admin account {@link ai_commerce_admin.id} for this authentication session (nullable if buyer).","relation":{"name":"admin","targetModel":"ai_commerce_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"method","type":"string","description":"Authentication type: password, external, magic link, MFA, etc.","nullable":false},{"name":"device_info","type":"string","description":"Device metadata (browser, OS, device fingerprint).","nullable":true},{"name":"ip_address","type":"string","description":"User login IP address for audit trail and geo-compliance.","nullable":true},{"name":"session_expires_at","type":"datetime","description":"Session expiration timestamp (JWT, refresh, etc.).","nullable":false},{"name":"created_at","type":"datetime","description":"Session record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Session last activity update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deleted session record.","nullable":true}],"uniqueIndexes":[{"fieldNames":["buyer_id","method","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["admin_id","created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_user_addresses","description":"User address records for shipping, billing, and KYC. Linked to profile/account; supports historical preservation via snapshots. Stores all legal info needed for shipping, verification, and analytics. Enforces country/validation rules.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Belonged user's {@link ai_commerce_buyer.id} (for standard buyers).","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"label","type":"string","description":"Friendly label: 'Home', 'Office', etc.","nullable":true},{"name":"country_code","type":"string","description":"ISO 3166-1 alpha-2 country code.","nullable":false},{"name":"region","type":"string","description":"State/province/region (per-country format).","nullable":true},{"name":"city","type":"string","description":"City or locality.","nullable":false},{"name":"postal_code","type":"string","description":"Postal or ZIP code for address.","nullable":false},{"name":"address_line_1","type":"string","description":"Primary address line (street, building, details).","nullable":false},{"name":"address_line_2","type":"string","description":"Secondary line (apartment, suite, etc.).","nullable":true},{"name":"is_default","type":"boolean","description":"Flag for primary/default address selection.","nullable":false},{"name":"created_at","type":"datetime","description":"Address record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp (for address edits or label change).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for privacy, not physical removal.","nullable":true}],"uniqueIndexes":[{"fieldNames":["buyer_id","label"],"unique":true}],"plainIndexes":[{"fieldNames":["country_code","city"]}],"ginIndexes":[]},{"name":"ai_commerce_user_address_snapshots","description":"Historical, immutable snapshot of each address state (for audit/evidence). Linked to user address. Used for legal, compliance, or forensic scenarios (disputes, delivery deviations, etc.). Append-only; cannot be modified or deleted.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_address_id","type":"uuid","description":"User address reference {@link ai_commerce_user_addresses.id}.","relation":{"name":"userAddress","targetModel":"ai_commerce_user_addresses"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_json","type":"string","description":"JSON-encoded snapshot of address data at time of event.","nullable":false},{"name":"event_type","type":"string","description":"Snapshot event type: create, update, delete, dispute.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["user_address_id","created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_user_external_accounts","description":"External SSO/federated account links (Google, Apple, Kakao, etc.) to enable multi-provider authentication for buyers/admins. Retains provider, unique ID, mapping timestamps, and compliance tracking.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Linked buyer account for SSO mapping {@link ai_commerce_buyer.id}.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"provider","type":"string","description":"SSO provider name (google, apple, kakao, etc.).","nullable":false},{"name":"provider_user_id","type":"string","description":"Provider-issued principal/user id for identity mapping.","nullable":false},{"name":"linked_at","type":"datetime","description":"When this linkage was registered or last verified.","nullable":false},{"name":"created_at","type":"datetime","description":"SSO record creation timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete for privacy right-to-be-forgotten.","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider","provider_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["buyer_id"]}],"ginIndexes":[]},{"name":"ai_commerce_user_profiles","description":"Main profile data for user accounts (buyer/seller role). Stores names, nickname, avatar, locale, contact, and consent/marketing preferences. Enables cross-channel profile sharing and personalization with privacy compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"User this profile belongs to {@link ai_commerce_buyer.id}.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":true,"nullable":false}],"plainFields":[{"name":"nickname","type":"string","description":"Display nickname or preferred handle for personalization.","nullable":false},{"name":"avatar_url","type":"uri","description":"URI to profile image/avatar.","nullable":true},{"name":"phone_number","type":"string","description":"Contact phone (main notification).","nullable":true},{"name":"language","type":"string","description":"Primary language preference (ISO 639-1).","nullable":true},{"name":"marketing_opt_in","type":"boolean","description":"User's agreement to receive marketing information.","nullable":false},{"name":"created_at","type":"datetime","description":"Profile record created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Profile last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["buyer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["nickname"]}],"ginIndexes":[]},{"name":"ai_commerce_user_profile_agreements","description":"User profile platform agreements for compliance: privacy policy acceptance, marketing consent, terms of service, etc. Historicized for audit and re-verification events with version/date.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"profile_id","type":"uuid","description":"Associated user profile {@link ai_commerce_user_profiles.id}.","relation":{"name":"profile","targetModel":"ai_commerce_user_profiles"},"unique":false,"nullable":false}],"plainFields":[{"name":"agreement_type","type":"string","description":"Type: privacy_policy, terms_of_service, marketing, etc.","nullable":false},{"name":"version","type":"string","description":"Agreement version (semver or yy-mm-dd)","nullable":false},{"name":"agreed_at","type":"datetime","description":"Timestamp of user agreement action.","nullable":false},{"name":"withdrawn_at","type":"datetime","description":"Agreement withdrawn timestamp (if revoked).","nullable":true}],"uniqueIndexes":[{"fieldNames":["profile_id","agreement_type","version"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_user_profile_snapshots","description":"Read-only historical versioning of user profile states. Immutable audit/evidence preservation for profile change events (rename, phone, marketing, etc.). Used for compliance and dispute handling. Can never be modified or erased for legal conformance.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"profile_id","type":"uuid","description":"Profile version relates to {@link ai_commerce_user_profiles.id}.","relation":{"name":"profile","targetModel":"ai_commerce_user_profiles"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_json","type":"string","description":"JSON-encoded full profile data at change event or history point.","nullable":false},{"name":"event_type","type":"string","description":"Event (profile_created, profile_updated, phone_changed, etc.).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot recording time.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["profile_id","created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_audit_logs_user","description":"Audit log for all buyer/admin/seller actions: login, profile change, authentication event, privilege escalation, or privacy data access. Forensically valuable, provides IP/device chronology. Strictly append-only and never deletable by user.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Action performed by or on behalf of this buyer {@link ai_commerce_buyer.id}.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true},{"name":"admin_id","type":"uuid","description":"Action performed by admin {@link ai_commerce_admin.id}.","relation":{"name":"admin","targetModel":"ai_commerce_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"action_type","type":"string","description":"Action/event code: login, logout, profile_edit, escalation, suspension, etc.","nullable":false},{"name":"subject_type","type":"string","description":"Entity type: buyer, admin, seller, profile, address, etc.","nullable":false},{"name":"subject_id","type":"uuid","description":"UUID of entity affected (account, profile, address, etc.).","nullable":false},{"name":"ip_address","type":"string","description":"IP address from which action was performed.","nullable":true},{"name":"device_info","type":"string","description":"Device/fingerprint used in the action event.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when action occurred (audit event time).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["buyer_id","action_type"]},{"fieldNames":["admin_id","action_type"]},{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-03-sellers.prisma","namespace":"Sellers","models":[{"name":"ai_commerce_seller_onboarding","description":"Captures the onboarding process for sellers, including application submission, current onboarding step/stage, status, and references to the user and target store being created. Integral for compliance, step tracking, and escalations. Links to ai_commerce_seller_kyc and ai_commerce_seller_profiles. Each onboarding record represents a seller's complete onboarding lifecycle.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Belonged user account's {@link ai_commerce_user_authentications.id}. Represents the user applying to become a seller.","relation":{"name":"user","targetModel":"ai_commerce_user_authentications"},"unique":false,"nullable":false},{"name":"store_id","type":"uuid","description":"Store created upon onboarding's {@link ai_commerce_stores.id}.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":true}],"plainFields":[{"name":"application_data","type":"string","description":"JSON-encoded application details, disclosures, and supporting documentation for the onboarding process.","nullable":false},{"name":"onboarding_status","type":"string","description":"Current onboarding status (e.g., draft, submitted, reviewing, approved, rejected, escalated).","nullable":false},{"name":"current_stage","type":"string","description":"Current stage of the onboarding process (e.g., identity_verification, business_submission, bank_verification).","nullable":true},{"name":"notes","type":"string","description":"Admin or system notes regarding this onboarding case, for compliance or review usage.","nullable":true},{"name":"created_at","type":"datetime","description":"Onboarding initiation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time for onboarding record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["onboarding_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"application_data"}]},{"name":"ai_commerce_seller_kyc","description":"Stores Know Your Customer (KYC) compliance information for sellers during onboarding and later operations. Contains references to the user, document verification metadata, status, and audit trail fields for compliance review and fraud detection.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"User's {@link ai_commerce_user_authentications.id} that the KYC applies to.","relation":{"name":"user","targetModel":"ai_commerce_user_authentications"},"unique":false,"nullable":false},{"name":"onboarding_id","type":"uuid","description":"Related onboarding application's {@link ai_commerce_seller_onboarding.id}.","relation":{"name":"onboarding","targetModel":"ai_commerce_seller_onboarding"},"unique":false,"nullable":false}],"plainFields":[{"name":"kyc_status","type":"string","description":"KYC workflow current status (awaiting_submission, pending, verified, rejected, escalated).","nullable":false},{"name":"document_type","type":"string","description":"Type of documented provided for verification (e.g., passport, business_license, driver_license).","nullable":true},{"name":"document_metadata","type":"string","description":"Relevant details or parsed info from the submitted document, typically JSON-encoded.","nullable":true},{"name":"verification_notes","type":"string","description":"Review, escalation or rejection notes produced by compliance staff or AI system.","nullable":true},{"name":"created_at","type":"datetime","description":"KYC submission timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["user_id","kyc_status"]}],"ginIndexes":[{"fieldName":"document_metadata"}]},{"name":"ai_commerce_seller_profiles","description":"Holds the seller's public and private profile information once onboarding is complete and the account is approved. Links to the main user and, optionally, to a default store. Used for display, search, analytic, and role-based workflow. Editable by sellers and admins with full update/audit trail.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"User's {@link ai_commerce_user_authentications.id} who owns this seller profile.","relation":{"name":"user","targetModel":"ai_commerce_user_authentications"},"unique":true,"nullable":false}],"plainFields":[{"name":"display_name","type":"string","description":"Name shown on storefronts and in analytics for this seller.","nullable":false},{"name":"profile_metadata","type":"string","description":"JSON snapshot of seller's business description, branding info, and regulatory disclosures for compliance.","nullable":true},{"name":"approval_status","type":"string","description":"Approval/workflow status (active, pending, suspended, terminated).","nullable":false},{"name":"suspension_reason","type":"string","description":"If suspended/terminated, main reason or justification as determined by platform/admin.","nullable":true},{"name":"created_at","type":"datetime","description":"Profile creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Profile last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["display_name"]}],"ginIndexes":[{"fieldName":"profile_metadata"}]},{"name":"ai_commerce_stores","description":"Primary table representing individual stores (managed by sellers) with unique branding, policies, and compliance details. Each store is tied to a seller profile/user and forms the central entity for seller-related transactions, products, and marketing analytics. Includes references to store settings and banking info.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"owner_user_id","type":"uuid","description":"User's {@link ai_commerce_user_authentications.id} who owns/administers this store.","relation":{"name":"owner","targetModel":"ai_commerce_user_authentications"},"unique":false,"nullable":false},{"name":"seller_profile_id","type":"uuid","description":"Seller profile {@link ai_commerce_seller_profiles.id} for this store.","relation":{"name":"sellerProfile","targetModel":"ai_commerce_seller_profiles"},"unique":false,"nullable":false}],"plainFields":[{"name":"store_name","type":"string","description":"Store's public-facing name.","nullable":false},{"name":"store_code","type":"string","description":"Unique business code or internal store identifier. Used for admin/marketing/audit.","nullable":false},{"name":"store_metadata","type":"string","description":"Business profile, description, and configuration JSON blob for extensibility.","nullable":true},{"name":"approval_status","type":"string","description":"Workflow status (active, pending, suspended, closed, terminated).","nullable":false},{"name":"closure_reason","type":"string","description":"When closed/terminated, provides summary or justification for history/legal tracking.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation time for store.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last store update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["store_code"],"unique":true}],"plainIndexes":[{"fieldNames":["store_name","approval_status"]}],"ginIndexes":[{"fieldName":"store_metadata"}]},{"name":"ai_commerce_store_settings","description":"Configuration and business rules for each store including shipping policies, return/holiday hours, custom rules, and integration flags. One-to-one or one-to-many with stores. Managed by sellers or admins with audit trail and workflow.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"store_id","type":"uuid","description":"Store's {@link ai_commerce_stores.id} to whom these settings apply.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":false}],"plainFields":[{"name":"settings_json","type":"string","description":"Store's settings as a JSON blob; includes shipping, return, hours, etc.","nullable":false},{"name":"active","type":"boolean","description":"If true, these settings are in use (for multiversion/config scenarios).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for settings version.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time for settings version.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["store_id","active"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"settings_json"}]},{"name":"ai_commerce_store_analytics","description":"Aggregated analytics/statistics for a given store, including sales volume, conversion rate, product/visitor metrics. Enables sellers/admins to monitor performance and drive business insight. Updated periodically (never realtime accuracy).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"store_id","type":"uuid","description":"Store's {@link ai_commerce_stores.id} whose metrics these belong to.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":false}],"plainFields":[{"name":"date_bucket","type":"datetime","description":"Which period (day/week/month) this record reflects; may be midnight of period or other agreed point.","nullable":false},{"name":"sales_volume","type":"double","description":"Total sales revenue for this period.","nullable":false},{"name":"orders_count","type":"int","description":"Total fulfilled orders during this analytics bucket.","nullable":false},{"name":"visitors_count","type":"int","description":"Unique store visitors during period.","nullable":false},{"name":"conversion_rate","type":"double","description":"Conversion rate for tracked period (0-1.0).","nullable":false},{"name":"analytics_json","type":"string","description":"Extra analytics, campaign metadata, or experimental fields (stored as JSON).","nullable":true},{"name":"created_at","type":"datetime","description":"Analytics record creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Analytics record last update.","nullable":false}],"uniqueIndexes":[{"fieldNames":["store_id","date_bucket"],"unique":true}],"plainIndexes":[{"fieldNames":["conversion_rate"]}],"ginIndexes":[{"fieldName":"analytics_json"}]},{"name":"ai_commerce_store_banking","description":"Confidential banking and payout details for each store, connecting to payment and compliance systems. Each record references a store and maintains the current payout/banking configuration (bank name, account, routing, policies). Must be editable and versionable, with compliance fields for auditability.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"store_id","type":"uuid","description":"Store's {@link ai_commerce_stores.id} whose banking info is configured.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":true,"nullable":false}],"plainFields":[{"name":"bank_name","type":"string","description":"Legal bank or payment provider name.","nullable":false},{"name":"account_number","type":"string","description":"Bank or payment account number for payouts.","nullable":false},{"name":"account_holder_name","type":"string","description":"Name as appears on account for verification.","nullable":false},{"name":"routing_code","type":"string","description":"Bank routing/transit/SWIFT code (if applicable, for international/wire).","nullable":true},{"name":"banking_metadata","type":"string","description":"Additional compliance info or bank config JSON-encoded.","nullable":true},{"name":"verified","type":"boolean","description":"If true, banking/payout account has passed platform admin/AI verification (required for payout).","nullable":false},{"name":"created_at","type":"datetime","description":"Payout info creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Banking last update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null if active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["store_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"banking_metadata"}]},{"name":"ai_commerce_seller_status_history","description":"Chronological log of every status or role change for a given seller—covering onboarding, approval, suspension, demotion, appeals, and escalations. Used for audit, compliance, and temporal traceability. Usually linked to ai_commerce_seller_profiles and/or onboarding record.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"User's {@link ai_commerce_user_authentications.id} involved in the status change.","relation":{"name":"user","targetModel":"ai_commerce_user_authentications"},"unique":false,"nullable":false},{"name":"seller_profile_id","type":"uuid","description":"Seller profile's {@link ai_commerce_seller_profiles.id} whose status changed (if applicable).","relation":{"name":"sellerProfile","targetModel":"ai_commerce_seller_profiles"},"unique":false,"nullable":true}],"plainFields":[{"name":"previous_status","type":"string","description":"Seller's previous role or approval status value.","nullable":true},{"name":"new_status","type":"string","description":"Status after this transition/approval/role event.","nullable":false},{"name":"transition_reason","type":"string","description":"Summary or commentary on the reason for status change—decision, evidence, escalation case.","nullable":true},{"name":"transition_actor","type":"string","description":"Indicates system, AI, or admin staff principal driving the change.","nullable":false},{"name":"created_at","type":"datetime","description":"Status transition timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["seller_profile_id","created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_seller_appeals","description":"Records appeal events initiated by sellers in response to workflow actions (rejection, penalty, demotion, payout block, etc.). Linked to seller profile and includes resolution workflow. Each record covers one appeal and its status through close.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"seller_profile_id","type":"uuid","description":"Seller's {@link ai_commerce_seller_profiles.id} the appeal is for.","relation":{"name":"sellerProfile","targetModel":"ai_commerce_seller_profiles"},"unique":false,"nullable":false}],"plainFields":[{"name":"appeal_type","type":"string","description":"Nature of appeal (rejection, penalty, demotion, payout, etc.).","nullable":false},{"name":"appeal_data","type":"string","description":"JSON-encoded details or evidence attached to this appeal.","nullable":false},{"name":"status","type":"string","description":"Status of the appeal (open, in_review, resolved, rejected, closed).","nullable":false},{"name":"resolution_notes","type":"string","description":"Platform/admin summary of how this appeal was dealt with.","nullable":true},{"name":"created_at","type":"datetime","description":"Appeal creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Appeal last update timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["seller_profile_id","status"]}],"ginIndexes":[{"fieldName":"appeal_data"}]},{"name":"ai_commerce_seller_disputes","description":"Documents dispute cases (penalties, sanctions, escalations) for sellers. Includes all required business/legal fields for context, process, evidence, and status—audit-traceable and essential for regulated commerce. Resolution and closure is covered with admin actions, potentially subject to legal review.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"seller_profile_id","type":"uuid","description":"Seller profile's {@link ai_commerce_seller_profiles.id} involved in this dispute.","relation":{"name":"sellerProfile","targetModel":"ai_commerce_seller_profiles"},"unique":false,"nullable":false}],"plainFields":[{"name":"dispute_type","type":"string","description":"Type of dispute/penalty/escalation (policy_violation, fraud_investigation, payout_hold, etc.).","nullable":false},{"name":"dispute_data","type":"string","description":"JSON data with dispute details, context, and evidence collected for process/audit.","nullable":false},{"name":"status","type":"string","description":"Current status in the dispute workflow (open, in_progress, resolved, closed, escalated, withdrawn).","nullable":false},{"name":"resolution_notes","type":"string","description":"Platform/admin notes on process, outcome, or decision-making.","nullable":true},{"name":"created_at","type":"datetime","description":"Dispute case creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Dispute record last update.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["seller_profile_id","status"]}],"ginIndexes":[{"fieldName":"dispute_data"}]},{"name":"ai_commerce_audit_logs_seller","description":"Immutable append-only log of all actions and events related to seller onboarding, operations, escalations, compliance, and appeals. Used for rigorous audit, evidence handling, and legal defensibility for platform-admin roles.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"seller_profile_id","type":"uuid","description":"Seller profile that this log refers to {@link ai_commerce_seller_profiles.id}.","relation":{"name":"sellerProfile","targetModel":"ai_commerce_seller_profiles"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Workflow/process event (onboarding, status_change, kyc_update, account_suspend, compliance_review, dispute_initiated, penalty_applied, etc.).","nullable":false},{"name":"event_data","type":"string","description":"Rich structured event data (snapshot of involved fields, module, attachments, AI inferences, reasoning).","nullable":false},{"name":"actor","type":"string","description":"Who/what performed the action (admin, system, AI agent, seller, external entity, etc.).","nullable":false},{"name":"created_at","type":"datetime","description":"Precise event creation timestamp (immutable).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["seller_profile_id","created_at"]}],"ginIndexes":[{"fieldName":"event_data"}]}]},{"filename":"schema-04-products.prisma","namespace":"Products","models":[{"name":"ai_commerce_products","description":"Main product entity representing a single item offered by a seller. Contains all business data (sku, name, description, price, inventory, lifecycle status) and references to seller, store, and channel. All product creation, update, and deletion operations generate immutable snapshots for audit trails and compliance. Supports variant, bundle, compliance, content, and marketing relationships.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"seller_id","type":"uuid","description":"Seller owning this product ({@link ai_commerce_seller.id}).","relation":{"name":"seller","targetModel":"ai_commerce_seller"},"unique":false,"nullable":false},{"name":"store_id","type":"uuid","description":"Store this product belongs to ({@link ai_commerce_stores.id}).","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":false}],"plainFields":[{"name":"product_code","type":"string","description":"Unique product code for business and integration (SKU or external reference).","nullable":false},{"name":"name","type":"string","description":"Display name of product (localizable).","nullable":false},{"name":"description","type":"string","description":"Business/marketing description (multi-format, max length 2000).","nullable":false},{"name":"status","type":"string","description":"Product listing status: draft, active, paused, suspended, discontinued, deleted.","nullable":false},{"name":"business_status","type":"string","description":"Operational workflow status (moderation, pending_approval, compliance_hold, etc.).","nullable":false},{"name":"current_price","type":"double","description":"Current display price (may change; old value versioned in snapshot).","nullable":false},{"name":"inventory_quantity","type":"int","description":"Current available stock for this product (top-level, not variant-specific).","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for product creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last product update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete (null if active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["product_code"],"unique":true}],"plainIndexes":[{"fieldNames":["seller_id","status"]},{"fieldNames":["store_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_product_variants","description":"Represents an option or variant SKU of the parent product (e.g., size/color/option permutation). Each variant has unique business fields: option summary, sku_code, price (may be different from parent), inventory, and status. Not independently searchable, managed via parent product.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Parent {@link ai_commerce_products.id} this variant belongs to.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku_code","type":"string","description":"Unique code for this variant/SKU within the product.","nullable":false},{"name":"option_summary","type":"string","description":"Summary of option values (e.g., 'Size: M / Color: Red').","nullable":false},{"name":"variant_price","type":"double","description":"Variant-specific price (overrides product price if present).","nullable":false},{"name":"inventory_quantity","type":"int","description":"Stock for this variant/SKU.","nullable":false},{"name":"status","type":"string","description":"Lifecycle/status (active, paused, discontinued).","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for variant creation.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp for last variant update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete (null if active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["sku_code"],"unique":true},{"fieldNames":["product_id","option_summary"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","status"]}],"ginIndexes":[]},{"name":"ai_commerce_product_bundles","description":"Describes a composite product composed of multiple child products/variants. Bundles are independently sold/published products, with their own code, pricing, and status. Maintains bundle relationship via bundle_items table. All bundle sales, pricing, and inventory must be managed via parent and children variants.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"parent_product_id","type":"uuid","description":"Product acting as the parent/bundle container ({@link ai_commerce_products.id}).","relation":{"name":"parentProduct","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"bundle_code","type":"string","description":"Unique code for the bundle product.","nullable":false},{"name":"name","type":"string","description":"Bundle display name.","nullable":false},{"name":"description","type":"string","description":"Bundle description/marketing details.","nullable":true},{"name":"status","type":"string","description":"Bundle status (active, paused, discontinued, deleted).","nullable":false},{"name":"current_price","type":"double","description":"Current price for bundle (does not track individual items' prices).","nullable":false},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete (null if active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["bundle_code"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_product_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_product_bundle_items","description":"Junction table linking ai_commerce_product_bundles and ai_commerce_product_variants (or ai_commerce_products). Each entry specifies child item type, quantity, required/optional, and sequence/order within the bundle. Composite key ensures no duplicate items, and supports bundle inventory validation and audit.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"bundle_id","type":"uuid","description":"Bundle container ({@link ai_commerce_product_bundles.id}).","relation":{"name":"bundle","targetModel":"ai_commerce_product_bundles"},"unique":false,"nullable":false},{"name":"child_product_id","type":"uuid","description":"Child product linked to bundle ({@link ai_commerce_products.id}).","relation":{"name":"childProduct","targetModel":"ai_commerce_products"},"unique":false,"nullable":true},{"name":"child_variant_id","type":"uuid","description":"Child variant SKU if specified ({@link ai_commerce_product_variants.id}).","relation":{"name":"childVariant","targetModel":"ai_commerce_product_variants"},"unique":false,"nullable":true}],"plainFields":[{"name":"item_type","type":"string","description":"Type: product or variant.","nullable":false},{"name":"quantity","type":"int","description":"Number of this item in the bundle.","nullable":false},{"name":"required","type":"boolean","description":"Whether this item is required for the bundle (vs. optional selection).","nullable":false},{"name":"sort_order","type":"int","description":"Display/business order within bundle items.","nullable":false}],"uniqueIndexes":[{"fieldNames":["bundle_id","child_product_id","child_variant_id"],"unique":true}],"plainIndexes":[{"fieldNames":["bundle_id"]},{"fieldNames":["child_product_id"]}],"ginIndexes":[]},{"name":"ai_commerce_product_images","description":"List of image assets for each product (attachment subsystem manages file). Each row links an image to a product, with display order and indications for localization/multiversion handling. Public urls/files are linked via attachments model (not stored here).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product to which this image belongs ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"attachment_id","type":"uuid","description":"Attachment subsystem ID for this image file ({@link ai_commerce_attachments.id}).","relation":{"name":"attachment","targetModel":"ai_commerce_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"display_order","type":"int","description":"Ordering of this image for product display (ascending).","nullable":false},{"name":"locale","type":"string","description":"Locale string or null for default.","nullable":true}],"uniqueIndexes":[{"fieldNames":["product_id","display_order"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id"]}],"ginIndexes":[]},{"name":"ai_commerce_product_contents","description":"Modular business/marketing content for each product (description, detail, instruction, etc). Each entry has a display type, format, and potentially localization context. Used for internationalization, SEO, and improved merchandising.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product to which this content belongs ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"content_type","type":"string","description":"Type: description, detail, spec, how_to, etc.","nullable":false},{"name":"format","type":"string","description":"Content format: html, markdown, plain_text, etc.","nullable":false},{"name":"locale","type":"string","description":"Locale: language/region code, or null for default.","nullable":true},{"name":"content_body","type":"string","description":"Content data, up to 10,000 characters.","nullable":false},{"name":"display_order","type":"int","description":"Display ordering among contents for the product.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id","content_type","locale"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id"]}],"ginIndexes":[{"fieldName":"content_body"}]},{"name":"ai_commerce_product_snapshots","description":"Immutable, append-only historical record of the full state of a product (and optionally its variants, price, and compliance) at each modification, publish, or compliance event. Used for compliance, rollback, and audit trails. Holds snapshot as a JSON blob and tracks the actor, timestamp, and event.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product of this snapshot ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Event: create, update, price_change, compliance_review, version_publish, etc.","nullable":false},{"name":"actor_id","type":"uuid","description":"User/admin ID triggering the snapshot event.","nullable":false},{"name":"snapshot_json","type":"string","description":"Complete denormalized JSON of product state at this snap.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id","created_at","event_type"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id"]}],"ginIndexes":[]},{"name":"ai_commerce_product_seo","description":"SEO and search metadata for a product, managed as a subsidiary. Includes canonical url, SEO title, description, image, and keyword/tags. No denormalized or calculated fields—pure metadata. Supports localization, versioning, and independent publishing.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product for this SEO entry ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"seo_title","type":"string","description":"SEO page title (localized or default).","nullable":true},{"name":"seo_description","type":"string","description":"SEO meta description.","nullable":true},{"name":"canonical_url","type":"uri","description":"Canonical/public url to the product.","nullable":true},{"name":"seo_keywords","type":"string","description":"Comma-separated keywords for search/full-text indexing.","nullable":true},{"name":"og_image_url","type":"uri","description":"Image url for OpenGraph/social sharing.","nullable":true}],"uniqueIndexes":[{"fieldNames":["product_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"seo_title"}]},{"name":"ai_commerce_product_category_bindings","description":"Junction table linking products to categories, supporting multi-channel and multi-category assignments. Each binding links a product to one category/context. Composite unique guarantees no duplicate binding.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"category_id","type":"uuid","description":"Category ({@link ai_commerce_categories.id}).","relation":{"name":"category","targetModel":"ai_commerce_categories"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"When the binding was created.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id","category_id"],"unique":true}],"plainIndexes":[{"fieldNames":["category_id"]}],"ginIndexes":[]},{"name":"ai_commerce_product_section_bindings","description":"Binds a product to a merchandising/featured section in a channel (e.g., 'Flash Sale'). Multi-assignment allowed, composite key for uniqueness. Serves as target for merchandising configuration or admin curation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"section_id","type":"uuid","description":"Section ({@link ai_commerce_sections.id}).","relation":{"name":"section","targetModel":"ai_commerce_sections"},"unique":false,"nullable":false}],"plainFields":[{"name":"display_order","type":"int","description":"Product order within section.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id","section_id"],"unique":true}],"plainIndexes":[{"fieldNames":["section_id"]}],"ginIndexes":[]},{"name":"ai_commerce_product_legal_compliance","description":"Legal, regulatory, and compliance fields for products (parent or subsidiary for multi-jurisdictional). Contains required certifications, restricted use, age and labeling flags, and status evidence for each compliance review. Linked to corresponding product. Required for all compliance jurisdiction snapshots.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Product subject to compliance check ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"compliance_region","type":"string","description":"Jurisdiction (country/region) for this compliance entry.","nullable":false},{"name":"certification_numbers","type":"string","description":"Comma-separated list of certificate/approval numbers.","nullable":true},{"name":"restricted_age","type":"int","description":"Minimum age for purchase/use, if any.","nullable":true},{"name":"hazard_flag","type":"boolean","description":"Whether item is hazardous/restricted/special handling.","nullable":false},{"name":"compliance_status","type":"string","description":"Current status: pending, approved, rejected, expired.","nullable":false},{"name":"last_reviewed_at","type":"datetime","description":"Last regulatory check timestamp.","nullable":true},{"name":"evidence_json","type":"string","description":"Extra evidence or attachments as JSON, e.g., file IDs, review context.","nullable":true}],"uniqueIndexes":[{"fieldNames":["product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["compliance_region"]}],"ginIndexes":[]},{"name":"ai_commerce_product_audit_logs","description":"Records all audit trail events for a product and its subcomponents. Documents every creation, edit, compliance check, status/lifecycle transition, and actor. Used for compliance and legal traceability. Each action records before/after JSON, event type, timestamp, and actor/context.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Target product ({@link ai_commerce_products.id}).","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Action performed: create, update, compliance_review, price_change, content_edit, etc.","nullable":false},{"name":"actor_id","type":"uuid","description":"User/admin/automation performing audit action.","nullable":false},{"name":"before_json","type":"string","description":"State before action (JSON); null for new creation.","nullable":true},{"name":"after_json","type":"string","description":"State after action (JSON); null for deletion.","nullable":true},{"name":"created_at","type":"datetime","description":"Action timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["product_id"]},{"fieldNames":["actor_id"]},{"fieldNames":["event_type"]}],"ginIndexes":[]}]},{"filename":"schema-05-discovery.prisma","namespace":"Discovery","models":[{"name":"ai_commerce_tags","description":"Central master table for tags used in product, inquiry, and discovery modules. Stores tag identity, status, registration source, and business context. Managed by admins and sellers, linked to moderation and product tag junctions. Accessible in tagging flows, analytics, and recommendation evidence.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"The unique tag label shown to users and used for search. Alphanumeric, case-insensitive and globally unique.","nullable":false},{"name":"description","type":"string","description":"Business/contextual description for moderation and analytics. May be blank or short.","nullable":true},{"name":"status","type":"string","description":"Current tag status: 'active', 'under_review', 'suspended', 'deleted'. Used for moderation/business logic.","nullable":false},{"name":"created_at","type":"datetime","description":"Tag creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["name"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]},{"fieldNames":["updated_at"]}],"ginIndexes":[]},{"name":"ai_commerce_tag_moderation","description":"Moderation logs and actions related to tags. Subsidiary to ai_commerce_tags. Stores moderation decision, actor, timestamp, and rationale. Enables audit trail for tag changes and evidence for admin interventions.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_tag_id","type":"uuid","description":"Associated tag's {@link ai_commerce_tags.id}.","relation":{"name":"tag","targetModel":"ai_commerce_tags"},"unique":false,"nullable":false}],"plainFields":[{"name":"moderation_action","type":"string","description":"Type of moderation taken: 'approve', 'reject', 'flag', 'suspend'.","nullable":false},{"name":"moderated_by","type":"uuid","description":"Moderator's admin user id {@link ai_commerce_admin.id}.","nullable":false},{"name":"moderation_reason","type":"string","description":"Freeform reason or notes for the moderation action.","nullable":true},{"name":"created_at","type":"datetime","description":"Moderation record creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["ai_commerce_tag_id","created_at"]},{"fieldNames":["moderated_by"]}],"ginIndexes":[]},{"name":"ai_commerce_product_tags","description":"Junction table linking products and tags, enabling M:N relationship between ai_commerce_products and ai_commerce_tags. Each row represents a tagging event, enabling product search and discovery. Does not store denormalized product or tag info, normalized to 3NF. Business operations include adding, removing, and searching product tags.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_product_id","type":"uuid","description":"Target product's {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"ai_commerce_tag_id","type":"uuid","description":"Target tag's {@link ai_commerce_tags.id}.","relation":{"name":"tag","targetModel":"ai_commerce_tags"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Time tag was applied to product.","nullable":false}],"uniqueIndexes":[{"fieldNames":["ai_commerce_product_id","ai_commerce_tag_id"],"unique":true}],"plainIndexes":[{"fieldNames":["ai_commerce_product_id"]},{"fieldNames":["ai_commerce_tag_id"]}],"ginIndexes":[]},{"name":"ai_commerce_trending_products","description":"Tracks products flagged as trending via analytics, sales, or manual override, supporting dynamic discovery/rankings. Serves as a primary table due to business need for direct curation, search, and trend audit. Distinct from highlight (temporary/manual), this table is for trending (dynamic, analytics-led) status. ","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_product_id","type":"uuid","description":"Target product's {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"analytics_score","type":"double","description":"Score/value used to compute trending status, supports real-time analytics and ordering.","nullable":false},{"name":"is_manual_override","type":"boolean","description":"Whether entry was manually set as trending/overridden by an admin.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when product was first flagged as trending.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last trend status update (analytics/manual).","nullable":false}],"uniqueIndexes":[{"fieldNames":["ai_commerce_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["analytics_score","created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_highlighted_products","description":"Table for products highlighted by manual curation (admin/seller-controlled) for special visibility in discovery flows. Distinct from trending, this business-entity allows scheduled highlights and business campaign tracking. Direct business operations (CRUD) required for admin/seller teams.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_product_id","type":"uuid","description":"Product being highlighted, FK to {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"highlighted_by","type":"uuid","description":"ID of admin/seller who performed the highlight {@link ai_commerce_seller.id} or {@link ai_commerce_admin.id}.","relation":{"name":"highlightedBy","targetModel":"ai_commerce_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"highlight_start_at","type":"datetime","description":"Timestamp highlighting begins (scheduled).","nullable":false},{"name":"highlight_end_at","type":"datetime","description":"Timestamp highlighting ends (scheduled, may be null if indefinite).","nullable":true},{"name":"reason","type":"string","description":"Business reason/notes for highlighting, analytic support.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["ai_commerce_product_id","highlight_start_at"],"unique":true}],"plainIndexes":[{"fieldNames":["highlight_start_at","highlight_end_at"]},{"fieldNames":["highlighted_by"]}],"ginIndexes":[]},{"name":"ai_commerce_search_histories","description":"Records all user and session search actions for personalized discovery and AI analytics. Each record stores query, user/session context, filters, results, and device/locale metadata. Supports cross-channel experimentation, audit, and trend analysis.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_buyer_id","type":"uuid","description":"Buyer user FK {@link ai_commerce_buyer.id}; may be null for anonymous/guest searches.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true}],"plainFields":[{"name":"query_string","type":"string","description":"Full user-entered query string. Used for analytics and personal search recall.","nullable":false},{"name":"filters_applied","type":"string","description":"JSON-encoded array/object of filters (categories, price, etc) used in search.","nullable":true},{"name":"result_count","type":"int","description":"Number of results returned from search.","nullable":false},{"name":"search_timestamp","type":"datetime","description":"Timestamp of search execution.","nullable":false},{"name":"locale","type":"string","description":"Locale/device language/region at search time.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["search_timestamp"]},{"fieldNames":["ai_commerce_buyer_id","search_timestamp"]}],"ginIndexes":[{"fieldName":"query_string"}]},{"name":"ai_commerce_search_analytics","description":"Aggregated analytics and statistics for search operations (keyword frequency, filter usage, search performance). Used for backend dashboards, diagnostics, and AI learning. Trends/aggregates may be recomputed/updated. Not for per-user search recall, but for platform-level or admin insights.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"aggregation_key","type":"string","description":"Aggregation granularity (e.g., keyword, filter, date).","nullable":false},{"name":"aggregation_value","type":"string","description":"Value for this aggregation (e.g., 'laptop', '{\"category\":\"shoes\"}', '2024-06-01').","nullable":false},{"name":"search_count","type":"int","description":"Number of searches matching this aggregation.","nullable":false},{"name":"result_total","type":"int","description":"Sum of search results for this aggregation.","nullable":false},{"name":"analyzed_period_start","type":"datetime","description":"Start of analytic calculation period.","nullable":false},{"name":"analyzed_period_end","type":"datetime","description":"End of analytic calculation period.","nullable":false}],"uniqueIndexes":[{"fieldNames":["aggregation_key","aggregation_value","analyzed_period_start"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"aggregation_value"}]},{"name":"ai_commerce_recommendation_snapshots","description":"Point-in-time record of product recommendation lists given to users, including recommendations, context, and computed rank/reason for evidence. Powers audit and reproducibility of AI recommendations. Used for compliance and personalization audits.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ai_commerce_buyer_id","type":"uuid","description":"The buyer who received the recommendations {@link ai_commerce_buyer.id}.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_timestamp","type":"datetime","description":"When the snapshot/recommendation was generated.","nullable":false},{"name":"recommendations_data","type":"string","description":"JSON-encoded list/array of recommended products (with computed scores/order, enough for audit).","nullable":false},{"name":"context_data","type":"string","description":"JSON-encoded context for the recommendation (recent searches, session data, etc).","nullable":true}],"uniqueIndexes":[{"fieldNames":["ai_commerce_buyer_id","snapshot_timestamp"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_audit_logs_discovery","description":"Snapshot-based audit trail of all major discovery subsystem events (tag curation, highlight/trending changes, important AI interventions). Powers platform-wide evidence, compliance, and traceability for discovery operations without polluting base product tables. Rarely updated/deleted outside of compliance flows.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"actor_id","type":"uuid","description":"FK to user/admin/worker who performed action. May reference ai_commerce_buyer, ai_commerce_seller, or ai_commerce_admin depending on source.","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Nature/type of discovery audit event (e.g., 'tag_create', 'highlight_update', 'recommendation_decision').","nullable":false},{"name":"event_details","type":"string","description":"JSON-encoded details of what was changed/acted, sufficient for audit trail.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp for event occurrence.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["actor_id","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-06-carts.prisma","namespace":"Carts","models":[{"name":"ai_commerce_carts","description":"Main shopping cart entity representing the buyer/member or guest's persistent cart, either authenticated (user-linked) or anonymous (session/tracking ID only). Holds overall status, timestamps, and pointers to belonging user/session, with support for soft deletion and recovery. Serves as the core container for cart CRUD and all downstream order creation logic. References to user, session, store, or recovery context are FKs to existing models in other components.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Belonged buyer's {@link ai_commerce_buyer.id}. Nullable for guest carts.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true},{"name":"store_id","type":"uuid","description":"Targeted store's {@link ai_commerce_stores.id} if used for store-centric cart logic.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":true}],"plainFields":[{"name":"status","type":"string","description":"Current cart status (draft, active, checked_out, expired, merged, deleted, etc).","nullable":false},{"name":"total_quantity","type":"int","description":"Total quantity of items currently in the cart (sum across all items).","nullable":false},{"name":"created_at","type":"datetime","description":"Cart creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update to cart (item add/remove/modification).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete marker for recovery or logical deletion.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["buyer_id"]},{"fieldNames":["store_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_cart_items","description":"Individual item in a shopping cart representing a product or variant selection. Subsidiary to the main cart, records product, quantity, pricing context as of addition, and any parent-child option references. Serves as the target for modifications (add/remove/update) within cart flows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"cart_id","type":"uuid","description":"Owning cart's {@link ai_commerce_carts.id}.","relation":{"name":"cart","targetModel":"ai_commerce_carts"},"unique":false,"nullable":false},{"name":"product_id","type":"uuid","description":"ID of product being purchased, links to {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"variant_id","type":"uuid","description":"Variant/SKU selected (if applicable), links to {@link ai_commerce_product_variants.id}.","relation":{"name":"variant","targetModel":"ai_commerce_product_variants"},"unique":false,"nullable":true}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of product selected (per cart item).","nullable":false},{"name":"unit_price","type":"double","description":"Unit price at time of addition (may differ from canonical product for snapshot consistency).","nullable":false},{"name":"item_total","type":"double","description":"Calculated total for (quantity × unit_price) at time of last update. Used for recovery in case of product price change after addition.","nullable":false},{"name":"added_at","type":"datetime","description":"Timestamp when item was first added to cart.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp for this line item.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for removing item but preserving audit trail.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["cart_id"]},{"fieldNames":["product_id","variant_id"]}],"ginIndexes":[]},{"name":"ai_commerce_cart_item_options","description":"Option selections linked to a specific cart item (e.g., size, color), tracking chosen values and enabling variant/SKU mapping. Subsidiary; each cart item may reference several such option records.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"cart_item_id","type":"uuid","description":"Referenced cart item's {@link ai_commerce_cart_items.id}.","relation":{"name":"cartItem","targetModel":"ai_commerce_cart_items"},"unique":false,"nullable":false}],"plainFields":[{"name":"option_name","type":"string","description":"Name/code of option (e.g., 'color', 'size').","nullable":false},{"name":"option_value","type":"string","description":"The selected value for the option (e.g., 'red', 'XL').","nullable":false},{"name":"created_at","type":"datetime","description":"Option selection created_at, for snapshot traceability.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["cart_item_id"]}],"ginIndexes":[{"fieldName":"option_name"}]},{"name":"ai_commerce_cart_sessions","description":"Tracks association between a cart and a user/device/session. Used for both member and guest carts to support cart merging, session recovery, and session-scoped cart behaviors.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Authenticated buyer's {@link ai_commerce_buyer.id}, null for guests.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true},{"name":"cart_id","type":"uuid","description":"Associated cart's {@link ai_commerce_carts.id}.","relation":{"name":"cart","targetModel":"ai_commerce_carts"},"unique":true,"nullable":false}],"plainFields":[{"name":"session_token","type":"string","description":"Opaque session identifier (for guest carts: device ID, cookie, or generated token).","nullable":false},{"name":"status","type":"string","description":"Current session status (active, expired, merged, etc).","nullable":false},{"name":"expires_at","type":"datetime","description":"Session expiration timestamp.","nullable":true},{"name":"created_at","type":"datetime","description":"Session creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Session last update time.","nullable":false}],"uniqueIndexes":[{"fieldNames":["session_token"],"unique":true},{"fieldNames":["cart_id"],"unique":true}],"plainIndexes":[{"fieldNames":["buyer_id"]}],"ginIndexes":[]},{"name":"ai_commerce_cart_templates","description":"Seller/admin-creatable cart templates enabling creation of pre-filled carts for promotions, bundles, or rapid checkout. Main business entity for template CRUD; each template has ownership, custom name, and usage visibility flags. Supports full-text search and indexing for template name/labels.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"creator_id","type":"uuid","description":"Creator's {@link ai_commerce_admin.id} or {@link ai_commerce_seller.id}.","relation":{"name":"creator","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false},{"name":"store_id","type":"uuid","description":"If the template is store-specific, references {@link ai_commerce_stores.id}.","relation":{"name":"store","targetModel":"ai_commerce_stores"},"unique":false,"nullable":true}],"plainFields":[{"name":"template_name","type":"string","description":"Business name for this cart template.","nullable":false},{"name":"description","type":"string","description":"Long-form business description of the cart template's purpose.","nullable":true},{"name":"active","type":"boolean","description":"Whether the template is active and available for cart creation.","nullable":false},{"name":"created_at","type":"datetime","description":"Template creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update to template state or settings.","nullable":false}],"uniqueIndexes":[{"fieldNames":["creator_id","template_name"],"unique":true}],"plainIndexes":[{"fieldNames":["store_id"]}],"ginIndexes":[{"fieldName":"template_name"}]},{"name":"ai_commerce_cart_merges","description":"Snapshot/audit record of cart merges (e.g., guest to member, two member carts, etc). Append-only table (no updates/deletes), capturing pre- and post-merge cart IDs, actors, merge reason, and resulting changes. Used for audit trail and historical debugging/evidence.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"source_cart_id","type":"uuid","description":"Source cart's {@link ai_commerce_carts.id} before merge.","relation":{"name":"sourceCart","targetModel":"ai_commerce_carts","mappingName":"ai_commerce_cart_merges_of_source_cart_id"},"unique":false,"nullable":false},{"name":"target_cart_id","type":"uuid","description":"Target cart's {@link ai_commerce_carts.id} after merge.","relation":{"name":"targetCart","targetModel":"ai_commerce_carts","mappingName":"ai_commerce_cart_merges_of_target_cart_id"},"unique":false,"nullable":false},{"name":"actor_id","type":"uuid","description":"Merging actor's {@link ai_commerce_buyer.id} or admin ID. Nullable for automated/system merges.","relation":{"name":"actor","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true}],"plainFields":[{"name":"reason","type":"string","description":"Business code or description for merge reason (e.g., 'login_merge', 'device_switch', 'admin_action').","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when merge action took place.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["source_cart_id"]},{"fieldNames":["target_cart_id"]}],"ginIndexes":[]},{"name":"ai_commerce_cart_expirations","description":"Snapshot/audit record of cart expirations or recoveries—append-only audit trail for expiration logic enforcement, recovery/merge after timeout, or policy changes. Used for compliance, debugging, and analytics.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"cart_id","type":"uuid","description":"Expired or recovered cart's {@link ai_commerce_carts.id}.","relation":{"name":"cart","targetModel":"ai_commerce_carts"},"unique":false,"nullable":false},{"name":"actor_id","type":"uuid","description":"Actor triggering expiration/recovery. May be system-user/admin or null for automatic expirations.","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Type of event (expiration, recovery, retry, auto_reopen, etc).","nullable":false},{"name":"details","type":"string","description":"Description or business context for expiration/recovery event.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp of expiration or recovery event.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["cart_id"]},{"fieldNames":["event_type"]}],"ginIndexes":[]},{"name":"ai_commerce_cart_audit_logs","description":"Comprehensive, append-only audit log for all cart-related modifications (CRUD, merging, expiration, option changes, user actions). Records actor, affected entity, action, before/after state JSON, and timestamps. Enables forensic reconstructibility, regulatory/legal evidence, and troubleshooting for all cart business events.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"cart_id","type":"uuid","description":"Affected cart's {@link ai_commerce_carts.id} (if applicable).","relation":{"name":"cart","targetModel":"ai_commerce_carts"},"unique":false,"nullable":true},{"name":"actor_id","type":"uuid","description":"User/admin/system actor ({@link ai_commerce_buyer.id} or admin ID) who performed the action. Nullable for system events.","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"entity_type","type":"string","description":"Entity type affected (cart, cart_item, option, session, merge, expiration, etc).","nullable":false},{"name":"action_type","type":"string","description":"CRUD or business event performed (create, update, remove, merge, expire, recover, etc).","nullable":false},{"name":"before_state_json","type":"string","description":"JSON snapshot of entity state before action. May be null for creates.","nullable":true},{"name":"after_state_json","type":"string","description":"JSON snapshot after action. May be null for deletes.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp of action log record creation.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["cart_id"]},{"fieldNames":["entity_type"]},{"fieldNames":["action_type"]}],"ginIndexes":[]}]},{"filename":"schema-07-orders.prisma","namespace":"Orders","models":[{"name":"ai_commerce_orders","description":"Primary table for all purchase orders. Represents complete buyer intent at checkout, including all relevant metadata for order lifecycle, buyer references, source channel, pricing, address snapshot, and state tracking. Core entity for commerce business logic. Supports multiple order items and payment routes, and is referenced by fulfillment, after-sales, and audit entities.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"buyer_id","type":"uuid","description":"Order owner's unique ID. References buyer's {@link ai_commerce_buyer.id}.","relation":{"name":"buyer","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Source channel for this order. References channel's {@link ai_commerce_channels.id}.","relation":{"name":"channel","targetModel":"ai_commerce_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"order_code","type":"string","description":"Unique business/tracking code for order, human-readable. E.g. 'ORD-20250001'.","nullable":false},{"name":"status","type":"string","description":"Current order status, e.g., created, payment_pending, shipped, delivered, cancelled, closed.","nullable":false},{"name":"business_status","type":"string","description":"Business workflow state (used for backend automation).","nullable":true},{"name":"total_price","type":"double","description":"Total price for the order at checkout (locked at payment).","nullable":false},{"name":"paid_amount","type":"double","description":"Cumulative paid amount (updated as payment proceeds).","nullable":false},{"name":"currency","type":"string","description":"ISO currency code (e.g., 'KRW', 'USD') for payment/settlement.","nullable":false},{"name":"address_snapshot_id","type":"uuid","description":"FK to delivery address snapshot used for this order. References {@link ai_commerce_user_address_snapshots.id}.","nullable":false},{"name":"created_at","type":"datetime","description":"Order creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Most recent update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp (soft delete) if this order is invalidated/cancelled for legal/audit retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_code"],"unique":true}],"plainIndexes":[{"fieldNames":["buyer_id"]},{"fieldNames":["channel_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_items","description":"Subsidiary table for line items within an order (one per purchased product/option set). Contains direct reference to parent order, product variant, pricing, quantities, and fulfillment state for split and multi-seller scenarios.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Belonged order's {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"product_variant_id","type":"uuid","description":"FK for product variant purchased (references {@link ai_commerce_product_variants.id}).","relation":{"name":"productVariant","targetModel":"ai_commerce_product_variants"},"unique":false,"nullable":false},{"name":"seller_id","type":"uuid","description":"Optional reference to seller of this item (for multi-vendor).","relation":{"name":"seller","targetModel":"ai_commerce_seller"},"unique":false,"nullable":true}],"plainFields":[{"name":"item_code","type":"string","description":"Human-readable item code for logistics/buyer UX.","nullable":false},{"name":"name","type":"string","description":"Name displayed to buyer at purchase (from snapshot).","nullable":false},{"name":"quantity","type":"int","description":"Quantity purchased for this line item.","nullable":false},{"name":"unit_price","type":"double","description":"Price per single unit at checkout time.","nullable":false},{"name":"total_price","type":"double","description":"Total line price: unit_price * quantity.","nullable":false},{"name":"delivery_status","type":"string","description":"Delivery lifecycle status for this line item (independent from full order for splits/partials).","nullable":false},{"name":"created_at","type":"datetime","description":"Item creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Most recent update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"If set, item is canceled/removed (soft delete, for audit).","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_id","item_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["seller_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_sub_orders","description":"Table representing segmented sub-orders created when a single order is split by seller/fulfillment method. Links back to parent order, holds independent status, payment/fulfillment tracking, and reference to responsible party.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Parent order's {@link ai_commerce_orders.id} field.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"seller_id","type":"uuid","description":"FK to seller fulfilling this sub-order.","relation":{"name":"seller","targetModel":"ai_commerce_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"suborder_code","type":"string","description":"Unique business code/identifier for this sub-order, derived from order code + segment.","nullable":false},{"name":"status","type":"string","description":"Current status for this sub-order (e.g., payment_pending, shipped, delivered, completed, cancelled).","nullable":false},{"name":"shipping_method","type":"string","description":"Selected shipping method for this fulfillment segment.","nullable":true},{"name":"tracking_number","type":"string","description":"Tracking waybill or reference number for this segment (nullable).","nullable":true},{"name":"total_price","type":"double","description":"Total price allocable to this sub-order portion.","nullable":false},{"name":"created_at","type":"datetime","description":"Sub-order creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when sub-order was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete marker for sub-order (for audit/legal evidence).","nullable":true}],"uniqueIndexes":[{"fieldNames":["suborder_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["seller_id"]}],"ginIndexes":[]},{"name":"ai_commerce_order_status_history","description":"Ordered event log for all state transitions affecting the parent order. Tracks every status/business_status change, actor, and timestamp for full auditability. Never modified, append-only for historical integrity.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Parent order's {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"actor_id","type":"uuid","description":"User/admin responsible for state-change action. References buyer, seller, or admin id.","relation":{"name":"actor","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"old_status","type":"string","description":"Previous order status value.","nullable":false},{"name":"new_status","type":"string","description":"New status after transition.","nullable":false},{"name":"old_business_status","type":"string","description":"Previous backend workflow value.","nullable":true},{"name":"new_business_status","type":"string","description":"Workflow/backend state after change.","nullable":true},{"name":"note","type":"string","description":"Business/admin note (if provided) for status change reason, escalation, or litigation.","nullable":true},{"name":"changed_at","type":"datetime","description":"Timestamp for this status change event.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["changed_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_payments","description":"Log of all payment-related events tied to an order (including partials, retries, split-payments by method). Supports refunds, payment failure records, and settlement tracking for dispute and financial audit.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Linked order's {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"payment_id","type":"uuid","description":"Reference to global payment record (references ai_commerce_payments.id).","relation":{"name":"payment","targetModel":"ai_commerce_payments"},"unique":false,"nullable":false}],"plainFields":[{"name":"payment_code","type":"string","description":"Business/teller receipt or code for this applied payment (for output/settlement).","nullable":false},{"name":"status","type":"string","description":"Payment status (pending, completed, failed, reversed, etc.).","nullable":false},{"name":"amount","type":"double","description":"Paid amount linked to this payment event (could be partial, full, or refunded).","nullable":false},{"name":"currency","type":"string","description":"Currency paid in (should match order but recorded for legal/audit).","nullable":false},{"name":"applied_at","type":"datetime","description":"Timestamp when this payment was recorded.","nullable":false},{"name":"settled_at","type":"datetime","description":"Timestamp when payment was fully settled/confirmed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["payment_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["payment_id"]}],"ginIndexes":[]},{"name":"ai_commerce_order_fulfillments","description":"Tracks each shipping/fulfillment event against an order (can reference either primary order or sub-order), including shipment/pickup, delivery event, and related carrier/tracking info. Enables multi-stage and split fulfillment documentation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Relevant order's {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"suborder_id","type":"uuid","description":"Reference to sub-order if present (nullable).","relation":{"name":"subOrder","targetModel":"ai_commerce_sub_orders"},"unique":false,"nullable":true}],"plainFields":[{"name":"fulfillment_code","type":"string","description":"Carrier/fulfillment tracking code (unique) for this event.","nullable":false},{"name":"status","type":"string","description":"Current status of fulfillment event (in transit, delivered, returned, etc.).","nullable":false},{"name":"carrier","type":"string","description":"Logistics carrier/service used (DHL, CJ, etc.).","nullable":false},{"name":"carrier_contact","type":"string","description":"Contact info/reference for carrier as of fulfillment date.","nullable":true},{"name":"fulfilled_at","type":"datetime","description":"Timestamp for fulfillment event.","nullable":false},{"name":"updated_at","type":"datetime","description":"Latest recorded update for fulfillment info.","nullable":false}],"uniqueIndexes":[{"fieldNames":["fulfillment_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["suborder_id"]}],"ginIndexes":[]},{"name":"ai_commerce_order_after_sales","description":"Encompasses all after-sales service requests—returns, exchanges, disputes, warranty, and escalations—pertaining to a single order or order item. Tracks request state, actioned actors, evidentiary/blame attachments, and final resolution step for compliance/audit.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Affected order's {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"order_item_id","type":"uuid","description":"Optional reference to specific line item affected.","relation":{"name":"orderItem","targetModel":"ai_commerce_order_items"},"unique":false,"nullable":true},{"name":"actor_id","type":"uuid","description":"Party initiating after-sales event (buyer, seller, admin by context).","relation":{"name":"actor","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"type","type":"string","description":"After-sales event type: return, exchange, dispute, warranty, etc.","nullable":false},{"name":"status","type":"string","description":"Progress state of after-sales case (pending, in_review, approved, rejected, resolved, etc.).","nullable":false},{"name":"opened_at","type":"datetime","description":"Time when request was created/received.","nullable":false},{"name":"closed_at","type":"datetime","description":"Final time after-sales request was resolved/closed (nullable if still active).","nullable":true},{"name":"note","type":"string","description":"Optional business note/case reason/summary for future analytics/audit.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["type"]},{"fieldNames":["opened_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_cancellations","description":"Manages all cancellation requests, processing, approvals, or denials for orders or items. Supports full/partial cancellation, traces actor for compliance, and records effective time for audit trail.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Belonged order for cancellation. {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"actor_id","type":"uuid","description":"Party (buyer, seller, admin) submitting/cancelling this request.","relation":{"name":"actor","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"cancellation_code","type":"string","description":"Unique code for referencing this cancellation event.","nullable":false},{"name":"reason","type":"string","description":"Optional reason/justification for this cancellation.","nullable":true},{"name":"status","type":"string","description":"Current cancellation process status: requested, processing, approved, denied, completed.","nullable":false},{"name":"requested_at","type":"datetime","description":"Timestamp when cancellation was requested.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when cancellation was approved/confirmed by system/admin.","nullable":true},{"name":"finalized_at","type":"datetime","description":"When cancellation was fully processed and order/item status updated.","nullable":true}],"uniqueIndexes":[{"fieldNames":["cancellation_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["requested_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_refunds","description":"Represents all refund actions/attempts for an order, including amount, status, and settlement outcome. Supports multiple refunds per order (partial, staged, denied), captures responsible actor and resolution context. Financial evidence for disputes/loss provisions.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Order receiving refund action. {@link ai_commerce_orders.id}.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false},{"name":"actor_id","type":"uuid","description":"Party (buyer, seller, admin) initiating refund or processing.","relation":{"name":"actor","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"refund_code","type":"string","description":"Unique identifier for this refund event.","nullable":false},{"name":"reason","type":"string","description":"Optional reason/comment for refund request/audit.","nullable":true},{"name":"status","type":"string","description":"Refund workflow stage: pending, processing, denied, approved, paid, failed, etc.","nullable":false},{"name":"amount","type":"double","description":"Refunded amount. Must be ≤ paid amount for order/item(s).","nullable":false},{"name":"currency","type":"string","description":"Refund currency (must match original payment/order legal currency).","nullable":false},{"name":"requested_at","type":"datetime","description":"Date/time refund requested.","nullable":false},{"name":"resolved_at","type":"datetime","description":"Result/finalization time (may be null if pending).","nullable":true}],"uniqueIndexes":[{"fieldNames":["refund_code"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["status"]},{"fieldNames":["requested_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_analytics","description":"Aggregated performance, status, and activity metrics for orders and fulfillment. Supports KPIs, real-time dashboards, and operational/statistical analysis. May be materialized for reporting, but not directly user-editable.","material":true,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"FK for summarized order (if analytics are per-order level).","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":true,"nullable":false}],"plainFields":[{"name":"order_date","type":"datetime","description":"Order submission/placed date (for period analysis).","nullable":false},{"name":"order_value","type":"double","description":"Sum monetary value for this order (for aggregation/reporting).","nullable":false},{"name":"items_count","type":"int","description":"Number of unique items in order (for item-level statistics).","nullable":false},{"name":"refund_count","type":"int","description":"Number of refunds registered within this order.","nullable":false},{"name":"after_sales_count","type":"int","description":"How many after-sales/complaints registered on order/items.","nullable":false},{"name":"completion_time_seconds","type":"int","description":"Measured seconds from order creation to final closed status transfer (latency/efficiency).","nullable":true},{"name":"last_status","type":"string","description":"Final/most recent status for reporting (denormalized).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modified/aggregation timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["order_id"],"unique":true}],"plainIndexes":[{"fieldNames":["order_date"]}],"ginIndexes":[]},{"name":"ai_commerce_order_snapshot_logs","description":"Immutable time-based historical snapshots of orders and associated entities (items, fulfillments, disputes). Captures full state upon mutation for legal/forensic recovery. Required for auditability and legal compliance.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Original order associated with this snapshot capture.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"capture_type","type":"string","description":"Nature of state capture: creation, edit, cancel, fulfilment, aftersales, etc.","nullable":false},{"name":"actor_id","type":"uuid","description":"User/admin id making change when snapshot is taken.","nullable":false},{"name":"captured_at","type":"datetime","description":"Time snapshot was taken.","nullable":false},{"name":"entity_json","type":"string","description":"Full JSON string of captured entity state/content for audit/future analysis.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["captured_at"]}],"ginIndexes":[]},{"name":"ai_commerce_order_audit_logs","description":"Append-only log of every critical action on orders, items, refunds, after-sales, or fulfillments—enables watertight evidence and forensic trace for compliance. Records who/what/when and detailed context of actions for transparency.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Related order for this audit event.","relation":{"name":"order","targetModel":"ai_commerce_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Type of action/event: create, update, payment, refund, fulfillment, cancellation, status_change, aftersales, etc.","nullable":false},{"name":"actor_id","type":"uuid","description":"User or admin who performed the action.","nullable":false},{"name":"event_note","type":"string","description":"Optional log details/context for this action, escalation, or outcome.","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp when action/event took place.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_id"]},{"fieldNames":["occurred_at"]}],"ginIndexes":[]}]},{"filename":"schema-08-payment.prisma","namespace":"Payment","models":[{"name":"ai_commerce_payments","description":"Records each distinct buyer payment event for orders, including method, status, value, gateway, transaction, and audit fields. Used for payment lifecycle tracking and compliance. Linked to transactions, analytics, and fraud events.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"payment_reference","type":"string","description":"Business or gateway-assigned payment reference, unique per payment flow.","nullable":false},{"name":"status","type":"string","description":"Current payment status (e.g., pending, paid, failed, refunded).","nullable":false},{"name":"amount","type":"double","description":"Total amount paid by buyer (in platform currency).","nullable":false},{"name":"currency_code","type":"string","description":"Currency code (ISO 4217, e.g., USD, KRW).","nullable":false},{"name":"issued_at","type":"datetime","description":"Payment issue/initiation time.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Confirmation (settlement) timestamp, if applicable.","nullable":true},{"name":"failure_reason","type":"string","description":"Reason for payment failure if applicable (error code or description).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, if payment log is recoverably removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["payment_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"failure_reason"}]},{"name":"ai_commerce_payment_methods","description":"Catalog of all supported payment methods (card, mobile, deposit, coupon, mileage, etc.), including code, provider, business logic, and status. Methods are referenced by payments and accounts.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"method_code","type":"string","description":"Unique business code for the payment method (e.g., 'CREDIT_CARD', 'VIRTUAL_ACCOUNT').","nullable":false},{"name":"display_name","type":"string","description":"Human-readable name for the payment method.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether payment method is available for use.","nullable":false},{"name":"configuration","type":"string","description":"JSON or URI of externalized config, if present; for advanced integrations.","nullable":true},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, if method deactivated but not removed for audit reasons.","nullable":true}],"uniqueIndexes":[{"fieldNames":["method_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"ai_commerce_payment_gateways","description":"Specifies each configured payment gateway (PG provider, e.g., Inicis, PayPal, KCP), their settings, endpoint URIs, regional support, and active status. Used to route payments to gateway-specific processes.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"gateway_code","type":"string","description":"Unique code for the gateway (e.g., 'INICIS', 'KCP', 'PAYPAL').","nullable":false},{"name":"display_name","type":"string","description":"Display name for the payment gateway.","nullable":false},{"name":"api_endpoint","type":"uri","description":"Configured endpoint or base URI for gateway connectivity.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether the gateway is enabled for transactions.","nullable":false},{"name":"supported_currencies","type":"string","description":"Comma-separated list of supported currency codes.","nullable":true},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp, if gateway config is archived.","nullable":true}],"uniqueIndexes":[{"fieldNames":["gateway_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"ai_commerce_payment_transactions","description":"Represents each record of an actual payment transfer or API transaction event, linked to a payment. Includes raw gateway response, status, and audit fields. Supports compliance telemetry and evidence.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"transaction_reference","type":"string","description":"Gateway or business-assigned transaction reference code, unique per transaction flow.","nullable":false},{"name":"payment_id","type":"uuid","description":"Associated payment entity {@link ai_commerce_payments.id}.","nullable":false},{"name":"method_id","type":"uuid","description":"Associated payment method (FK, not null) {@link ai_commerce_payment_methods.id}.","nullable":false},{"name":"gateway_id","type":"uuid","description":"Payment gateway used for transaction {@link ai_commerce_payment_gateways.id}.","nullable":false},{"name":"status","type":"string","description":"Raw gateway or business transaction status (e.g., 'OK', 'FAIL', 'PENDING').","nullable":false},{"name":"amount","type":"double","description":"Transaction amount (should match payment).","nullable":false},{"name":"currency_code","type":"string","description":"Currency code used for this transaction.","nullable":false},{"name":"requested_at","type":"datetime","description":"Transaction request timestamp.","nullable":false},{"name":"completed_at","type":"datetime","description":"Transaction result timestamp, if available.","nullable":true},{"name":"gateway_payload","type":"string","description":"Raw JSON/XML gateway response or payload snapshot.","nullable":true},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["transaction_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["requested_at"]}],"ginIndexes":[]},{"name":"ai_commerce_deposit_accounts","description":"Ledger for user deposit balances (platform e-wallets). Each record is the account for a given user, supporting deposits (recharge), withdrawals, and balance. Used for payments and refunds.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"account_code","type":"string","description":"Unique account code/number/token for identification.","nullable":false},{"name":"user_id","type":"uuid","description":"Belonged user {@link ai_commerce_buyer.id} or seller for their platform deposit account (FK to user table).","nullable":false},{"name":"balance","type":"double","description":"Current deposit balance.","nullable":false},{"name":"currency_code","type":"string","description":"Currency for deposit balance.","nullable":false},{"name":"status","type":"string","description":"Status of the deposit account ('active', 'suspended').","nullable":false},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["account_code"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]}],"ginIndexes":[]},{"name":"ai_commerce_deposit_transactions","description":"Ledger of all deposit account actions (recharge, withdraw, payment, refund), with immutable audit trail. Used for compliance, rollback, and analytics.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"deposit_account_id","type":"uuid","description":"Reference to deposit account {@link ai_commerce_deposit_accounts.id}.","nullable":false},{"name":"type","type":"string","description":"Transaction type ('recharge', 'withdraw', 'payment', 'refund').","nullable":false},{"name":"amount","type":"double","description":"Amount added or subtracted (positive for credit, negative for debit).","nullable":false},{"name":"status","type":"string","description":"Transaction status (pending/confirmed/failed).","nullable":false},{"name":"counterparty_reference","type":"string","description":"External or internal reference ID (e.g., payment, refund, etc).","nullable":true},{"name":"performed_at","type":"datetime","description":"When the transaction occurred.","nullable":false},{"name":"created_at","type":"datetime","description":"Ledger entry created time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp (null for active).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["deposit_account_id"]},{"fieldNames":["performed_at"]}],"ginIndexes":[]},{"name":"ai_commerce_mileage_accounts","description":"Record containing platform mileage/point balances per user (for loyalty, incentives). Supports accrual, spend, expiry, and audit trail linkage to user entity.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"account_code","type":"string","description":"Mileage account code assigned to user for unique tracking/audit.","nullable":false},{"name":"user_id","type":"uuid","description":"User FK reference (buyer or seller) {@link ai_commerce_buyer.id}.","nullable":false},{"name":"balance","type":"double","description":"Current point balance (can never be negative).","nullable":false},{"name":"status","type":"string","description":"Current state of this mileage account (active, suspended, closed).","nullable":false},{"name":"created_at","type":"datetime","description":"Account creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Account last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["account_code"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]}],"ginIndexes":[]},{"name":"ai_commerce_mileage_transactions","description":"Ledger of all mileage/point earning and redemption events (reasons: purchase, campaign, refund, admin adjustment). Used for compliance and rewards analytics.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"mileage_account_id","type":"uuid","description":"FK reference to mileage account {@link ai_commerce_mileage_accounts.id}.","nullable":false},{"name":"type","type":"string","description":"Transaction type (accrual, redemption, adjustment, expiration).","nullable":false},{"name":"amount","type":"double","description":"Point amount (positive for accrual, negative for spend/expire).","nullable":false},{"name":"status","type":"string","description":"Transaction status (confirmed, pending, failed, expired).","nullable":false},{"name":"reference_entity","type":"string","description":"Reference to related entity (order, campaign, refund, etc).","nullable":true},{"name":"transacted_at","type":"datetime","description":"When points were transacted.","nullable":false},{"name":"created_at","type":"datetime","description":"Entry created time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp when retired.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["mileage_account_id"]},{"fieldNames":["transacted_at"]}],"ginIndexes":[]},{"name":"ai_commerce_coupons","description":"Definition and rules for all coupons issued by the platform or sellers. Includes type, max usage, period, applicable users/products, business validation, and compliance fields. Used as parent to issues/uses/audits.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"coupon_code","type":"string","description":"Globally unique code or token for coupon.","nullable":false},{"name":"type","type":"string","description":"Type of coupon (amount, percent, shipping, etc).","nullable":false},{"name":"valid_from","type":"datetime","description":"Coupon validity start date/time.","nullable":false},{"name":"valid_until","type":"datetime","description":"Coupon expiry date/time.","nullable":false},{"name":"issued_by","type":"uuid","description":"Issuer (admin or seller) {@link ai_commerce_admin.id} or {@link ai_commerce_seller.id}.","nullable":true},{"name":"max_uses","type":"int","description":"Total number of times this coupon can be used on the platform (global limit).","nullable":true},{"name":"conditions","type":"string","description":"JSON/YAML/Rule describing applicable entities or rules for this coupon.","nullable":true},{"name":"status","type":"string","description":"Current status (active, expired, revoked).","nullable":false},{"name":"created_at","type":"datetime","description":"Created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete (retirement) if staged out of circulation.","nullable":true}],"uniqueIndexes":[{"fieldNames":["coupon_code"],"unique":true}],"plainIndexes":[{"fieldNames":["valid_from","valid_until"]}],"ginIndexes":[]},{"name":"ai_commerce_coupon_issues","description":"Record of each issued coupon (to user/account), unique by coupon/session. Includes usage state, issued to, expiration, and batch campaign reference. Managed as subsidiary entity to coupons.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"coupon_id","type":"uuid","description":"Reference to coupon master {@link ai_commerce_coupons.id}.","nullable":false},{"name":"issued_to","type":"uuid","description":"FK reference to issued user account (buyer or seller, or member, depending on campaign) {@link ai_commerce_buyer.id}.","nullable":false},{"name":"status","type":"string","description":"Issued coupon status (issued, redeemed, expired, revoked).","nullable":false},{"name":"issued_at","type":"datetime","description":"Timestamp of coupon issue.","nullable":false},{"name":"expires_at","type":"datetime","description":"Issue-specific expiration (can override master coupon window).","nullable":false},{"name":"redeemed_at","type":"datetime","description":"When this issued coupon was redeemed (if used).","nullable":true},{"name":"batch_reference","type":"string","description":"Batch/campaign or unique series identifier if issued as part of a campaign.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["coupon_id"]},{"fieldNames":["issued_to"]},{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"ai_commerce_coupon_uses","description":"Record of coupon redemption (each use event matching order/payment, user, and coupon issue). Tracks who/when/where for audit, evidence, and fraud detection. Not independently managed.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"coupon_issue_id","type":"uuid","description":"Reference to coupon issuance event {@link ai_commerce_coupon_issues.id}.","nullable":false},{"name":"redeemed_by","type":"uuid","description":"User or entity that redeemed the coupon {@link ai_commerce_buyer.id}.","nullable":false},{"name":"order_id","type":"uuid","description":"Order where coupon was used (for audit) {@link ai_commerce_orders.id}.","nullable":true},{"name":"redeemed_at","type":"datetime","description":"Timestamp of coupon redemption.","nullable":false},{"name":"status","type":"string","description":"Redemption status (success, rejected, failed, revoked).","nullable":false},{"name":"created_at","type":"datetime","description":"Created at.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["redeemed_by"]},{"fieldNames":["status"]}],"ginIndexes":[]},{"name":"ai_commerce_coupon_audits","description":"Immutable, append-only snapshot record of any coupon lifecycle, usage, or policy actions (issue, use, redemption, revocation, etc.) for compliance and evidence review.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"coupon_id","type":"uuid","description":"Coupon being audited {@link ai_commerce_coupons.id}.","nullable":false},{"name":"event_type","type":"string","description":"Business event: issue, use, validate, expire, revoke, adjust, etc.","nullable":false},{"name":"event_reference","type":"string","description":"Any reference entity (order, payment, campaign, etc) relevant to the event.","nullable":true},{"name":"note","type":"string","description":"Free-format reason or audit log memo.","nullable":true},{"name":"event_timestamp","type":"datetime","description":"Timestamp when audit event was created.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["coupon_id"]},{"fieldNames":["event_type"]}],"ginIndexes":[]},{"name":"ai_commerce_payment_fraud_events","description":"System-detected or manually logged fraud/suspicious activity records for payments, coupons, deposits, or mileage. Supports forensic audit, compliance, and evidence investigation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"event_code","type":"string","description":"Unique or patterned code for this fraud event (e.g., 'MULTI_REDEMPTION', 'ABUSE', 'EXTERNAL_INCIDENT').","nullable":false},{"name":"entity_type","type":"string","description":"Entity affected (payment, coupon, deposit, mileage, transaction).","nullable":false},{"name":"entity_id","type":"uuid","description":"ID of the affected entity (refer to the model by type).","nullable":false},{"name":"status","type":"string","description":"Fraud event investigation status (detected, under_review, confirmed, dismissed).","nullable":false},{"name":"description","type":"string","description":"Description or reason for the event.","nullable":true},{"name":"detected_at","type":"datetime","description":"When this event was detected by system/user.","nullable":false},{"name":"reviewed_at","type":"datetime","description":"Timestamp of last review/update on status, if available.","nullable":true},{"name":"created_at","type":"datetime","description":"Created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["entity_type"]},{"fieldNames":["status"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"ai_commerce_payment_analytics","description":"Aggregated or denormalized table for payment/coupon summary analytics (by period, channel, method, gateway). Designed for performance queries, BI, and reporting; no direct business mutations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"period_start","type":"datetime","description":"Analytics time period start.","nullable":false},{"name":"period_end","type":"datetime","description":"Analytics time period end.","nullable":false},{"name":"channel_id","type":"uuid","description":"Channel for which analytics is aggregated {@link ai_commerce_channels.id}.","nullable":false},{"name":"method_id","type":"uuid","description":"Payment method for this analytic window {@link ai_commerce_payment_methods.id}.","nullable":false},{"name":"gateway_id","type":"uuid","description":"Gateway involved in analytics window {@link ai_commerce_payment_gateways.id}.","nullable":false},{"name":"total_payments","type":"int","description":"Total payment count.","nullable":false},{"name":"total_amount","type":"double","description":"Total payment amount (sum).","nullable":false},{"name":"total_refunds","type":"int","description":"Count of refunds in period.","nullable":false},{"name":"coupon_uses","type":"int","description":"Coupon usage count for period.","nullable":false},{"name":"mileage_redemptions","type":"int","description":"Mileage redemption count in period.","nullable":false},{"name":"deposit_usages","type":"int","description":"Deposit used in payment count in period.","nullable":false},{"name":"created_at","type":"datetime","description":"Aggregation record created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Updated.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["period_start","period_end"]},{"fieldNames":["channel_id"]},{"fieldNames":["method_id"]},{"fieldNames":["gateway_id"]}],"ginIndexes":[]}]},{"filename":"schema-09-ugc.prisma","namespace":"UGC","models":[{"name":"ai_commerce_bulletins","description":"Admin/seller-created notices; supports moderation, comments, attachments, audit, and evidence snapshotting. Independent entity for announcements and communication.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"author_id","type":"uuid","description":"FK to user(account) posting the bulletin ({@link ai_commerce_buyer.id}).","relation":{"name":"author","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Bulletin title (shown to user, full-text search).","nullable":false},{"name":"body","type":"string","description":"Bulletin body content. May use HTML/markdown (full-text search).","nullable":false},{"name":"visibility","type":"string","description":"public/private/role-based scope flag.","nullable":false},{"name":"status","type":"string","description":"draft/published/suspended/deleted business status.","nullable":false},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["author_id","title"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["status"]}],"ginIndexes":[{"fieldName":"body"},{"fieldName":"title"}]},{"name":"ai_commerce_inquiries","description":"Buyer/user questions, linked to products, supporting responses, audit, moderation, edit history, and evidence. Controlled visibility; tied to product and buyer.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"author_id","type":"uuid","description":"FK to buyer who asks the question.","relation":{"name":"author","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"product_id","type":"uuid","description":"FK to product the inquiry is about.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"question","type":"string","description":"Inquiry content text.","nullable":false},{"name":"visibility","type":"string","description":"Inquiry visibility scope.","nullable":false},{"name":"answer","type":"string","description":"Answer text (nullable until answered; see edit history for versions).","nullable":true},{"name":"status","type":"string","description":"Status: open/answered/moderating/deleted.","nullable":false},{"name":"created_at","type":"datetime","description":"When inquiry was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete marker for compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["author_id","product_id","question"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"question"}]},{"name":"ai_commerce_reviews","description":"Product/order review (buyer to product), single per order item, with support for answer, audit, moderation, attachment link, versioning/snapshotting, and evidence/history. Key UGC entity for compliance and feedback.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"author_id","type":"uuid","description":"FK to buyer who wrote review.","relation":{"name":"author","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"order_item_id","type":"uuid","description":"FK to reviewed order item (unique per review).","relation":{"name":"orderItem","targetModel":"ai_commerce_order_items"},"unique":true,"nullable":false}],"plainFields":[{"name":"rating","type":"int","description":"Numeric review score.","nullable":false},{"name":"body","type":"string","description":"Free-text review content.","nullable":false},{"name":"seller_response","type":"string","description":"Seller reply (nullable; see edit history for previous responses).","nullable":true},{"name":"visibility","type":"string","description":"Scope: public/private/etc.","nullable":false},{"name":"status","type":"string","description":"Moderation/publication status.","nullable":false},{"name":"created_at","type":"datetime","description":"Created timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete for audit/evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["author_id","order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["status"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"ai_commerce_comments","description":"Comments/replies on any UGC (bulletin, inquiry, review, or a nested comment), including moderation and evidence. Supports self-nesting, soft delete, and audit trails.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"author_id","type":"uuid","description":"FK to commenter (buyer).","relation":{"name":"author","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"parent_comment_id","type":"uuid","description":"Self-nesting for replies/threads (nullable, FK to ai_commerce_comments).","relation":{"name":"parentComment","targetModel":"ai_commerce_comments","mappingName":"recursive"},"unique":false,"nullable":true},{"name":"bulletin_id","type":"uuid","description":"FK to bulletin if this is a reply to a bulletin (nullable).","relation":{"name":"bulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"inquiry_id","type":"uuid","description":"FK to inquiry (nullable).","relation":{"name":"inquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"review_id","type":"uuid","description":"FK to review (nullable).","relation":{"name":"review","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true}],"plainFields":[{"name":"body","type":"string","description":"Comment content.","nullable":false},{"name":"status","type":"string","description":"Moderation status/flag.","nullable":false},{"name":"created_at","type":"datetime","description":"Created datetime.","nullable":false},{"name":"updated_at","type":"datetime","description":"Updated datetime.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deleted timestamp, or null.","nullable":true}],"uniqueIndexes":[{"fieldNames":["author_id","created_at"],"unique":true}],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"ai_commerce_ugc_attachments","description":"UGC-linked attachment: links a single attachment to a specific UGC entity for evidence retention. All references use IRelation to the correct UGC table or attachment model.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ugc_entity_id","type":"uuid","description":"FK to target UGC entity (bulletin, inquiry, review, or comment, union via explicit FK—set only one, others nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_id_inquiry","type":"uuid","description":"FK to target inquiry (nullable, if this is attachment to inquiry).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_id_review","type":"uuid","description":"FK to target review (nullable, if this is attachment to review).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_id_comment","type":"uuid","description":"FK to target comment (nullable, if this is attachment to comment).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true},{"name":"attachment_id","type":"uuid","description":"FK to the file in ai_commerce_attachments.","relation":{"name":"attachment","targetModel":"ai_commerce_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"version","type":"int","description":"Attachment version number.","nullable":false},{"name":"created_at","type":"datetime","description":"Attachment creation timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp (nullable).","nullable":true}],"uniqueIndexes":[{"fieldNames":["attachment_id","ugc_entity_id","ugc_entity_id_inquiry","ugc_entity_id_review","ugc_entity_id_comment"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_ugc_moderation","description":"Moderation/audit event for UGC entities. Every moderation row is attached directly to the UGC row by real IRelation only. Actor/admin is always required.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ugc_entity_bulletin_id","type":"uuid","description":"FK to moderated bulletin (nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_inquiry_id","type":"uuid","description":"FK to moderated inquiry (nullable).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_review_id","type":"uuid","description":"FK to moderated review (nullable).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_comment_id","type":"uuid","description":"FK to moderated comment (nullable).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true},{"name":"moderator_id","type":"uuid","description":"FK to moderator/admin performing the action.","relation":{"name":"moderator","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false}],"plainFields":[{"name":"action","type":"string","description":"Action taken (approve/reject/etc).","nullable":false},{"name":"result","type":"string","description":"Outcome/result.","nullable":false},{"name":"reason","type":"string","description":"Business context/reason (nullable).","nullable":true},{"name":"evidence_snapshot_id","type":"uuid","description":"FK to related ugc_snapshot, if any (nullable).","relation":{"name":"evidenceSnapshot","targetModel":"ai_commerce_ugc_snapshots"},"unique":false,"nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["action"]}],"ginIndexes":[]},{"name":"ai_commerce_ugc_snapshots","description":"Full state snapshot for UGC entity versioning/audit. Each foreign key targets explicit tables. Used for compliance and rollback, referenced from histories and moderation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ugc_entity_bulletin_id","type":"uuid","description":"FK to bulletin (nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_inquiry_id","type":"uuid","description":"FK to inquiry (nullable).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_review_id","type":"uuid","description":"FK to review (nullable).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_comment_id","type":"uuid","description":"FK to comment (nullable).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true},{"name":"actor_id","type":"uuid","description":"FK to actor (admin/moderator/buyer).","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false}],"plainFields":[{"name":"snapshot_data","type":"string","description":"Full entity JSON/text at this snapshot.","nullable":false},{"name":"change_reason","type":"string","description":"Business context/change reason (nullable).","nullable":true},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_ugc_edit_history","description":"Edits/revisions for UGC entities; tracks actor, affected record, and predecessor chain for evidence and rollback. All foreign keys use explicit IRelation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ugc_entity_bulletin_id","type":"uuid","description":"FK to bulletin (nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_inquiry_id","type":"uuid","description":"FK to inquiry (nullable).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_review_id","type":"uuid","description":"FK to review (nullable).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_comment_id","type":"uuid","description":"FK to comment (nullable).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true},{"name":"actor_id","type":"uuid","description":"FK to actor responsible for edit.","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false},{"name":"previous_edit_id","type":"uuid","description":"FK to previous edit entry (for edit chain; nullable).","relation":{"name":"previousEdit","targetModel":"ai_commerce_ugc_edit_history","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"before_state","type":"string","description":"Entity JSON/text before edit.","nullable":false},{"name":"after_state","type":"string","description":"Entity JSON/text after edit.","nullable":false},{"name":"edit_summary","type":"string","description":"Summary for UI/notifications.","nullable":false},{"name":"created_at","type":"datetime","description":"Edit event time.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_ugc_notifications","description":"Notification event for UGC (update or moderation); foreign fields always reference actual entities/tables using explicit IRelation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"notification_target_id","type":"uuid","description":"FK recipient user (buyer only here).","relation":{"name":"notificationTarget","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"ugc_entity_bulletin_id","type":"uuid","description":"FK to bulletin triggering notification (nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_inquiry_id","type":"uuid","description":"FK to inquiry (nullable).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_review_id","type":"uuid","description":"FK to review (nullable).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_comment_id","type":"uuid","description":"FK to comment (nullable).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Type of notification (created/responded/moderated/etc).","nullable":false},{"name":"status","type":"string","description":"Status: sent/queued/seen/failed/withdrawn.","nullable":false},{"name":"message","type":"string","description":"Notification body/message.","nullable":false},{"name":"created_at","type":"datetime","description":"When created.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_commerce_ugc_audit_logs","description":"Audit/compliance log for UGC state changes; all foreign keys use explicit IRelation, targeting only actual UGC entities or acting admin.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"ugc_entity_bulletin_id","type":"uuid","description":"FK to bulletin (nullable).","relation":{"name":"ugcEntityBulletin","targetModel":"ai_commerce_bulletins"},"unique":false,"nullable":true},{"name":"ugc_entity_inquiry_id","type":"uuid","description":"FK to inquiry (nullable).","relation":{"name":"ugcEntityInquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":true},{"name":"ugc_entity_review_id","type":"uuid","description":"FK to review (nullable).","relation":{"name":"ugcEntityReview","targetModel":"ai_commerce_reviews"},"unique":false,"nullable":true},{"name":"ugc_entity_comment_id","type":"uuid","description":"FK to comment (nullable).","relation":{"name":"ugcEntityComment","targetModel":"ai_commerce_comments"},"unique":false,"nullable":true},{"name":"actor_id","type":"uuid","description":"FK to actor (admin/moderator).","relation":{"name":"actor","targetModel":"ai_commerce_admin"},"unique":false,"nullable":false}],"plainFields":[{"name":"action_type","type":"string","description":"Kind of operation performed.","nullable":false},{"name":"action_result","type":"string","description":"Result string/outcome.","nullable":false},{"name":"before_state","type":"string","description":"Entity JSON/text before action.","nullable":false},{"name":"after_state","type":"string","description":"Entity JSON/text after action.","nullable":false},{"name":"created_at","type":"datetime","description":"Log creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[],"ginIndexes":[]}]},{"filename":"schema-10-favorites.prisma","namespace":"Favorites","models":[{"name":"ai_commerce_favorites_products","description":"Favorites of products by users. Core personalization entity for expressing interest in products, supporting search, organizing in folders, snapshotting target product state, and triggering notification workflows. References users, products, product snapshots, folders, and is soft deletable for privacy. Each favorite is unique per user-product pair. Main business table for product favoriting workflows.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Referenced user's {@link ai_commerce_buyer.id} or {@link ai_commerce_seller.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"product_id","type":"uuid","description":"Target product's {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false},{"name":"folder_id","type":"uuid","description":"Optional folder for grouping. References {@link ai_commerce_favorites_folders.id}.","relation":{"name":"folder","targetModel":"ai_commerce_favorites_folders"},"unique":false,"nullable":true},{"name":"snapshot_id","type":"uuid","description":"Associated product snapshot at the moment of favoriting, {@link ai_commerce_favorites_product_snapshots.id}.","relation":{"name":"snapshot","targetModel":"ai_commerce_favorites_product_snapshots"},"unique":true,"nullable":false}],"plainFields":[{"name":"label","type":"string","description":"User-assigned label for organization/personal search.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp if removed by user.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id","product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]},{"fieldNames":["folder_id"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"ai_commerce_favorites_inquiries","description":"Favorites of product inquiries by users. Allows buyers/sellers to bookmark key Q&As for quick access to information. Tracks user, inquiry, optional folder, and locks in a snapshot at time of favoriting. Each user can favorite the same inquiry only once. Supports notification and audit workflows.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Referenced user (buyer/seller) {@link ai_commerce_buyer.id} or {@link ai_commerce_seller.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"inquiry_id","type":"uuid","description":"Target product inquiry's {@link ai_commerce_inquiries.id}.","relation":{"name":"inquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":false},{"name":"folder_id","type":"uuid","description":"Optional grouping folder. {@link ai_commerce_favorites_folders.id}.","relation":{"name":"folder","targetModel":"ai_commerce_favorites_folders"},"unique":false,"nullable":true},{"name":"snapshot_id","type":"uuid","description":"Snapshot of inquiry at time of favoriting. {@link ai_commerce_favorites_inquiry_snapshots.id}.","relation":{"name":"snapshot","targetModel":"ai_commerce_favorites_inquiry_snapshots"},"unique":true,"nullable":false}],"plainFields":[{"name":"label","type":"string","description":"User-given label for search/organization.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp if removed by user.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id","inquiry_id"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]},{"fieldNames":["folder_id"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"ai_commerce_favorites_addresses","description":"Favorites of user addresses for checkout or delivery. Allows buyers/sellers to tag, organize, and receive alerts on preferred shipping locations. Snapshots state at time of favoriting for audit. Each favorite is unique per user-address pair. Supports organization.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Referenced user (buyer/seller) {@link ai_commerce_buyer.id} or {@link ai_commerce_seller.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"address_id","type":"uuid","description":"Target user address's {@link ai_commerce_user_addresses.id}.","relation":{"name":"address","targetModel":"ai_commerce_user_addresses"},"unique":false,"nullable":false},{"name":"folder_id","type":"uuid","description":"Optional grouping folder. {@link ai_commerce_favorites_folders.id}.","relation":{"name":"folder","targetModel":"ai_commerce_favorites_folders"},"unique":false,"nullable":true},{"name":"snapshot_id","type":"uuid","description":"Snapshot of address at time of favoriting. {@link ai_commerce_favorites_address_snapshots.id}.","relation":{"name":"snapshot","targetModel":"ai_commerce_favorites_address_snapshots"},"unique":true,"nullable":false}],"plainFields":[{"name":"label","type":"string","description":"User label for organizational/searching purpose.","nullable":true},{"name":"primary","type":"boolean","description":"Whether this is the user's primary address out of favorites.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp if removed by user.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id","address_id"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]},{"fieldNames":["folder_id"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"ai_commerce_favorites_folders","description":"Organizational folders per user, to group/categorize favorites (products, inquiries, addresses). Users can create, rename, remove, and search among folders. Folders cannot be shared. Naming collision not allowed per user. Standalone business entity for favorite organization.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Folder owner. References {@link ai_commerce_buyer.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Folder name unique per user.","nullable":false},{"name":"description","type":"string","description":"Optional description for folder's organizational purpose.","nullable":true},{"name":"created_at","type":"datetime","description":"Folder creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Folder last updated timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Folder deleted timestamp if user removes.","nullable":true}],"uniqueIndexes":[{"fieldNames":["user_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["user_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_favorites_product_snapshots","description":"Historical snapshot of the product at time of favoriting. Used to provide evidence, rollback, and change trackers for favorites. Contains copy of business-critical fields at snapshot moment. Read-only, append-only entity referenced by favorites and audit logs.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Snapshot target's {@link ai_commerce_products.id}.","relation":{"name":"product","targetModel":"ai_commerce_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Product name at snapshot.","nullable":false},{"name":"description","type":"string","description":"Product description at snapshot.","nullable":false},{"name":"price","type":"double","description":"Product price at time of snapshot.","nullable":false},{"name":"available","type":"boolean","description":"Was product available for purchase at snapshot?","nullable":false},{"name":"snapshot_date","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["product_id"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"ai_commerce_favorites_inquiry_snapshots","description":"Historical snapshot of inquiry state at the point of being favorited. Includes main Q&A content, status, timestamps. Supports audit trail for favorited inquiries. Read-only, referenced by favorites, retains immutable evidence for legal/dispute/compliance need.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"inquiry_id","type":"uuid","description":"Referenced inquiry's {@link ai_commerce_inquiries.id}.","relation":{"name":"inquiry","targetModel":"ai_commerce_inquiries"},"unique":false,"nullable":false}],"plainFields":[{"name":"question","type":"string","description":"Inquiry question body at the time of snapshot.","nullable":false},{"name":"answer","type":"string","description":"Answer content at snapshot (if available).","nullable":true},{"name":"status","type":"string","description":"Status of inquiry at snapshot (open, answered, closed, etc).","nullable":false},{"name":"snapshot_date","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["inquiry_id"]}],"ginIndexes":[]},{"name":"ai_commerce_favorites_address_snapshots","description":"Historical snapshot of a user's address at the moment of favoriting. Holds full address structure as favorited, for evidence and audit support. Used by address favorite references and legal/compliance processes. Append-only, read-only entity.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"address_id","type":"uuid","description":"Referenced address's {@link ai_commerce_user_addresses.id}.","relation":{"name":"address","targetModel":"ai_commerce_user_addresses"},"unique":false,"nullable":false}],"plainFields":[{"name":"country_code","type":"string","description":"Country code at favoriting time.","nullable":false},{"name":"city","type":"string","description":"City or locality at snapshot.","nullable":false},{"name":"postal_code","type":"string","description":"Postal code value at snapshot.","nullable":false},{"name":"line1","type":"string","description":"First line of address at time of snapshot.","nullable":false},{"name":"line2","type":"string","description":"Second line or detail, nullable.","nullable":true},{"name":"recipient_name","type":"string","description":"Name of address's recipient at snapshot.","nullable":false},{"name":"phone","type":"string","description":"Recipient contact at snapshot.","nullable":false},{"name":"snapshot_date","type":"datetime","description":"Snapshot timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["address_id"]}],"ginIndexes":[]},{"name":"ai_commerce_favorites_alerts","description":"Personal alert triggers for favorite changes—used to power notification logic. Associates favorite with alerting configuration or state; tracks what triggers notifications (stock, price, answer, etc) and per-user preferences. Considered subsidiary, not independently managed apart from favorite lifecycle.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_id","type":"uuid","description":"Favorite entity this alert is for. Could link to product/inquiry/address favorites via explicit field or polymorphic resolver in implementation. Example uses {@link ai_commerce_favorites_products.id}.","relation":{"name":"favorite","targetModel":"ai_commerce_favorites_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"alert_type","type":"string","description":"Business event triggering alert (e.g. price_drop, answer_posted, restocked, etc).","nullable":false},{"name":"is_enabled","type":"boolean","description":"Is this alert active for the current user?","nullable":false},{"name":"last_triggered_at","type":"datetime","description":"Timestamp when alert last triggered.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["favorite_id"]}],"ginIndexes":[{"fieldName":"alert_type"}]},{"name":"ai_commerce_favorites_notifications","description":"Outbound notification events for favorite-related triggers (price drop, restock, delivery update). Notifies the user of change or activity on healthy favorite. Supports presentation and delivery state tracking and is queryable for user notification inbox/history. Tracked per favorite and user.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Notification target user. {@link ai_commerce_buyer.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false},{"name":"favorite_id","type":"uuid","description":"Related favorite entity (product, inquiry, address favorite). See {@link ai_commerce_favorites_products.id} etc.","relation":{"name":"favorite","targetModel":"ai_commerce_favorites_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"notification_type","type":"string","description":"Type of notification event (e.g. price_drop, status_update, missing, etc).","nullable":false},{"name":"delivered_at","type":"datetime","description":"Timestamp when notification was delivered to user.","nullable":false},{"name":"read_at","type":"datetime","description":"Timestamp user read the notification, if any.","nullable":true},{"name":"created_at","type":"datetime","description":"Notification creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["user_id"]},{"fieldNames":["favorite_id"]}],"ginIndexes":[{"fieldName":"notification_type"}]},{"name":"ai_commerce_favorites_audit_logs","description":"Audit log entries for state changes to favorites: created, updated, removed, notified, alert switched, reason for changes, etc. Enables compliance, forensics, and legal evidence. Tracks before/after, actor, reason, and result.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_id","type":"uuid","description":"Favorite entity audited (links to favorites table as needed for audit). Example: {@link ai_commerce_favorites_products.id}.","relation":{"name":"favorite","targetModel":"ai_commerce_favorites_products"},"unique":false,"nullable":false},{"name":"actor_user_id","type":"uuid","description":"Who performed action logged. References {@link ai_commerce_buyer.id}.","relation":{"name":"actorUser","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"action","type":"string","description":"Type of event audited (favorite_created, removed, label_changed, etc).","nullable":false},{"name":"reason","type":"string","description":"Rational provided for audit log event. Optional.","nullable":true},{"name":"before_state","type":"string","description":"Snapshot or summary of favorite before change (JSON serialized if needed).","nullable":true},{"name":"after_state","type":"string","description":"Snapshot or summary after change (JSON serialized if needed).","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp for when the audit log event occurred.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["favorite_id"]}],"ginIndexes":[{"fieldName":"action"}]},{"name":"ai_commerce_attachments","description":"Main attachment entity for any uploaded asset (file, image, document) submitted with favorite, notification, or alert events. Tracks user ownership, business context, linkage to favorite/notification, and status. Key for evidentiary and personalization workflows. Each attachment has its own versions and metadata details. Standalone table for uploaded files.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"user_id","type":"uuid","description":"Uploader's user ID. References {@link ai_commerce_buyer.id} or {@link ai_commerce_seller.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":false}],"plainFields":[{"name":"filename","type":"string","description":"Original file name at upload.","nullable":false},{"name":"business_type","type":"string","description":"Business purpose (e.g. favorite_screenshot, notification_attachment, etc).","nullable":false},{"name":"status","type":"string","description":"Attachment state (active, quarantined, deleted, etc).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["user_id"]}],"ginIndexes":[{"fieldName":"filename"}]},{"name":"ai_commerce_attachment_versions","description":"Snapshot/versioning table for each uploaded file. New record created for every content or metadata update, supporting full history and legal audit. Immutable and read-only; every attachment can have multiple versions (lifecycle, legal, dispute evidence, rollbacks).","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"attachment_id","type":"uuid","description":"Referenced attachment {@link ai_commerce_attachments.id}.","relation":{"name":"attachment","targetModel":"ai_commerce_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"version","type":"int","description":"Monotonic version sequence, starts at 1.","nullable":false},{"name":"file_url","type":"uri","description":"Location of stored file at this version (could be S3, CDN, etc).","nullable":false},{"name":"hash","type":"string","description":"File hash value for content verification.","nullable":true},{"name":"change_reason","type":"string","description":"Reason or context for file update/version increment.","nullable":true},{"name":"created_at","type":"datetime","description":"Snapshot/version creation timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["attachment_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["attachment_id"]}],"ginIndexes":[]},{"name":"ai_commerce_attachment_metadata","description":"Attachment additional metadata, e.g. image size, document type, analysis, AI-derived tags, etc. Subsidiary/supporting table for compliance, analytics, and asset search. Attachment can reference zero, one, or many metadata records. Updated on each version or new upload as needed.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"attachment_id","type":"uuid","description":"Attachment this metadata is for. References {@link ai_commerce_attachments.id}.","relation":{"name":"attachment","targetModel":"ai_commerce_attachments"},"unique":false,"nullable":false}],"plainFields":[{"name":"meta_key","type":"string","description":"Type of metadata (e.g. exif, file_type, generated_tag, ai_analysis, etc).","nullable":false},{"name":"meta_value","type":"string","description":"Metadata value (serialized, stringified, or raw).","nullable":false},{"name":"created_at","type":"datetime","description":"Metadata creation timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["attachment_id"]}],"ginIndexes":[{"fieldName":"meta_key"}]},{"name":"ai_commerce_attachment_access_audit","description":"Access log for every read/copy/download of any attachment file. Records which user, when, how, and with what result. Powers compliance with legal and forensic access requirements as well as operational analytics. Each entry tracks the user (if any), attachment, access type, and result. Append-only for audit.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"attachment_id","type":"uuid","description":"Targeted attachment file. References {@link ai_commerce_attachments.id}.","relation":{"name":"attachment","targetModel":"ai_commerce_attachments"},"unique":false,"nullable":false},{"name":"user_id","type":"uuid","description":"User who accessed file (if any). References {@link ai_commerce_buyer.id} or {@link ai_commerce_seller.id}.","relation":{"name":"user","targetModel":"ai_commerce_buyer"},"unique":false,"nullable":true}],"plainFields":[{"name":"access_type","type":"string","description":"Type of operation (read, download, preview, etc).","nullable":false},{"name":"result","type":"string","description":"Outcome for access (success, denied, error, etc).","nullable":false},{"name":"timestamp","type":"datetime","description":"When access occurred.","nullable":false},{"name":"ip_address","type":"string","description":"IP address recorded for access (if available).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["attachment_id"]}],"ginIndexes":[{"fieldName":"access_type"}]}]}]}