/// Represents a sales channel (e.g., web, mobile app, partner portal) within
/// the commerce platform. Supports configuration for unique business rules,
/// localization, activation, and channel-specific analytics. Channels act as
/// the top-level context for sections, categories, and templates, and link
/// to analytics and settings via FKs.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_channels {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique business identifier code for the channel. Cannot be changed after
  /// creation.
  code String
  
  /// Human-readable channel name (e.g., 'Korea Main Portal').
  name String
  
  /// Default locale (e.g., 'ko-KR', 'en-US'). Defines language and formatting
  /// for this channel.
  locale String
  
  /// Whether the channel is currently active and visible for business
  /// operations.
  is_active Boolean
  
  /// Current business-specific status or workflow stage for the channel (e.g.,
  /// 'normal', 'pending audit', 'archived').
  business_status String
  
  /// Timestamp for channel creation.
  created_at DateTime
  
  /// Timestamp for last channel update.
  updated_at DateTime
  
  /// Soft delete field for logical removal; null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  ai_commerce_channel_settings ai_commerce_channel_settings[]
  ai_commerce_sections ai_commerce_sections[]
  ai_commerce_categories ai_commerce_categories[]
  ai_commerce_analytics_channels ai_commerce_analytics_channels?
  ai_commerce_orders ai_commerce_orders[]
  
  @@unique([code])
  @@index([locale])
  @@index([is_active])
}

/// Holds additional configuration properties for each channel, such as
/// custom branding, external endpoints, feature toggles, or advanced rules.
/// Each row references a channel, providing extensibility and modular
/// configuration management. Managed primarily by administrators.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_channel_settings {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent channel's {@link ai_commerce_channels.id}. Establishes a 1:N
  /// relationship to support multiple settings per channel.
  ai_commerce_channel_id String
  
  /// Configuration key name (e.g., 'feature_discount_enabled', 'theme_color').
  key String
  
  /// Value for configuration key. May be text, URI, or serialized settings
  /// (depending on business logic).
  value String
  
  /// Timestamp when setting was created.
  created_at DateTime
  
  /// Timestamp when setting was last updated.
  updated_at DateTime
  
  /// Soft delete for logical removal; null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel ai_commerce_channels @relation(fields: [ai_commerce_channel_id], references: [id], onDelete: Cascade)
  
  @@unique([ai_commerce_channel_id, key])
}

/// Defines sections or merchandising areas within a channel (e.g.,
/// 'Electronics', 'Flash Deals'). Represents logical groupings beneath
/// channels for product curation, configuration, and personalized displays.
/// Used by both admin and AI systems. Hierarchically independent of
/// categories.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_sections {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent channel's {@link ai_commerce_channels.id}. Each section belongs to
  /// one channel.
  ai_commerce_channel_id String
  
  /// Unique code for section per channel. Used for internal references, must
  /// be unique within the parent channel.
  code String
  
  /// Display name for the section (e.g., 'Deals', 'Main Banner').
  name String
  
  /// Section operational status; inactive sections are hidden from users.
  is_active Boolean
  
  /// Business workflow status for the section (e.g., 'normal', 'archived',
  /// 'pending').
  business_status String
  
  /// Display sort order for this section within the channel.
  sort_order Int
  
  /// Creation timestamp for the section.
  created_at DateTime
  
  /// Last modification timestamp for the section.
  updated_at DateTime
  
  /// Soft delete timestamp for logical removal; null if section is active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel ai_commerce_channels @relation(fields: [ai_commerce_channel_id], references: [id], onDelete: Cascade)
  
  ai_commerce_product_section_bindings ai_commerce_product_section_bindings[]
  
  @@unique([ai_commerce_channel_id, code])
  @@index([is_active])
  @@index([sort_order])
}

/// Defines product categories as a tree structure, supporting arbitrary
/// hierarchy depths. Categories are mapped to channels and used for
/// discovery, filtering, analytics, and business rule enforcement. Preserves
/// referential integrity for parent-child relationships and supports soft
/// deletion and audit trails.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_categories {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent channel for this category. Reference to {@link
  /// ai_commerce_channels.id}.
  ai_commerce_channel_id String
  
  /// Optional self-reference to parent category (for hierarchy). Null for
  /// top-level categories. {@link ai_commerce_categories.id}.
  parent_id String?
  
  /// Unique category code per channel, used for internal mapping.
  code String
  
  /// Display name for the category (e.g., 'Accessories').
  name String
  
  /// Hierarchy depth level (0 for root/top-level).
  level Int
  
  /// Order within siblings for display purposes.
  sort_order Int
  
  /// Indicates whether the category is active/visible.
  is_active Boolean
  
  /// Business or workflow status (e.g., 'active', 'archived').
  business_status String
  
  /// Creation timestamp for the category.
  created_at DateTime
  
  /// Last modification timestamp for the category.
  updated_at DateTime
  
  /// Soft delete for logical removal; null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel ai_commerce_channels @relation(fields: [ai_commerce_channel_id], references: [id], onDelete: Cascade)
  parent ai_commerce_categories? @relation("recursive", fields: [parent_id], references: [id], onDelete: Cascade)
  
  recursive ai_commerce_categories[] @relation("recursive")
  ai_commerce_product_category_bindings ai_commerce_product_category_bindings[]
  
  @@unique([ai_commerce_channel_id, code])
  @@index([parent_id])
}

/// Reusable section configuration templates, allowing administrators to
/// rapidly define and propagate merchandising/grouping setup across
/// channels. Templates capture configuration presets, default status, and
/// metadata for AI-powered or manual section setup.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_section_templates {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique template identifier code.
  code String
  
  /// Human-friendly name of the section template.
  name String
  
  /// Serialized configuration data (JSON or similar) representing the
  /// structure and rules of the template.
  template_data String
  
  /// Marks templates as system default for rapid section creation.
  is_default Boolean
  
  /// Current business or operational workflow status for the template.
  business_status String
  
  /// Timestamp for template creation.
  created_at DateTime
  
  /// Timestamp of last template update.
  updated_at DateTime
  
  /// Soft delete; null for active templates.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([code])
}

/// Reusable configuration templates for category trees or segments. Enable
/// cross-channel or multi-project reuse, bulk creation, and rapid curation
/// of category schemas. Serves as blueprint for consistent category
/// organization and AI/analytical applications.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_category_templates {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique template identifier for the category template.
  code String
  
  /// Human-readable name for the template (e.g., 'Electronics Default',
  /// 'Fashion Segments').
  name String
  
  /// Serialized configuration data for the category tree structure (e.g., JSON
  /// blob).
  template_data String
  
  /// True if this template is the default offering for new category setups.
  is_default Boolean
  
  /// Operational workflow or approval status of the template.
  business_status String
  
  /// Timestamp of template creation.
  created_at DateTime
  
  /// Last updated timestamp for this template.
  updated_at DateTime
  
  /// Soft delete for logical removal; null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([code])
}

/// Template entities allowing business administrators to author, version,
/// and deploy business rules or logic (e.g., eligibility, promotional,
/// compliance rules). Templates may be attached to channels, sections, or
/// categories, providing modular, versioned logic for core flows. Records
/// always have temporal fields and are versioned for audit.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_business_rule_templates {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Business rule template code (unique).
  code String
  
  /// Display name of the template.
  name String
  
  /// Semantic version number for rule template iteration.
  version Int
  
  /// Serialized rules in config format (JSON/YAML/business rule DSL).
  template_data String
  
  /// Status (active, retired, pending approval, etc.) for business workflow.
  business_status String
  
  /// Timestamp for when this rule template was first authored.
  created_at DateTime
  
  /// Timestamp for most recent template update.
  updated_at DateTime
  
  /// Soft delete timestamp for logical removal; null if template is active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([code, version])
}

/// Centralized system-level audit trail, recording all critical
/// configuration events, administrative actions, rule/template updates, and
/// access logs at the core configuration (systematic) layer. Each log entry
/// includes actor identification, event type, data snapshot, and timestamp
/// for legal and forensic evidence.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_audit_logs_system {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Type of event or action (e.g., 'CREATE_CHANNEL', 'EDIT_CATEGORY',
  /// 'DELETE_TEMPLATE').
  event_type String
  
  /// Reference to the user/admin/automation that performed the action.
  actor_id String
  
  /// Table in which the audit event occurred.
  target_table String
  
  /// ID of the affected record in the target table.
  target_id String
  
  /// JSON snapshot of the entity's state before the change/event; may be empty
  /// for CREATE events.
  before String?
  
  /// JSON snapshot of the entity's state after the change/event; may be empty
  /// for DELETE events.
  after String?
  
  /// Timestamp for the audit event (creation of the log entry).
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  @@index([event_type])
  @@index([actor_id])
  @@index([target_table, target_id])
}

/// Aggregated analytics/statistics for each channel, supporting performance
/// dashboards, management reporting, and business intelligence use cases.
/// May include denormalized, materialized fields for rapid analytics.
/// Populated and refreshed via batch or streaming ETL.
///
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_analytics_channels {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// FK to {@link ai_commerce_channels.id}. Indicates channel with which these
  /// analytics are associated.
  ai_commerce_channel_id String
  
  /// Date/time partition for aggregated statistics.
  stat_date DateTime
  
  /// Total number of orders placed on the channel in the reporting window.
  total_orders Int
  
  /// Total sales amount (monetary) for the channel/stat day.
  total_sales Float
  
  /// Unique buyers in the reporting window.
  total_buyers Int
  
  /// When the analytics aggregation record was created.
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  channel ai_commerce_channels @relation(fields: [ai_commerce_channel_id], references: [id], onDelete: Cascade)
  
  @@unique([ai_commerce_channel_id])
  
  @@index([stat_date])
}