/// Defines logical shopping mall channels (distinct sales
/// domains/applications/brands) serving as the top-level context for all
/// subsequent entities. Channel is the anchor for section, category,
/// catalog, order, and configuration scoping. Each channel may represent a
/// separate storefront, brand, or localized instance.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_channels {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique business code for the channel (e.g., 'main', 'korea', 'brandX').
  /// Used for API routing and business rule scoping.
  code String
  
  /// Human-readable name of the channel. Used in admin UI and business
  /// communication.
  name String
  
  /// General description and business context of the channel.
  description String?
  
  /// Channel creation time.
  created_at DateTime
  
  /// Last update time of the channel info.
  updated_at DateTime
  
  /// Channel deletion time (soft delete).
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  shopping_mall_sections shopping_mall_sections[]
  shopping_mall_channel_categories shopping_mall_channel_categories[]
  shopping_mall_configurations shopping_mall_configurations[]
  shopping_mall_customers shopping_mall_customers[]
  shopping_mall_products shopping_mall_products[]
  shopping_mall_carts shopping_mall_carts[]
  shopping_mall_orders shopping_mall_orders[]
  shopping_mall_coupon_targets shopping_mall_coupon_targets[]
  shopping_mall_boards shopping_mall_boards[]
  
  @@unique([code])
  @@index([created_at])
}

/// Logical groupings within a channel (e.g. 'Best Deal', 'International',
/// 'Seasonal'), referencing the owning channel. Used for merchandising,
/// curation, and business rules. Hierarchically below channels, but may span
/// multiple business domains.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_sections {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Belonged channel's {@link shopping_mall_channels.id}.
  shopping_mall_channel_id String
  
  /// Unique section code, scoped to channel, for business identification
  /// (e.g., 'home', 'event', 'bestseller').
  code String
  
  /// Section display name as seen in business UI or user application.
  name String
  
  /// Short description of the section's purpose.
  description String?
  
  /// Integer order for listing sections within a channel.
  display_order Int
  
  /// Section creation time.
  created_at DateTime
  
  /// Section update time.
  updated_at DateTime
  
  /// Section deletion time (soft delete); remains for audit/tracking.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel shopping_mall_channels @relation(fields: [shopping_mall_channel_id], references: [id], onDelete: Cascade)
  
  shopping_mall_sellers shopping_mall_sellers[]
  shopping_mall_products shopping_mall_products[]
  shopping_mall_carts shopping_mall_carts[]
  shopping_mall_orders shopping_mall_orders[]
  shopping_mall_coupon_targets shopping_mall_coupon_targets[]
  shopping_mall_boards shopping_mall_boards[]
  
  @@unique([shopping_mall_channel_id, code])
  @@index([shopping_mall_channel_id, display_order], map: "shopping_mall_sections_shopping_mall_channel_id_displa_d6778c49")
}

/// Hierarchical categories defining product or section classification within
/// a given channel. Supports parent-child nesting for multi-level trees.
/// Used for search, browse, campaign targeting, and rule scoping. Each
/// belongs to a channel and can reference a parent category (self-relation).
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_channel_categories {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Channel to which the category belongs. {@link shopping_mall_channels.id}.
  shopping_mall_channel_id String
  
  /// Optional reference to parent category for child/descendant relationships.
  /// {@link shopping_mall_channel_categories.id}.
  parent_id String?
  
  /// Unique category code scoped to channel (and maybe parent). Used in
  /// routing and business logic.
  code String
  
  /// Human-readable name of the category.
  name String
  
  /// Description of the category purpose, contents, or intended merchandise.
  description String?
  
  /// Sort order for UI rendering or admin lists within a parent or channel.
  display_order Int
  
  /// Category creation time.
  created_at DateTime
  
  /// Last update to the category information.
  updated_at DateTime
  
  /// Category deletion time (soft delete).
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel shopping_mall_channels @relation(fields: [shopping_mall_channel_id], references: [id], onDelete: Cascade)
  parent shopping_mall_channel_categories? @relation("recursive", fields: [parent_id], references: [id], onDelete: Cascade)
  
  recursive shopping_mall_channel_categories[] @relation("recursive")
  shopping_mall_products shopping_mall_products[]
  shopping_mall_coupon_targets shopping_mall_coupon_targets[]
  
  @@unique([shopping_mall_channel_id, code], map: "shopping_mall_channel_categories_shopping_mall_channel_da57ae32")
  @@index([parent_id])
  @@index([display_order])
}

/// Stores configuration blob(s) for channels or global use (e.g. feature
/// flags, legal text, social links, settings). Each config row may be
/// targeted at a channel, be global, or serve different configuration
/// classes. Version-managed by snapshots for audit and recovery.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_configurations {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Optional FK channel scope for this configuration. If null, applies
  /// globally or to all channels.
  shopping_mall_channel_id String?
  
  /// Business-level code or category for this configuration (e.g.,
  /// 'feature_flag_shipping', 'legal_policy_en').
  key String
  
  /// The configuration blob; may be JSON, text, or rendered markdown/HTML,
  /// etc. Format varies by key.
  value String
  
  /// Revision number for the configuration. Incremented with each new
  /// snapshot/version.
  revision Int
  
  /// Description of the setting's business meaning.
  description String?
  
  /// Configuration row creation time.
  created_at DateTime
  
  /// Last update time of this configuration value.
  updated_at DateTime
  
  /// Soft deletion time for the configuration row.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  channel shopping_mall_channels? @relation(fields: [shopping_mall_channel_id], references: [id], onDelete: Cascade)
  
  shopping_mall_channel_configuration_snapshots shopping_mall_channel_configuration_snapshots[]
  
  @@unique([shopping_mall_channel_id, key])
  @@index([key])
}

/// Append-only historical preservation of all configuration changes for
/// channel/global configuration records. Used to audit, rollback, or prove
/// compliance for configuration events. Each snapshot references the
/// configuration, storing its previous state, revision, and change timing.
/// Immutable after insert.
///
/// @namespace Systematic
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_channel_configuration_snapshots {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Target configuration whose state was snapshotted. {@link
  /// shopping_mall_configurations.id}.
  shopping_mall_configuration_id String
  
  /// The revision number when this snapshot was taken (immutable for
  /// historical record).
  revision Int
  
  /// Business configuration key being snapshotted, redundant for full history
  /// traceability.
  key String
  
  /// Configuration value (blob/text/JSON) at the time of this snapshot.
  value String
  
  /// Snapshot creation time (point of version preservation).
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  configuration shopping_mall_configurations @relation(fields: [shopping_mall_configuration_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_configuration_id, revision], map: "shopping_mall_channel_configuration_snapshots_shopping_9a1a9a92")
  @@index([created_at])
}