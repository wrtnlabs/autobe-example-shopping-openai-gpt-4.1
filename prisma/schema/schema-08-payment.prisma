/// Records each distinct buyer payment event for orders, including method,
/// status, value, gateway, transaction, and audit fields. Used for payment
/// lifecycle tracking and compliance. Linked to transactions, analytics, and
/// fraud events.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payments {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Business or gateway-assigned payment reference, unique per payment flow.
  payment_reference String
  
  /// Current payment status (e.g., pending, paid, failed, refunded).
  status String
  
  /// Total amount paid by buyer (in platform currency).
  amount Float
  
  /// Currency code (ISO 4217, e.g., USD, KRW).
  currency_code String
  
  /// Payment issue/initiation time.
  issued_at DateTime
  
  /// Confirmation (settlement) timestamp, if applicable.
  confirmed_at DateTime?
  
  /// Reason for payment failure if applicable (error code or description).
  failure_reason String?
  
  /// Creation timestamp.
  created_at DateTime
  
  /// Last update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, if payment log is recoverably removed.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  ai_commerce_order_payments ai_commerce_order_payments[]
  
  @@unique([payment_reference])
  @@index([status])
  @@index([created_at])
}

/// Catalog of all supported payment methods (card, mobile, deposit, coupon,
/// mileage, etc.), including code, provider, business logic, and status.
/// Methods are referenced by payments and accounts.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payment_methods {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique business code for the payment method (e.g., 'CREDIT_CARD',
  /// 'VIRTUAL_ACCOUNT').
  method_code String
  
  /// Human-readable name for the payment method.
  display_name String
  
  /// Whether payment method is available for use.
  is_active Boolean
  
  /// JSON or URI of externalized config, if present; for advanced integrations.
  configuration String?
  
  /// Created timestamp.
  created_at DateTime
  
  /// Last updated timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, if method deactivated but not removed for audit
  /// reasons.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([method_code])
  @@index([is_active])
}

/// Specifies each configured payment gateway (PG provider, e.g., Inicis,
/// PayPal, KCP), their settings, endpoint URIs, regional support, and active
/// status. Used to route payments to gateway-specific processes.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payment_gateways {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique code for the gateway (e.g., 'INICIS', 'KCP', 'PAYPAL').
  gateway_code String
  
  /// Display name for the payment gateway.
  display_name String
  
  /// Configured endpoint or base URI for gateway connectivity.
  api_endpoint String
  
  /// Whether the gateway is enabled for transactions.
  is_active Boolean
  
  /// Comma-separated list of supported currency codes.
  supported_currencies String?
  
  /// Created timestamp.
  created_at DateTime
  
  /// Last updated timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, if gateway config is archived.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([gateway_code])
  @@index([is_active])
}

/// Represents each record of an actual payment transfer or API transaction
/// event, linked to a payment. Includes raw gateway response, status, and
/// audit fields. Supports compliance telemetry and evidence.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payment_transactions {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Gateway or business-assigned transaction reference code, unique per
  /// transaction flow.
  transaction_reference String
  
  /// Associated payment entity {@link ai_commerce_payments.id}.
  payment_id String
  
  /// Associated payment method (FK, not null) {@link
  /// ai_commerce_payment_methods.id}.
  method_id String
  
  /// Payment gateway used for transaction {@link
  /// ai_commerce_payment_gateways.id}.
  gateway_id String
  
  /// Raw gateway or business transaction status (e.g., 'OK', 'FAIL',
  /// 'PENDING').
  status String
  
  /// Transaction amount (should match payment).
  amount Float
  
  /// Currency code used for this transaction.
  currency_code String
  
  /// Transaction request timestamp.
  requested_at DateTime
  
  /// Transaction result timestamp, if available.
  completed_at DateTime?
  
  /// Raw JSON/XML gateway response or payload snapshot.
  gateway_payload String?
  
  /// Created timestamp.
  created_at DateTime
  
  /// Last updated timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([transaction_reference])
  @@index([status])
  @@index([requested_at])
}

/// Ledger for user deposit balances (platform e-wallets). Each record is the
/// account for a given user, supporting deposits (recharge), withdrawals,
/// and balance. Used for payments and refunds.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_deposit_accounts {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique account code/number/token for identification.
  account_code String
  
  /// Belonged user {@link ai_commerce_buyer.id} or seller for their platform
  /// deposit account (FK to user table).
  user_id String
  
  /// Current deposit balance.
  balance Float
  
  /// Currency for deposit balance.
  currency_code String
  
  /// Status of the deposit account ('active', 'suspended').
  status String
  
  /// Created timestamp.
  created_at DateTime
  
  /// Last updated timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([account_code])
  @@index([user_id])
}

/// Ledger of all deposit account actions (recharge, withdraw, payment,
/// refund), with immutable audit trail. Used for compliance, rollback, and
/// analytics.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_deposit_transactions {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Reference to deposit account {@link ai_commerce_deposit_accounts.id}.
  deposit_account_id String
  
  /// Transaction type ('recharge', 'withdraw', 'payment', 'refund').
  type String
  
  /// Amount added or subtracted (positive for credit, negative for debit).
  amount Float
  
  /// Transaction status (pending/confirmed/failed).
  status String
  
  /// External or internal reference ID (e.g., payment, refund, etc).
  counterparty_reference String?
  
  /// When the transaction occurred.
  performed_at DateTime
  
  /// Ledger entry created time.
  created_at DateTime
  
  /// Last updated.
  updated_at DateTime
  
  /// Soft delete timestamp (null for active).
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@index([deposit_account_id])
  @@index([performed_at])
}

/// Record containing platform mileage/point balances per user (for loyalty,
/// incentives). Supports accrual, spend, expiry, and audit trail linkage to
/// user entity.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_mileage_accounts {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Mileage account code assigned to user for unique tracking/audit.
  account_code String
  
  /// User FK reference (buyer or seller) {@link ai_commerce_buyer.id}.
  user_id String
  
  /// Current point balance (can never be negative).
  balance Float
  
  /// Current state of this mileage account (active, suspended, closed).
  status String
  
  /// Account creation time.
  created_at DateTime
  
  /// Account last update time.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([account_code])
  @@index([user_id])
}

/// Ledger of all mileage/point earning and redemption events (reasons:
/// purchase, campaign, refund, admin adjustment). Used for compliance and
/// rewards analytics.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_mileage_transactions {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// FK reference to mileage account {@link ai_commerce_mileage_accounts.id}.
  mileage_account_id String
  
  /// Transaction type (accrual, redemption, adjustment, expiration).
  type String
  
  /// Point amount (positive for accrual, negative for spend/expire).
  amount Float
  
  /// Transaction status (confirmed, pending, failed, expired).
  status String
  
  /// Reference to related entity (order, campaign, refund, etc).
  reference_entity String?
  
  /// When points were transacted.
  transacted_at DateTime
  
  /// Entry created time.
  created_at DateTime
  
  /// Last updated time.
  updated_at DateTime
  
  /// Soft delete timestamp when retired.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@index([mileage_account_id])
  @@index([transacted_at])
}

/// Definition and rules for all coupons issued by the platform or sellers.
/// Includes type, max usage, period, applicable users/products, business
/// validation, and compliance fields. Used as parent to issues/uses/audits.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_coupons {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Globally unique code or token for coupon.
  coupon_code String
  
  /// Type of coupon (amount, percent, shipping, etc).
  type String
  
  /// Coupon validity start date/time.
  valid_from DateTime
  
  /// Coupon expiry date/time.
  valid_until DateTime
  
  /// Issuer (admin or seller) {@link ai_commerce_admin.id} or {@link
  /// ai_commerce_seller.id}.
  issued_by String?
  
  /// Total number of times this coupon can be used on the platform (global
  /// limit).
  max_uses Int?
  
  /// JSON/YAML/Rule describing applicable entities or rules for this coupon.
  conditions String?
  
  /// Current status (active, expired, revoked).
  status String
  
  /// Created.
  created_at DateTime
  
  /// Updated.
  updated_at DateTime
  
  /// Soft delete (retirement) if staged out of circulation.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([coupon_code])
  @@index([valid_from, valid_until])
}

/// Record of each issued coupon (to user/account), unique by coupon/session.
/// Includes usage state, issued to, expiration, and batch campaign
/// reference. Managed as subsidiary entity to coupons.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_coupon_issues {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Reference to coupon master {@link ai_commerce_coupons.id}.
  coupon_id String
  
  /// FK reference to issued user account (buyer or seller, or member,
  /// depending on campaign) {@link ai_commerce_buyer.id}.
  issued_to String
  
  /// Issued coupon status (issued, redeemed, expired, revoked).
  status String
  
  /// Timestamp of coupon issue.
  issued_at DateTime
  
  /// Issue-specific expiration (can override master coupon window).
  expires_at DateTime
  
  /// When this issued coupon was redeemed (if used).
  redeemed_at DateTime?
  
  /// Batch/campaign or unique series identifier if issued as part of a
  /// campaign.
  batch_reference String?
  
  /// Record creation time.
  created_at DateTime
  
  /// Record update time.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@index([coupon_id])
  @@index([issued_to])
  @@index([status])
}

/// Record of coupon redemption (each use event matching order/payment, user,
/// and coupon issue). Tracks who/when/where for audit, evidence, and fraud
/// detection. Not independently managed.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_coupon_uses {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Reference to coupon issuance event {@link ai_commerce_coupon_issues.id}.
  coupon_issue_id String
  
  /// User or entity that redeemed the coupon {@link ai_commerce_buyer.id}.
  redeemed_by String
  
  /// Order where coupon was used (for audit) {@link ai_commerce_orders.id}.
  order_id String?
  
  /// Timestamp of coupon redemption.
  redeemed_at DateTime
  
  /// Redemption status (success, rejected, failed, revoked).
  status String
  
  /// Created at.
  created_at DateTime
  
  /// Last update.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@index([redeemed_by])
  @@index([status])
}

/// Immutable, append-only snapshot record of any coupon lifecycle, usage, or
/// policy actions (issue, use, redemption, revocation, etc.) for compliance
/// and evidence review.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_coupon_audits {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Coupon being audited {@link ai_commerce_coupons.id}.
  coupon_id String
  
  /// Business event: issue, use, validate, expire, revoke, adjust, etc.
  event_type String
  
  /// Any reference entity (order, payment, campaign, etc) relevant to the
  /// event.
  event_reference String?
  
  /// Free-format reason or audit log memo.
  note String?
  
  /// Timestamp when audit event was created.
  event_timestamp DateTime
  
  //----
  // RELATIONS
  //----
  @@index([coupon_id])
  @@index([event_type])
}

/// System-detected or manually logged fraud/suspicious activity records for
/// payments, coupons, deposits, or mileage. Supports forensic audit,
/// compliance, and evidence investigation.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payment_fraud_events {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique or patterned code for this fraud event (e.g., 'MULTI_REDEMPTION',
  /// 'ABUSE', 'EXTERNAL_INCIDENT').
  event_code String
  
  /// Entity affected (payment, coupon, deposit, mileage, transaction).
  entity_type String
  
  /// ID of the affected entity (refer to the model by type).
  entity_id String
  
  /// Fraud event investigation status (detected, under_review, confirmed,
  /// dismissed).
  status String
  
  /// Description or reason for the event.
  description String?
  
  /// When this event was detected by system/user.
  detected_at DateTime
  
  /// Timestamp of last review/update on status, if available.
  reviewed_at DateTime?
  
  /// Created.
  created_at DateTime
  
  /// Updated.
  updated_at DateTime
  
  /// Soft delete timestamp.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@index([entity_type])
  @@index([status])
}

/// Aggregated or denormalized table for payment/coupon summary analytics (by
/// period, channel, method, gateway). Designed for performance queries, BI,
/// and reporting; no direct business mutations.
///
/// @namespace Payment
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_payment_analytics {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Analytics time period start.
  period_start DateTime
  
  /// Analytics time period end.
  period_end DateTime
  
  /// Channel for which analytics is aggregated {@link ai_commerce_channels.id}.
  channel_id String
  
  /// Payment method for this analytic window {@link
  /// ai_commerce_payment_methods.id}.
  method_id String
  
  /// Gateway involved in analytics window {@link
  /// ai_commerce_payment_gateways.id}.
  gateway_id String
  
  /// Total payment count.
  total_payments Int
  
  /// Total payment amount (sum).
  total_amount Float
  
  /// Count of refunds in period.
  total_refunds Int
  
  /// Coupon usage count for period.
  coupon_uses Int
  
  /// Mileage redemption count in period.
  mileage_redemptions Int
  
  /// Deposit used in payment count in period.
  deposit_usages Int
  
  /// Aggregation record created.
  created_at DateTime
  
  /// Updated.
  updated_at DateTime
  
  //----
  // RELATIONS
  //----
  @@index([period_start, period_end])
  @@index([channel_id])
  @@index([method_id])
  @@index([gateway_id])
}