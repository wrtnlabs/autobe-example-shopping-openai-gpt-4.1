/// Registered buyer account for the aiCommerce platform. Scopes purchasing,
/// profile, and favorites. Links to auth, addresses, and profile. Subject to
/// privacy compliance and audit. Role elevation to seller supported via
/// status field. Soft delete for recovery and right-to-be-forgotten
/// compliance.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_buyer {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique email address. Required for authentication and notifications.
  email String
  
  /// Hashed password for login.
  password_hash String
  
  /// Buyer account status: active, suspended, deleted, etc.
  status String
  
  /// Account creation timestamp.
  created_at DateTime
  
  /// Timestamp of last profile or status update.
  updated_at DateTime
  
  /// Soft delete timestamp for retention and privacy compliance.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  ai_commerce_seller ai_commerce_seller?
  ai_commerce_user_authentications ai_commerce_user_authentications[]
  ai_commerce_user_addresses ai_commerce_user_addresses[]
  ai_commerce_user_external_accounts ai_commerce_user_external_accounts[]
  ai_commerce_user_profiles ai_commerce_user_profiles?
  ai_commerce_audit_logs_user ai_commerce_audit_logs_user[]
  ai_commerce_search_histories ai_commerce_search_histories[]
  ai_commerce_recommendation_snapshots ai_commerce_recommendation_snapshots[]
  ai_commerce_carts ai_commerce_carts[]
  ai_commerce_cart_sessions ai_commerce_cart_sessions[]
  ai_commerce_cart_merges ai_commerce_cart_merges[]
  ai_commerce_orders ai_commerce_orders[]
  ai_commerce_order_status_history ai_commerce_order_status_history[]
  ai_commerce_order_after_sales ai_commerce_order_after_sales[]
  ai_commerce_order_cancellations ai_commerce_order_cancellations[]
  ai_commerce_order_refunds ai_commerce_order_refunds[]
  ai_commerce_bulletins ai_commerce_bulletins[]
  ai_commerce_inquiries ai_commerce_inquiries[]
  ai_commerce_reviews ai_commerce_reviews[]
  ai_commerce_comments ai_commerce_comments[]
  ai_commerce_ugc_notifications ai_commerce_ugc_notifications[]
  ai_commerce_favorites_products ai_commerce_favorites_products[]
  ai_commerce_favorites_inquiries ai_commerce_favorites_inquiries[]
  ai_commerce_favorites_addresses ai_commerce_favorites_addresses[]
  ai_commerce_favorites_folders ai_commerce_favorites_folders[]
  ai_commerce_favorites_notifications ai_commerce_favorites_notifications[]
  ai_commerce_favorites_audit_logs ai_commerce_favorites_audit_logs[]
  ai_commerce_attachments ai_commerce_attachments[]
  ai_commerce_attachment_access_audit ai_commerce_attachment_access_audit[]
  
  @@unique([email])
  @@index([created_at])
}

/// Seller account structure. Linked to buyer account for role elevation.
/// Handles onboarding, KYC, store management references, and legal
/// compliance snapshots. Status supports escalation, penalties, or
/// downgrades. Soft delete for privacy compliance.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_seller {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Linked {@link ai_commerce_buyer.id} for seller-member relationship.
  buyer_id String
  
  /// Seller status: active, under_review, suspended, terminated, etc.
  status String
  
  /// Timestamp for completion of onboarding/approval process.
  onboarded_at DateTime?
  
  /// Account creation timestamp.
  created_at DateTime
  
  /// Last updated timestamp for profile or status.
  updated_at DateTime
  
  /// Soft delete timestamp for legal retention/audit.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  
  ai_commerce_products ai_commerce_products[]
  ai_commerce_highlighted_products ai_commerce_highlighted_products[]
  ai_commerce_order_items ai_commerce_order_items[]
  ai_commerce_sub_orders ai_commerce_sub_orders[]
  
  @@unique([buyer_id])
  @@index([created_at])
}

/// Admin-level user for platform and compliance management. Controls global
/// settings, user/seller moderation, and escalation points. Separate from
/// regular buyers/sellers for audit and global access restriction. All admin
/// actions are strictly audited.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_admin {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Unique email address for admin login/audit.
  email String
  
  /// Hashed password for admin authentication (privileged access).
  password_hash String
  
  /// Status of admin account: active, suspended, etc.
  status String
  
  /// Admin account creation timestamp.
  created_at DateTime
  
  /// Timestamp of last update to admin profile/status.
  updated_at DateTime
  
  /// Soft delete field for compliance; not physical delete.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  ai_commerce_user_authentications ai_commerce_user_authentications[]
  ai_commerce_audit_logs_user ai_commerce_audit_logs_user[]
  ai_commerce_audit_logs_discovery ai_commerce_audit_logs_discovery[]
  ai_commerce_cart_templates ai_commerce_cart_templates[]
  ai_commerce_cart_expirations ai_commerce_cart_expirations[]
  ai_commerce_cart_audit_logs ai_commerce_cart_audit_logs[]
  ai_commerce_ugc_moderation ai_commerce_ugc_moderation[]
  ai_commerce_ugc_snapshots ai_commerce_ugc_snapshots[]
  ai_commerce_ugc_edit_history ai_commerce_ugc_edit_history[]
  ai_commerce_ugc_audit_logs ai_commerce_ugc_audit_logs[]
  
  @@unique([email])
  @@index([created_at])
}

/// Anonymous or temporary user entity for non-registered browsing sessions.
/// Used to track marketing acquisition, incomplete onboarding, or guest
/// cart/favorites bridging before registration.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_visitor {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Tracking identifier assigned to the visitor (cookie/session/device
  /// fingerprint).
  tracking_id String
  
  /// Visitor record creation timestamp.
  created_at DateTime
  
  /// Timestamp of last update (e.g., session activity, attribution change).
  updated_at DateTime
  
  /// Soft delete of visitor data for privacy auditing.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  @@unique([tracking_id])
  @@index([created_at])
}

/// Core authentication and session tracking for buyers, sellers, and admins.
/// Supports multi-device, MFA, and OAuth federation. Logs device, IP,
/// method, and session expiry for secure audit.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_authentications {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Buyer account {@link ai_commerce_buyer.id} for this authentication
  /// session (nullable if admin).
  buyer_id String?
  
  /// Admin account {@link ai_commerce_admin.id} for this authentication
  /// session (nullable if buyer).
  admin_id String?
  
  /// Authentication type: password, external, magic link, MFA, etc.
  method String
  
  /// Device metadata (browser, OS, device fingerprint).
  device_info String?
  
  /// User login IP address for audit trail and geo-compliance.
  ip_address String?
  
  /// Session expiration timestamp (JWT, refresh, etc.).
  session_expires_at DateTime
  
  /// Session record creation time.
  created_at DateTime
  
  /// Session last activity update.
  updated_at DateTime
  
  /// Soft deleted session record.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer? @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  admin ai_commerce_admin? @relation(fields: [admin_id], references: [id], onDelete: Cascade)
  
  ai_commerce_seller_onboarding ai_commerce_seller_onboarding[]
  ai_commerce_seller_kyc ai_commerce_seller_kyc[]
  ai_commerce_seller_profiles ai_commerce_seller_profiles?
  ai_commerce_stores ai_commerce_stores[]
  ai_commerce_seller_status_history ai_commerce_seller_status_history[]
  
  @@unique([buyer_id, method, created_at])
  @@index([admin_id, created_at])
}

/// User address records for shipping, billing, and KYC. Linked to
/// profile/account; supports historical preservation via snapshots. Stores
/// all legal info needed for shipping, verification, and analytics. Enforces
/// country/validation rules.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_addresses {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Belonged user's {@link ai_commerce_buyer.id} (for standard buyers).
  buyer_id String
  
  /// Friendly label: 'Home', 'Office', etc.
  label String?
  
  /// ISO 3166-1 alpha-2 country code.
  country_code String
  
  /// State/province/region (per-country format).
  region String?
  
  /// City or locality.
  city String
  
  /// Postal or ZIP code for address.
  postal_code String
  
  /// Primary address line (street, building, details).
  address_line_1 String
  
  /// Secondary line (apartment, suite, etc.).
  address_line_2 String?
  
  /// Flag for primary/default address selection.
  is_default Boolean
  
  /// Address record creation timestamp.
  created_at DateTime
  
  /// Last updated timestamp (for address edits or label change).
  updated_at DateTime
  
  /// Soft delete timestamp for privacy, not physical removal.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  
  ai_commerce_user_address_snapshots ai_commerce_user_address_snapshots[]
  ai_commerce_favorites_addresses ai_commerce_favorites_addresses[]
  ai_commerce_favorites_address_snapshots ai_commerce_favorites_address_snapshots[]
  
  @@unique([buyer_id, label])
  @@index([country_code, city])
}

/// Historical, immutable snapshot of each address state (for
/// audit/evidence). Linked to user address. Used for legal, compliance, or
/// forensic scenarios (disputes, delivery deviations, etc.). Append-only;
/// cannot be modified or deleted.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_address_snapshots {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// User address reference {@link ai_commerce_user_addresses.id}.
  user_address_id String
  
  /// JSON-encoded snapshot of address data at time of event.
  snapshot_json String
  
  /// Snapshot event type: create, update, delete, dispute.
  event_type String
  
  /// Snapshot creation timestamp.
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  userAddress ai_commerce_user_addresses @relation(fields: [user_address_id], references: [id], onDelete: Cascade)
  
  @@index([user_address_id, created_at], map: "ai_commerce_user_address_snapshots_user_address_id_cre_75c4697b")
}

/// External SSO/federated account links (Google, Apple, Kakao, etc.) to
/// enable multi-provider authentication for buyers/admins. Retains provider,
/// unique ID, mapping timestamps, and compliance tracking.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_external_accounts {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Linked buyer account for SSO mapping {@link ai_commerce_buyer.id}.
  buyer_id String
  
  /// SSO provider name (google, apple, kakao, etc.).
  provider String
  
  /// Provider-issued principal/user id for identity mapping.
  provider_user_id String
  
  /// When this linkage was registered or last verified.
  linked_at DateTime
  
  /// SSO record creation timestamp.
  created_at DateTime
  
  /// Soft delete for privacy right-to-be-forgotten.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  
  @@unique([provider, provider_user_id], map: "ai_commerce_user_external_accounts_provider_provider_u_9460ef06")
  @@index([buyer_id])
}

/// Main profile data for user accounts (buyer/seller role). Stores names,
/// nickname, avatar, locale, contact, and consent/marketing preferences.
/// Enables cross-channel profile sharing and personalization with privacy
/// compliance.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_profiles {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// User this profile belongs to {@link ai_commerce_buyer.id}.
  buyer_id String
  
  /// Display nickname or preferred handle for personalization.
  nickname String
  
  /// URI to profile image/avatar.
  avatar_url String?
  
  /// Contact phone (main notification).
  phone_number String?
  
  /// Primary language preference (ISO 639-1).
  language String?
  
  /// User's agreement to receive marketing information.
  marketing_opt_in Boolean
  
  /// Profile record created.
  created_at DateTime
  
  /// Profile last updated.
  updated_at DateTime
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  
  ai_commerce_user_profile_agreements ai_commerce_user_profile_agreements[]
  ai_commerce_user_profile_snapshots ai_commerce_user_profile_snapshots[]
  
  @@unique([buyer_id])
  @@index([nickname])
}

/// User profile platform agreements for compliance: privacy policy
/// acceptance, marketing consent, terms of service, etc. Historicized for
/// audit and re-verification events with version/date.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_profile_agreements {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Associated user profile {@link ai_commerce_user_profiles.id}.
  profile_id String
  
  /// Type: privacy_policy, terms_of_service, marketing, etc.
  agreement_type String
  
  /// Agreement version (semver or yy-mm-dd)
  version String
  
  /// Timestamp of user agreement action.
  agreed_at DateTime
  
  /// Agreement withdrawn timestamp (if revoked).
  withdrawn_at DateTime?
  
  //----
  // RELATIONS
  //----
  profile ai_commerce_user_profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade)
  
  @@unique([profile_id, agreement_type, version], map: "ai_commerce_user_profile_agreements_profile_id_agreeme_83d8f6a7")
}

/// Read-only historical versioning of user profile states. Immutable
/// audit/evidence preservation for profile change events (rename, phone,
/// marketing, etc.). Used for compliance and dispute handling. Can never be
/// modified or erased for legal conformance.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_user_profile_snapshots {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Profile version relates to {@link ai_commerce_user_profiles.id}.
  profile_id String
  
  /// JSON-encoded full profile data at change event or history point.
  snapshot_json String
  
  /// Event (profile_created, profile_updated, phone_changed, etc.).
  event_type String
  
  /// Snapshot recording time.
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  profile ai_commerce_user_profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade)
  
  @@index([profile_id, created_at])
}

/// Audit log for all buyer/admin/seller actions: login, profile change,
/// authentication event, privilege escalation, or privacy data access.
/// Forensically valuable, provides IP/device chronology. Strictly
/// append-only and never deletable by user.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model ai_commerce_audit_logs_user {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Action performed by or on behalf of this buyer {@link
  /// ai_commerce_buyer.id}.
  buyer_id String?
  
  /// Action performed by admin {@link ai_commerce_admin.id}.
  admin_id String?
  
  /// Action/event code: login, logout, profile_edit, escalation, suspension,
  /// etc.
  action_type String
  
  /// Entity type: buyer, admin, seller, profile, address, etc.
  subject_type String
  
  /// UUID of entity affected (account, profile, address, etc.).
  subject_id String
  
  /// IP address from which action was performed.
  ip_address String?
  
  /// Device/fingerprint used in the action event.
  device_info String?
  
  /// Timestamp when action occurred (audit event time).
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  buyer ai_commerce_buyer? @relation(fields: [buyer_id], references: [id], onDelete: Cascade)
  admin ai_commerce_admin? @relation(fields: [admin_id], references: [id], onDelete: Cascade)
  
  @@index([buyer_id, action_type])
  @@index([admin_id, action_type])
  @@index([created_at])
}