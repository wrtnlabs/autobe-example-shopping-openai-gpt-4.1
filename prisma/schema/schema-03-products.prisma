/// Core product catalog table representing products registered by sellers.
/// Supports linkage to seller, channel, section, and primary category.
/// Carries main identifying attributes, business status, and time meta for
/// full product lifecycle workflows. References subsidiary tables for
/// options, variants, bundles, SEO, content, inventory, and attachments.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_products {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Seller who owns the product. {@link shopping_mall_sellers.id}
  shopping_mall_seller_id String
  
  /// Channel where the product is listed. {@link shopping_mall_channels.id}
  shopping_mall_channel_id String
  
  /// Section where product is grouped (virtual corner, theme, etc). {@link
  /// shopping_mall_sections.id}
  shopping_mall_section_id String
  
  /// Primary category (hierarchical) for filtering & search. {@link
  /// shopping_mall_channel_categories.id}
  shopping_mall_category_id String
  
  /// Business-facing, unique product code per seller/channel. Used for SKU and
  /// product identity.
  code String
  
  /// Product display name for customers and search.
  name String
  
  /// Product status (e.g., Draft, Active, Paused, Discontinued, Deleted).
  /// Controls visibility and business flows.
  status String
  
  /// Business workflow state, e.g., Approval, Pending Activation, Blocked,
  /// Suspended.
  business_status String
  
  /// Product creation timestamp.
  created_at DateTime
  
  /// Last update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, null if not deleted.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  seller shopping_mall_sellers @relation(fields: [shopping_mall_seller_id], references: [id], onDelete: Cascade)
  channel shopping_mall_channels @relation(fields: [shopping_mall_channel_id], references: [id], onDelete: Cascade)
  section shopping_mall_sections @relation(fields: [shopping_mall_section_id], references: [id], onDelete: Cascade)
  category shopping_mall_channel_categories @relation(fields: [shopping_mall_category_id], references: [id], onDelete: Cascade)
  
  shopping_mall_product_options shopping_mall_product_options[]
  shopping_mall_product_variants shopping_mall_product_variants[]
  shopping_mall_product_bundles shopping_mall_product_bundles[]
  shopping_mall_product_bundle_items shopping_mall_product_bundle_items[]
  shopping_mall_product_tags shopping_mall_product_tags[]
  shopping_mall_product_seo_metadata shopping_mall_product_seo_metadata?
  shopping_mall_product_content shopping_mall_product_content?
  shopping_mall_product_snapshots shopping_mall_product_snapshots[]
  shopping_mall_product_attachment_links shopping_mall_product_attachment_links[]
  shopping_mall_cart_items shopping_mall_cart_items[]
  shopping_mall_order_items shopping_mall_order_items[]
  shopping_mall_coupon_targets shopping_mall_coupon_targets[]
  shopping_mall_board_posts shopping_mall_board_posts[]
  shopping_mall_product_inquiries shopping_mall_product_inquiries[]
  shopping_mall_reviews shopping_mall_reviews[]
  shopping_mall_favorite_products shopping_mall_favorite_products[]
  shopping_mall_favorite_snapshots shopping_mall_favorite_snapshots[]
  
  @@index([shopping_mall_section_id])
  @@index([shopping_mall_category_id])
  
  @@unique([shopping_mall_seller_id, code])
  @@index([shopping_mall_channel_id, shopping_mall_section_id, shopping_mall_category_id], map: "shopping_mall_products_shopping_mall_channel_id_shoppi_9beb780d")
  @@index([status])
}

/// Product option definitions (size, color, style, etc.) bound to a parent
/// product. Option attributes enable variant generation. Not independently
/// managed by users, defined as part of product setup.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_options {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent product {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Option name (e.g., Size, Color) shown to customer during selection.
  name String
  
  /// Whether this option must be selected to order product.
  required Boolean
  
  /// Display order/position in UI for option selection.
  position Int
  
  /// Option creation timestamp.
  created_at DateTime
  
  /// Last update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  shopping_mall_product_option_values shopping_mall_product_option_values[]
  
  @@unique([shopping_mall_product_id, name])
  @@index([shopping_mall_product_id])
}

/// Possible values for each product option (e.g., Red, Blue, Large, Small).
/// Referenced by variants. Managed as part of product definition and variant
/// generation, not directly managed by users.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_option_values {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent option {@link shopping_mall_product_options.id}
  shopping_mall_product_option_id String
  
  /// Value label (e.g., Red, L, 42). Displayed for selection and variant
  /// mapping.
  value String
  
  /// Display order/position relative to other values.
  position Int
  
  /// Option value creation timestamp.
  created_at DateTime
  
  /// Last update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  option shopping_mall_product_options @relation(fields: [shopping_mall_product_option_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_product_option_id, value], map: "shopping_mall_product_option_values_shopping_mall_prod_15d9d1cc")
}

/// Each row represents a unique SKU (stock keeping unit) defined by a
/// combination of option values for a product. Critical for inventory and
/// order management but not user-managed directly.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_variants {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent product this variant belongs to. {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Internal SKU code/identifier unique within product.
  sku_code String
  
  /// Bar code or EAN/UPC for the variant (optional).
  bar_code String?
  
  /// Deterministic hash of selected option values for this variant (enables
  /// fast lookup and uniqueness enforcement).
  option_values_hash String
  
  /// Sales price of this variant/SKU.
  price Float
  
  /// Current inventory quantity (redundant with inventory events, but used for
  /// listing performance).
  stock_quantity Int
  
  /// Weight for shipping calculations. Required for delivery use-cases.
  weight Float
  
  /// Variant creation timestamp.
  created_at DateTime
  
  /// Last update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  shopping_mall_product_inventories shopping_mall_product_inventories[]
  shopping_mall_cart_items shopping_mall_cart_items[]
  shopping_mall_order_items shopping_mall_order_items[]
  
  @@unique([shopping_mall_product_id, option_values_hash], map: "shopping_mall_product_variants_shopping_mall_product_i_8673498b")
  @@unique([sku_code])
  @@index([shopping_mall_product_id])
}

/// Represents a product bundle/composite product. Bundles reference type
/// (fixed, optional, etc), pricing logic, and display contents. Not managed
/// directly by users other than during product registration.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_bundles {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Parent product for which this bundle is defined. {@link
  /// shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Bundle display name for customers.
  name String
  
  /// Type of bundle, e.g., 'fixed' or 'optional'.
  bundle_type String
  
  /// Short description of bundle (optional).
  description String?
  
  /// Display order for multiple bundles on one product.
  position Int
  
  /// Bundle creation timestamp.
  created_at DateTime
  
  /// Last bundle update timestamp.
  updated_at DateTime
  
  /// Soft delete timestamp, null if active.
  deleted_at DateTime?
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  shopping_mall_product_bundle_items shopping_mall_product_bundle_items[]
  
  @@unique([shopping_mall_product_id, name])
}

/// Junction table linking products included in a given bundle (composition
/// M:N). Each row is an item in a bundle, referencing both the bundle and
/// the constituent product. Enforces order and uniqueness, supports
/// optional/multiplicative bundles.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_bundle_items {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Bundle this item belongs to. {@link shopping_mall_product_bundles.id}
  shopping_mall_product_bundle_id String
  
  /// Product included in this bundle. {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Quantity of this product in the bundle.
  quantity Int
  
  /// Whether this product must be included in purchase/bundle.
  required Boolean
  
  /// Display order within the bundle.
  position Int
  
  //----
  // RELATIONS
  //----
  bundle shopping_mall_product_bundles @relation(fields: [shopping_mall_product_bundle_id], references: [id], onDelete: Cascade)
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  @@index([shopping_mall_product_id], map: "shopping_mall_product_bundle_items_shopping_mall_produ_6846f0e8")
  
  @@unique([shopping_mall_product_bundle_id, shopping_mall_product_id], map: "shopping_mall_product_bundle_items_shopping_mall_produ_b689ae75")
}

/// Tags associated with products for keyword search and AI-driven
/// recommendation/personalization. Not managed independently, attached
/// during product registration or update.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_tags {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Product referenced by this tag. {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Tag or keyword assigned to the product, used for search and
  /// recommendations.
  tag String
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_product_id, tag])
}

/// Per-product SEO metadata including meta title, meta description, and
/// keywords for search optimization. Only attached via product, not managed
/// independently by users.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_seo_metadata {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Product for which this SEO meta is attached. {@link
  /// shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// SEO meta title for the product.
  meta_title String
  
  /// SEO meta description for the product.
  meta_description String
  
  /// SEO meta keywords, comma-separated.
  meta_keywords String
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_product_id])
  @@index([meta_title])
}

/// Rich content fields for product descriptions, policies, and multilingual
/// data. Includes display content in Markdown/HTML, return/warranty policy,
/// and structured data for suggestions/recommendations. Attached per
/// product.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_content {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Product for which this content is provided. {@link
  /// shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Formatted product description in Markdown or HTML.
  content_markdown String
  
  /// Return policy text (localized, shown to customers).
  return_policy String
  
  /// Warranty/aftersales policy text (localized, shown to customers).
  warranty_policy String
  
  /// Language and region code for content localization.
  locale String
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_product_id])
  @@index([locale])
}

/// Inventory event table, capturing all inventory-changing events (add,
/// remove, adjust, restock) by variant/SKU as an event log. Enables full
/// audit trail and reconciliation of stock changes for compliance.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_inventories {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Variant SKU affected by this inventory event. {@link
  /// shopping_mall_product_variants.id}
  shopping_mall_product_variant_id String
  
  /// Inventory event type: 'add', 'remove', 'adjust', 'restock', etc.
  event_type String
  
  /// Change in quantity (positive for receive, negative for issue).
  delta_quantity Int
  
  /// Running balance of quantity for this SKU post-event.
  remaining_quantity Int
  
  /// Reference entity/event; could be order, restock or manual entry. Used for
  /// audit linkage.
  reference_id String?
  
  /// Time event is recorded.
  event_timestamp DateTime
  
  /// Optional note for context (e.g., reason for adjustment, batch ID).
  note String?
  
  //----
  // RELATIONS
  //----
  variant shopping_mall_product_variants @relation(fields: [shopping_mall_product_variant_id], references: [id], onDelete: Cascade)
  
  @@index([shopping_mall_product_variant_id, event_timestamp], map: "shopping_mall_product_inventories_shopping_mall_produc_396b1497")
}

/// Snapshot table capturing the entire historical state of a product for
/// each mutation. Enables audit/evidence for compliance and rollback. Stores
/// all business fields and relationships as at the snapshot time.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_snapshots {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Product which this snapshot represents. {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Monotonically increasing snapshot version for this product.
  snapshot_version Int
  
  /// Complete serialized product state at the snapshot moment (JSON blob for
  /// compliance/audit).
  data_json String
  
  /// Snapshot creation timestamp.
  created_at DateTime
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  
  @@unique([shopping_mall_product_id, snapshot_version], map: "shopping_mall_product_snapshots_shopping_mall_product__8c10c02c")
}

/// Links between products (or related entities) and file attachments.
/// Enables multiple attachments per product/content, supporting images,
/// files, and rich media.
///
/// @namespace Products
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model shopping_mall_product_attachment_links {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id
  
  /// Product for which this file is attached. {@link shopping_mall_products.id}
  shopping_mall_product_id String
  
  /// Attachment file reference, linked to shopping_mall_attachments table.
  /// {@link shopping_mall_attachments.id}
  attachment_id String
  
  /// Attachment usage context (e.g., main_image, gallery, spec_sheet).
  purpose String
  
  /// Order for displaying attachments of the same purpose/category.
  position Int
  
  //----
  // RELATIONS
  //----
  product shopping_mall_products @relation(fields: [shopping_mall_product_id], references: [id], onDelete: Cascade)
  attachment shopping_mall_attachments @relation(fields: [attachment_id], references: [id], onDelete: Cascade)
  
  @@index([attachment_id])
  
  @@unique([shopping_mall_product_id, attachment_id, purpose], map: "shopping_mall_product_attachment_links_shopping_mall_p_03f160d3")
}