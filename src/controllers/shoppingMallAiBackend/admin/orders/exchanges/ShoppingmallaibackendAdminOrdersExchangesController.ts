import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { patch__shoppingMallAiBackend_admin_orders_$orderId_exchanges } from "../../../../../providers/patch__shoppingMallAiBackend_admin_orders_$orderId_exchanges";
import { AdminAuth } from "../../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../../decorators/payload/AdminPayload";
import { get__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId } from "../../../../../providers/get__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId";
import { put__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId } from "../../../../../providers/put__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId";
import { delete__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId } from "../../../../../providers/delete__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId";

import { IPageIShoppingMallAiBackendOrderExchange } from "../../../../../api/structures/IPageIShoppingMallAiBackendOrderExchange";
import { IShoppingMallAiBackendOrderExchange } from "../../../../../api/structures/IShoppingMallAiBackendOrderExchange";

@Controller("/shoppingMallAiBackend/admin/orders/:orderId/exchanges")
export class ShoppingmallaibackendAdminOrdersExchangesController {
  /**
   * List all exchanges for a given order with filters and pagination.
   *
   * Retrieve a paginated list of all exchange requests for a specific order.
   * This operation allows admins, after-sales support, and sellers to review,
   * search, and filter all exchanges, which represent requests for item
   * replacement or attribute swap within the order. Filtering by status or
   * rationale is supported; results are paginated for dashboard and operational
   * efficiency.
   *
   * Authorization is required for access; only privileged users (admin, seller,
   * after-sales support) may retrieve full exchange audit history. The response
   * includes exchange metadata, linked order/item/return associations, full
   * status/rationale trail, and compliance timestamps. Used for business
   * analytics, dispute resolution, and regulatory audit. Integrates with
   * customer service and after-sales management workflows.
   *
   * @param connection
   * @param orderId Order ID for which exchange requests are queried.
   * @param body Optional filters and pagination parameters for order exchanges.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("orderId")
    orderId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IShoppingMallAiBackendOrderExchange.IRequest,
  ): Promise<IPageIShoppingMallAiBackendOrderExchange> {
    try {
      return await patch__shoppingMallAiBackend_admin_orders_$orderId_exchanges(
        {
          admin,
          orderId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Get a specific order item exchange record by order and exchange ID.
   *
   * This operation fetches a single after-sales exchange record associated with
   * a specific order and order item. It provides detailed information necessary
   * for a customer or admin to understand the current state or resolution
   * history of the exchange, including status transitions, request and
   * completion times, reason, and evidence. Security considerations ensure only
   * the owner (customer) or authorized admin can access the record, as
   * sensitive customer service details are returned. The operation references
   * both the Orders and OrderExchanges tables with all relevant exchange fields
   * and their business context.
   *
   * @param connection
   * @param orderId Unique identifier for the target order (UUID).
   * @param exchangeId Unique identifier for the target exchange (UUID).
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":exchangeId")
  public async at(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("orderId")
    orderId: string & tags.Format<"uuid">,
    @TypedParam("exchangeId")
    exchangeId: string & tags.Format<"uuid">,
  ): Promise<IShoppingMallAiBackendOrderExchange> {
    try {
      return await get__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId(
        {
          admin,
          orderId,
          exchangeId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an order item exchange, such as status, reasons, or admin decision.
   *
   * Enables updating the details or status of an exchange request for an order
   * item. Permits actions such as providing extra information, escalating an
   * exchange, or updating the business decision and processing notes. All state
   * changes are validated against business workflow and eligibility rules, and
   * changes are logged for compliance and dispute auditing. Only the involved
   * customer, assigned seller, or an admin may update the record, with access
   * checks enforced.
   *
   * @param connection
   * @param orderId Unique identifier for the order to which the exchange
   *   belongs.
   * @param exchangeId Unique identifier for the specific exchange being
   *   updated.
   * @param body Updated exchange information or process decision for the
   *   exchange case.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":exchangeId")
  public async update(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("orderId")
    orderId: string & tags.Format<"uuid">,
    @TypedParam("exchangeId")
    exchangeId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IShoppingMallAiBackendOrderExchange.IUpdate,
  ): Promise<IShoppingMallAiBackendOrderExchange> {
    try {
      return await put__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId(
        {
          admin,
          orderId,
          exchangeId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Soft-delete an order item exchange for evidence retention and compliance.
   *
   * Marks an exchange as deleted in the system using a soft delete (sets the
   * deleted_at timestamp), preserving the full history and evidence for future
   * compliance and audit requests. Returns no body on success. Only the
   * involved customer or an administrator may execute this operation, and all
   * actions are recorded in the audit trail. The exchange remains in the
   * database but is excluded from normal queries and user access except for
   * authorized purposes.
   *
   * @param connection
   * @param orderId Order ID the exchange belongs to.
   * @param exchangeId Target exchange ID to be deleted.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":exchangeId")
  public async erase(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("orderId")
    orderId: string & tags.Format<"uuid">,
    @TypedParam("exchangeId")
    exchangeId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await delete__shoppingMallAiBackend_admin_orders_$orderId_exchanges_$exchangeId(
        {
          admin,
          orderId,
          exchangeId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
