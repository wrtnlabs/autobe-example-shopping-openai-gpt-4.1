import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { postaiCommerceAdminProductTags } from "../../../../providers/postaiCommerceAdminProductTags";
import { AdminAuth } from "../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../decorators/payload/AdminPayload";
import { patchaiCommerceAdminProductTags } from "../../../../providers/patchaiCommerceAdminProductTags";
import { getaiCommerceAdminProductTagsProductTagId } from "../../../../providers/getaiCommerceAdminProductTagsProductTagId";
import { putaiCommerceAdminProductTagsProductTagId } from "../../../../providers/putaiCommerceAdminProductTagsProductTagId";
import { deleteaiCommerceAdminProductTagsProductTagId } from "../../../../providers/deleteaiCommerceAdminProductTagsProductTagId";

import { IAiCommerceProductTag } from "../../../../api/structures/IAiCommerceProductTag";
import { IPageIAiCommerceProductTag } from "../../../../api/structures/IPageIAiCommerceProductTag";

@Controller("/aiCommerce/admin/productTags")
export class AicommerceAdminProducttagsController {
  /**
   * Create a new product-tag binding (ai_commerce_product_tags).
   *
   * Create a new product-tag binding in the ai_commerce_product_tags table.
   * This operation links a tag to a product, enhancing search/discovery
   * features and supporting marketing or analytic initiatives.
   *
   * The input includes identifiers for both product and tag, and may also
   * include meta or business context. Permissions apply: sellers can only tag
   * their own products; admins can create any binding. Error scenarios are
   * duplicate bindings, non-existent product/tag, or permission errors.
   *
   * @param connection
   * @param body The product-tag binding creation payload with product, tag, and
   *   context info.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IAiCommerceProductTag.ICreate,
  ): Promise<IAiCommerceProductTag> {
    try {
      return await postaiCommerceAdminProductTags({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Paginated search for product-tag bindings (ai_commerce_product_tags).
   *
   * Search, filter, and paginate product-tag bindings recorded in the
   * ai_commerce_product_tags table, which links tags to products for search and
   * discovery. This enables discovery/admin users to locate products by tag, or
   * audit product tagging for compliance and analytics.
   *
   * Search criteria may include product ID, tag ID, tag status, or binding
   * time. Pagination, sort order, and search by partial tag/product names may
   * also be supported. The response is optimized for admin/search tools.
   *
   * Security: Admins may view all bindings, while other roles may be restricted
   * to their own products. Error scenarios include invalid search criteria,
   * overly broad or narrow filters, and permission errors.
   *
   * @param connection
   * @param body Search and filter options for product-tag bindings (IDs, tags,
   *   pagination, etc.).
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IAiCommerceProductTag.IRequest,
  ): Promise<IPageIAiCommerceProductTag> {
    try {
      return await patchaiCommerceAdminProductTags({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Get details for a specific product-tag binding (ai_commerce_product_tags).
   *
   * Get detailed information for a specific product-tag binding from the
   * ai_commerce_product_tags table using its unique binding ID. This operation
   * is common for admin or analytics workflows where information about
   * tag-assignments needs to be reviewed or audited.
   *
   * The endpoint is accessible only to admins or users with appropriate access.
   * The result includes all key info about the tag-product relationship, tag
   * status, product metadata, and audit references. Possible errors include
   * invalid productTagId or lack of permission.
   *
   * @param connection
   * @param productTagId The unique identifier of the product-tag binding
   *   record.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":productTagId")
  public async at(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("productTagId")
    productTagId: string & tags.Format<"uuid">,
  ): Promise<IAiCommerceProductTag> {
    try {
      return await getaiCommerceAdminProductTagsProductTagId({
        admin,
        productTagId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing product-tag binding (ai_commerce_product_tags).
   *
   * Update an existing product-tag binding in ai_commerce_product_tags. This is
   * used to reclassify the tag or product association, update meta/context
   * info, or correct earlier mistakes. Only admins or the owning seller may
   * perform this action.
   *
   * All changes are tracked and auditable for compliance and analytics history.
   * The operation requires the unique productTagId, and the request body
   * details the fields to update. Security: Only permitted users may update
   * their own products' tag bindings; error handling includes lack of
   * permission, invalid IDs, or data conflicts.
   *
   * @param connection
   * @param productTagId The unique identifier of the product-tag binding to
   *   update.
   * @param body Updated fields for the product-tag binding.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":productTagId")
  public async update(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("productTagId")
    productTagId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAiCommerceProductTag.IUpdate,
  ): Promise<IAiCommerceProductTag> {
    try {
      return await putaiCommerceAdminProductTagsProductTagId({
        admin,
        productTagId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Erase a product-tag binding (ai_commerce_product_tags).
   *
   * Delete (erase) a product-tag binding from the ai_commerce_product_tags
   * table. This removes the tag-product association, affecting search/discovery
   * on the platform. Only admins or owners can perform this.
   *
   * The operation takes the unique productTagId. Once erased, the association
   * is lost and cannot be immediately recovered unless re-created. Compliance
   * and audit logging applies. Errors include invalid binding ID, insufficient
   * permissions, or attempting to delete protected/tagged associations.
   *
   * @param connection
   * @param productTagId The unique identifier of the product-tag binding to
   *   erase.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":productTagId")
  public async erase(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("productTagId")
    productTagId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteaiCommerceAdminProductTagsProductTagId({
        admin,
        productTagId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
