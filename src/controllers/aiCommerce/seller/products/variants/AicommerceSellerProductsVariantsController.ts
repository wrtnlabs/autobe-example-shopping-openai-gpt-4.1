import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { postaiCommerceSellerProductsProductIdVariants } from "../../../../../providers/postaiCommerceSellerProductsProductIdVariants";
import { SellerAuth } from "../../../../../decorators/SellerAuth";
import { SellerPayload } from "../../../../../decorators/payload/SellerPayload";
import { patchaiCommerceSellerProductsProductIdVariants } from "../../../../../providers/patchaiCommerceSellerProductsProductIdVariants";
import { getaiCommerceSellerProductsProductIdVariantsVariantId } from "../../../../../providers/getaiCommerceSellerProductsProductIdVariantsVariantId";
import { putaiCommerceSellerProductsProductIdVariantsVariantId } from "../../../../../providers/putaiCommerceSellerProductsProductIdVariantsVariantId";
import { deleteaiCommerceSellerProductsProductIdVariantsVariantId } from "../../../../../providers/deleteaiCommerceSellerProductsProductIdVariantsVariantId";

import { IAiCommerceProductVariant } from "../../../../../api/structures/IAiCommerceProductVariant";
import { IPageIAiCommerceProductVariant } from "../../../../../api/structures/IPageIAiCommerceProductVariant";

@Controller("/aiCommerce/seller/products/:productId/variants")
export class AicommerceSellerProductsVariantsController {
  /**
   * Create a new variant/option under a given product for inventory/sales
   * management.
   *
   * Register a new product variant/option under the specified product. Fields
   * are provided via IAiCommerceProductVariant.ICreate, covering SKU, option
   * summary, variant-specific price, inventory count, and operational status.
   * Variant will inherit parent product context and can be referenced in
   * analytics or downstream order flows.
   *
   * This operation is restricted to product owners (seller) or admins. It
   * enforces uniqueness of SKUs within product, validates all required fields,
   * ensures input is compatible with product's current lifecycle status, and
   * records an audit snapshot. Errors may occur for non-existent/mismatched
   * productId, duplicate SKU, invalid parameters, or unauthorized creation.
   *
   * The completed variant record (IAiCommerceProductVariant) is returned on
   * success. Related endpoints cover variant searching (PATCH
   * /products/{productId}/variants), detail (GET), and update flows.
   *
   * @param connection
   * @param productId UUID of the product to which the new variant will be
   *   linked.
   * @param body Variant registration details (SKU, options summary, price,
   *   inventory, status).
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @SellerAuth()
    seller: SellerPayload,
    @TypedParam("productId")
    productId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAiCommerceProductVariant.ICreate,
  ): Promise<IAiCommerceProductVariant> {
    try {
      return await postaiCommerceSellerProductsProductIdVariants({
        seller,
        productId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Paginate and search product variants/options under a given product (admin
   * or owner).
   *
   * List/search variants for a specific product, paginated and filtered by
   * parameters provided in IAiCommerceProductVariant.IRequest. Includes support
   * for search by SKU, option summary (e.g., 'Size: M / Color: Red'), status
   * (active, paused, discontinued), price, and inventory. Results are intended
   * for owner (seller) management, admin moderation, or analytics application.
   * Each returned variant includes all business/operational fields and can
   * reference parent product context.
   *
   * This operation accesses the ai_commerce_product_variants table and may join
   * parent product for authorization filtering. Sellers may only view variants
   * linked to their own products. Admins can access all. Validation errors
   * include non-existent or unauthorized productId reference, invalid
   * filtering, or access to variants for products not owned by the user.
   * Related endpoints include PUT/POST for variant creation and update, GET for
   * detail retrieval, and DELETE if permitted.
   *
   * @param connection
   * @param productId UUID of the parent product whose variants to search.
   * @param body Search/filter/pagination criteria for variants of the target
   *   product.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @SellerAuth()
    seller: SellerPayload,
    @TypedParam("productId")
    productId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAiCommerceProductVariant.IRequest,
  ): Promise<IPageIAiCommerceProductVariant.ISummary> {
    try {
      return await patchaiCommerceSellerProductsProductIdVariants({
        seller,
        productId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Get full information of a specific product variant under a given product
   * for admin/owner.
   *
   * Retrieve detail of a particular variant, given both parent productId and
   * variantId (UUIDs). The returned DTO (IAiCommerceProductVariant) enumerates
   * SKU, option summary, price, inventory, status, and business classification
   * fields. Optionally includes parent product reference where required for
   * business context or access checks.
   *
   * Admins may view all variants; sellers may access only those belonging to
   * their own products. The AI system validates both product and variant
   * existence and matching. Errors returned for absent/invalid productId,
   * variantId, or unauthorized access. Related endpoints include variant PATCH
   * (search), PUT/POST for creation or update, and variant deletion if defined
   * in further requirements.
   *
   * @param connection
   * @param productId UUID of the product whose variant to retrieve.
   * @param variantId UUID of the target variant within the parent product.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":variantId")
  public async at(
    @SellerAuth()
    seller: SellerPayload,
    @TypedParam("productId")
    productId: string & tags.Format<"uuid">,
    @TypedParam("variantId")
    variantId: string & tags.Format<"uuid">,
  ): Promise<IAiCommerceProductVariant> {
    try {
      return await getaiCommerceSellerProductsProductIdVariantsVariantId({
        seller,
        productId,
        variantId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing product variant (ai_commerce_product_variants table).
   *
   * This operation updates a specific product variant belonging to a product in
   * the marketplace. Sellers use this endpoint to update information such as
   * SKU code, option summary, price (variant_price), inventory_quantity, and
   * status of the variant. The provided variantId and productId must correspond
   * to an existing record.
   *
   * The update is only allowed if the authenticated user is the owner seller,
   * and the variant is not in a 'deleted' state. All updates are tracked in the
   * audit logs for compliance, ensuring that every change is traceable,
   * including details of who performed the update and which fields were
   * changed.
   *
   * Input is strictly validated: SKU code must remain unique, price should not
   * be negative, and inventory quantities are checked for business rules (e.g.,
   * cannot set negative inventory). Errors are returned for invalid references,
   * forbidden actions, or failed business rules. See also: creating variants,
   * erasing variants, and updating parent product information.
   *
   * @param connection
   * @param productId The unique identifier (UUID) of the parent product.
   * @param variantId The unique identifier (UUID) of the variant to update.
   * @param body Fields to update for the product variant: option summary, SKU,
   *   price, inventory, and status.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":variantId")
  public async update(
    @SellerAuth()
    seller: SellerPayload,
    @TypedParam("productId")
    productId: string & tags.Format<"uuid">,
    @TypedParam("variantId")
    variantId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IAiCommerceProductVariant.IUpdate,
  ): Promise<IAiCommerceProductVariant> {
    try {
      return await putaiCommerceSellerProductsProductIdVariantsVariantId({
        seller,
        productId,
        variantId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete (soft or hard) an existing product variant
   * (ai_commerce_product_variants table).
   *
   * This operation deletes a specific product variant associated with a
   * product. The request identifies the parent product and the target variant
   * by UUID. The operation is available to sellers who own the product, subject
   * to business constraints: deletion is blocked if the variant is referenced
   * in active orders or in a state that disallows removal.
   *
   * If the schema includes a deleted_at field, this is a soft delete: the
   * record is retained for audit and compliance but is excluded from product
   * listings and option selection. Actions are strictly logged for forensic
   * purposes.
   *
   * Related endpoints include: create, update, and get variant. Attempting to
   * delete a non-existing or already deleted record returns an error.
   *
   * @param connection
   * @param productId The UUID of the parent product.
   * @param variantId The UUID of the product variant to delete.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":variantId")
  public async erase(
    @SellerAuth()
    seller: SellerPayload,
    @TypedParam("productId")
    productId: string & tags.Format<"uuid">,
    @TypedParam("variantId")
    variantId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteaiCommerceSellerProductsProductIdVariantsVariantId({
        seller,
        productId,
        variantId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
